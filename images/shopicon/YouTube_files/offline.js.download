(function(g){var window=this;'use strict';var K$U=function(N){var z=new g.iL("und",new g.Wc("Default","und",!0));z.captionTracks=N.captionTracks;return z},lxU=function(N){return new g.mG(function(z,v){var R=N.length,C=[];
if(R)for(var Z=function(K,l){R--;C[K]=l;R==0&&z(C)},Y=function(K){v(K)},Q,L=0;L<N.length;L++)Q=N[L],g.rFO(Q,g.iW(Z,L),Y);
else z(C)})},Ea=function(N){this.V=N},hP=function(){Ea.apply(this,arguments)},W$U=function(){hP.apply(this,arguments)},GnZ=function(){hP.apply(this,arguments)},xH9=function(){hP.apply(this,arguments)},ePP=function(){hP.apply(this,arguments)},Jv$=function(){hP.apply(this,arguments)},yv7=function(){hP.apply(this,arguments)},fxr=function(){Ea.apply(this,arguments)},dHU=function(){hP.apply(this,arguments)},s8E=function(){hP.apply(this,arguments)},TyZ=function(){hP.apply(this,arguments)},F$W=function(){hP.apply(this,
arguments)},n35=function(){hP.apply(this,arguments)},mHl=function(){hP.apply(this,arguments)},$Hm=function(){hP.apply(this,arguments)},UH9=function(){hP.apply(this,arguments)},By8=function(){hP.apply(this,arguments)},AvU=function(){hP.apply(this,arguments)},g3V=function(){hP.apply(this,arguments)},pqm=function(){hP.apply(this,arguments)},knE=function(){Ea.apply(this,arguments)},P9V=function(){hP.apply(this,arguments)},V6E=function(){hP.apply(this,arguments)},SpU=function(){hP.apply(this,arguments)},
E3m=function(){hP.apply(this,arguments)},hPU=function(){hP.apply(this,arguments)},H5W=function(){hP.apply(this,arguments)},o31=function(){hP.apply(this,arguments)},DHm=function(){hP.apply(this,arguments)},b5m=function(){hP.apply(this,arguments)},t6w=function(){Ea.apply(this,arguments)},O5m=function(){Ea.apply(this,arguments)},Ix5=function(){Ea.apply(this,arguments)},Xq5=function(){hP.apply(this,arguments)},rvr=function(){hP.apply(this,arguments)},u41=function(){hP.apply(this,arguments)},cvr=function(){hP.apply(this,
arguments)},qpw=function(){hP.apply(this,arguments)},M6V=function(){hP.apply(this,arguments)},wqW=function(){hP.apply(this,arguments)},Na1=function(){hP.apply(this,arguments)},zQ7=function(){hP.apply(this,arguments)},vjZ=function(){hP.apply(this,arguments)},RQV=function(){hP.apply(this,arguments)},Cbm=function(){hP.apply(this,arguments)},Zk1=function(){hP.apply(this,arguments)},YAl=function(){hP.apply(this,arguments)},ik$=function(){hP.apply(this,arguments)},jKl=function(){hP.apply(this,arguments)},
aJZ=function(){hP.apply(this,arguments)},QKW=function(){hP.apply(this,arguments)},L3W=function(){hP.apply(this,arguments)},K3V=function(){hP.apply(this,arguments)},lJ5=function(){hP.apply(this,arguments)},W3$=function(){hP.apply(this,arguments)},Go9=function(){hP.apply(this,arguments)},x_w=function(){hP.apply(this,arguments)},eQU=function(){hP.apply(this,arguments)},J_5=function(){hP.apply(this,arguments)},y_E=function(){Ea.apply(this,arguments)},fJV=function(){hP.apply(this,arguments)},d_9=function(){hP.apply(this,
arguments)},sK8=function(){hP.apply(this,arguments)},TaW=function(){hP.apply(this,arguments)},F31=function(){hP.apply(this,arguments)},njl=function(){hP.apply(this,arguments)},m_8=function(){hP.apply(this,arguments)},$_9=function(){hP.apply(this,arguments)},U_W=function(){hP.apply(this,arguments)},BaP=function(){hP.apply(this,arguments)},A_E=function(){hP.apply(this,arguments)},gjl=function(){hP.apply(this,arguments)},pfw=function(){hP.apply(this,arguments)},koE=function(){hP.apply(this,arguments)},
PbV=function(){hP.apply(this,arguments)},VSr=function(){hP.apply(this,arguments)},SAl=function(){hP.apply(this,arguments)},Ej$=function(){hP.apply(this,arguments)},hQW=function(){hP.apply(this,arguments)},Hkw=function(){hP.apply(this,arguments)},ojZ=function(){hP.apply(this,arguments)},D_Z=function(){hP.apply(this,arguments)},bk8=function(){hP.apply(this,arguments)},tS5=function(){hP.apply(this,arguments)},OkV=function(){hP.apply(this,arguments)},IJV=function(){hP.apply(this,arguments)},Xf7=function(){hP.apply(this,
arguments)},r_U=function(){hP.apply(this,arguments)},umm=function(){hP.apply(this,arguments)},c_$=function(){hP.apply(this,arguments)},qAm=function(){hP.apply(this,arguments)},MS9=function(){hP.apply(this,arguments)},wf5=function(N){N=N.key||N.id;
if(!N)throw Error("Entity key is missing");return N},NHw=function(){if(HF)return HF();
var N={};HF=g.w8("PersistentEntityStoreDb",{ZR:(N.EntityStore={e7:1},N.EntityAssociationStore={e7:2},N),shared:!1,upgrade:function(z,v){v(1)&&g.Pz(g.U5(z,"EntityStore",{keyPath:"key"}),"entityType","entityType");v(2)&&(z=g.U5(z,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.Pz(z,"byParentEntityKey","parentEntityKey"),g.Pz(z,"byChildEntityKey","childEntityKey"))},
version:3});return HF()},zkV=function(N){return g.bR(NHw(),N)},v7V=function(N){return g.bR((0,g.H9w)(),N)},oU=function(N){this.token=N},DN=function(N,z){z=z===void 0?{}:z;
g.XS.call(this,g.oQ5[N],Object.assign({},{name:"PESEncoderError",type:N},z));this.type=N;this.level="WARNING";Object.setPrototypeOf(this,DN.prototype)},Rk$=function(N){return new DN("WRONG_DATA_TYPE",{Pz:N})},CXr=function(N){return N instanceof Error?new DN("UNKNOWN_ENCODE_ERROR",{originalMessage:N.message}):new DN("UNKNOWN_ENCODE_ERROR")},ZxU=function(N){return N instanceof Error?new DN("UNKNOWN_DECODE_ERROR",{originalMessage:N.message}):new DN("UNKNOWN_DECODE_ERROR")},YlZ=function(N,z){N=N instanceof
DN?N:z(N);
g.kE(N);throw N;},ixE=function(){},jZU=function(N,z,v){try{return N.Z(z,v)}catch(R){YlZ(R,CXr)}},aI$=function(N){N=(new TextEncoder).encode(N).subarray(0,16);
var z=new Uint8Array(16);z.set(N);return z},b0=function(N){this.V=N},LGl=function(N){var z=QZr[N];
if(z)return z;g.PN(new g.XS("Entity model not found.",{entityType:N}))},KGm=function(N,z){this.V=N;
this.W=z;this.Z={}},WG8=function(N,z){a:{N=lI1(N.W,z.version);
try{var v=N.W(z.data,z.key);break a}catch(R){YlZ(R,ZxU)}v=void 0}return v},tP=function(N,z,v){return N.V.objectStore("EntityStore").get(z).then(function(R){if(R){if(v&&R.entityType!==v)throw Error("Incorrect entity type");
return WG8(N,R)}})},Oa=function(N,z,v){return v?(v=v.map(function(R){return tP(N,R,z)}),g.TJ.all(v)):N.V.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(z)).then(function(R){return R.map(function(C){return WG8(N,C)})})},Xw=function(N,z,v){var R=wf5(z),C=lI1(N.W,1),Z=Object.assign({},z);
return N.V.objectStore("EntityStore").get(R).then(function(Y){if(Y){if(Y.entityType!==v)throw Error("Incorrect entity type");Z.entityMetadata||(Y=WG8(N,Y),Z.entityMetadata=Y.entityMetadata)}}).then(function(){var Y={key:R,
entityType:v,data:jZU(C,Z,R),version:1};return g.TJ.all([g.g8(N.V.objectStore("EntityStore"),Y),G5r(N,Z,v)])}).then(function(){IU(N,R,v);
return R})},xnU=function(N,z,v){z=z.map(function(R){return Xw(N,R,v)});
return g.TJ.all(z)},r7=function(N,z,v){if(v==null?0:v.Go){var R=new Set;
return ekm(N,z,R).then(function(){for(var Z=[],Y=g.f(R),Q=Y.next();!Q.done;Q=Y.next())Z.push(r7(N,Q.value));return g.TJ.all(Z).then(function(){})})}var C=g.cy(z).entityType;
return g.TJ.all([N.V.objectStore("EntityStore").delete(z),JLZ(N,z)]).then(function(){IU(N,z,C)})},yLl=function(N,z){return g.h6(N.V.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(z)},function(v){return g.TJ.all([v.delete(),
JLZ(N,v.cursor.primaryKey)]).then(function(){IU(N,v.cursor.primaryKey,z);return g.St(v)})})},fIm=function(N,z,v,R){var C=lI1(N.W,1);
return tP(N,z,R).then(function(Z){if(Z){Z=g.xl(Z,v);var Y={key:z,entityType:R,data:jZU(C,Z,z),version:1};return g.TJ.all([g.g8(N.V.objectStore("EntityStore"),Y),G5r(N,Z,R)])}}).then(function(){IU(N,z,R);
return z})},IU=function(N,z,v){var R=N.Z[v];
R||(R=new Set,N.Z[v]=R);R.add(z)},dn7=function(N,z,v){var R=wf5(z);
v=LGl(v);if(!v)return g.TJ.resolve([]);v=new v(z);N=N.V.objectStore("EntityAssociationStore");z=[];v=g.f(v.W());for(var C=v.next();!C.done;C=v.next())z.push(g.g8(N,{parentEntityKey:R,childEntityKey:C.value}));return g.TJ.all(z).then(function(Z){return Z.map(function(Y){return Y[1]})})},JLZ=function(N,z){return N.V.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(z))},G5r=function(N,z,v){var R=wf5(z);
return JLZ(N,R).then(function(){return dn7(N,z,v)})},ekm=function(N,z,v){if(v.has(z))return g.TJ.resolve(void 0);
v.add(z);return sZW(N,z).then(function(R){return N.V.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(z)).then(function(){return R})}).then(function(R){var C=g.TJ.resolve(void 0);
R=g.f(R);for(var Z=R.next(),Y={};!Z.done;Y={FS:void 0},Z=R.next())Y.FS=Z.value,C=C.then(function(Q){return function(){return ekm(N,Q.FS,v)}}(Y));
return C}).then(function(){})},sZW=function(N,z){var v=N.V.objectStore("EntityAssociationStore");
return v.index("byParentEntityKey").getAll(IDBKeyRange.only(z)).then(function(R){var C=[];R=g.f(R);for(var Z=R.next();!Z.done;Z=R.next())Z=Z.value,C.push(v.index("byChildEntityKey").getAll(Z.childEntityKey));return g.TJ.all(C)}).then(function(R){var C=[];
R=g.f(R);for(var Z=R.next();!Z.done;Z=R.next())Z=Z.value,Z.length===1&&C.push(Z[0].childEntityKey);return C})},u0=function(){},THl=function(){this.V={};
this.V[0]=new u0;if(!g.yj("aes_pes_encoder_killswitch")){var N=this.V;try{var z=g.rY();var v=aI$(z);var R=new b0(new g.sU(v),new g.dC(v))}catch(C){throw N=C instanceof Error?new DN("KEY_CREATION_FAILED",{originalMessage:C.message}):new DN("KEY_CREATION_FAILED"),g.kE(N),N;}N[1]=R}},lI1=function(N,z){z=z===void 0?0:z;
N=N.V[z];if(!N)throw z=new DN("INVALID_ENCODER_VERSION",{Pz:z}),g.kE(z),z;return N},cF=function(N,z){g.H.call(this);
this.token=N;this.V=z;this.observers=[];N=new g.u7.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.rY());N.onmessage=this.W.bind(this);this.channel=N},qo=function(N,z,v){var R,C,Z,Y;
return g.S(function(Q){if(Q.W==1)return g.k(Q,zkV(N.token),2);if(Q.W!=3)return R=Q.V,g.k(Q,g.A6(R,["EntityStore","EntityAssociationStore"],z,function(L){C=new KGm(L,N.V);return v(C)}),3);
Z=Q.V;C&&(Y=C.Z,Object.keys(Y).length>0&&(N.channel.postMessage(Y),FGW(N,Y)));return Q.return(Z)})},Mo=function(N,z,v){return qo(N,{mode:"readwrite",
sR:!0},function(R){return Xw(R,z,v)})},n77=function(N,z){return qo(N,{mode:"readwrite",
sR:!0},function(v){return xnU(v,z,"offlineOrchestrationActionWrapperEntity")})},mnr=function(N,z){return qo(N,{mode:"readwrite",
sR:!0},function(v){return r7(v,z)})},$n1=function(N){return qo(N,{mode:"readwrite",
sR:!0},function(z){return yLl(z,"videoPlaybackPositionEntity")})},w7=function(N,z,v){return qo(N,{mode:"readonly",
sR:!0},function(R){return tP(R,z,v)})},NC=function(N,z,v){return qo(N,{mode:"readonly",
sR:!0},function(R){return Oa(R,z,v)})},FGW=function(N,z){N=g.f(N.observers);
for(var v=N.next();!v.done;v=N.next())v=v.value,v(z)},Unr=function(){var N,z,v;
return g.S(function(R){if(R.W==1)return g.d_(R,2),g.k(R,g.qp(),4);if(R.W!=2){N=R.V;if(!N||!g.uy()||typeof g.u7.BroadcastChannel==="undefined")return R.return();z=new THl;return R.return(new cF(N,z))}v=g.U2(R);v instanceof Error&&g.kE(v);return R.return()})},zm=function(){BHr||(BHr=Unr());
return BHr},ALw=function(N){var z;
N=(z=N.options)==null?void 0:z.persistenceOption;return N==="ENTITY_PERSISTENCE_OPTION_PERSIST"||N==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},g7W=function(N){var z;
return g.S(function(v){return v.W==1?g.k(v,zm(),2):(z=v.V)?g.k(v,qo(z,"readwrite",function(R){for(var C={},Z=g.f(N),Y=Z.next(),Q={};!Y.done;Q={sb:void 0,Vk:void 0},Y=Z.next())Q.sb=Y.value,Q.sb.entityKey&&ALw(Q.sb)&&(Q.Vk=g.Iw(Q.sb.payload),Y=void 0,Q.sb.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(Y=function(L){return function(){return Xw(R,L.sb.payload[L.Vk],L.Vk)}}(Q)),Q.sb.type==="ENTITY_MUTATION_TYPE_DELETE"&&(Y=function(L){return function(){return r7(R,L.sb.entityKey)}}(Q)),Q.sb.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(Y=function(L){return function(){return fIm(R,L.sb.entityKey,L.sb.payload[L.Vk],L.Vk)}}(Q)),Y&&(C[Q.sb.entityKey]=C[Q.sb.entityKey]?C[Q.sb.entityKey].then(Y):Y()));
return g.TJ.all(Object.values(C))}),0):v.return()})},psE=function(N){var z;
return g.S(function(v){if(v.W==1){z=N.mutations;if(!z||z.length<=0)return v.return();if(g.v0){var R={type:"ENTITY_LOADED"};z!==void 0&&(R.payload=z);g.v0.dispatch(R)}return g.k(v,g7W(z),2)}z.length=0;g.fO(v)})},k5$=function(N){return N!==void 0},PXZ=function(N){var z=g.B3();
z=Object.assign({},z);N=Object.assign({},N);for(var v in z)N[v]?(z[v]!==4&&(z[v]=N[v]),delete N[v]):z[v]!==2&&(z[v]=4);Object.assign(z,N);g.jgK(z);JSON.stringify(z);return z},VGr=function(N){var z,v;
return g.S(function(R){if(R.W==1)return g.k(R,g.qp(),2);if(R.W!=3)return(z=R.V)?g.k(R,g.pW(z),3):R.return();v=R.V;return R.return(g.A6(v,["index","media","captions"],{mode:"readwrite",sR:!0},function(C){var Z=IDBKeyRange.bound(N+"|",N+"~");C=[C.objectStore("index").delete(Z),C.objectStore("media").delete(Z),C.objectStore("captions").delete(Z)];return g.TJ.all(C).then(function(){})}))})},Sl9=function(){var N,z;
return g.S(function(v){if(v.W==1)return g.k(v,g.qp(),2);if(v.W!=3){N=v.V;if(!N)throw g.d8("rvdfd");return g.k(v,g.pW(N),3)}z=v.V;return v.return(g.A6(z,["index","media"],{mode:"readwrite",sR:!0},function(R){var C={};return g.Vl(R.objectStore("index"),{},function(Z){var Y=Z.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),Q=g.TJ.resolve(void 0);if(Y){var L=Y[1];Y=Y[2];C[L]=C[L]||{};var K;C[L][Y]=g.lD7((K=Z.getValue())==null?void 0:K.fmts)}else Q=Z.delete().then(function(){});
return g.TJ.all([g.St(Z),Q]).then(function(l){return g.f(l).next().value})}).then(function(){for(var Z={},Y=g.f(Object.keys(C)),Q=Y.next();!Q.done;Q=Y.next()){Q=Q.value;
var L=C[Q].v;Z[Q]=C[Q].a&&L?1:2}var K=PXZ(Z);return g.FN7(R.objectStore("media"),{},function(l){var W=l.cursor.key.match(g.eUI);W&&Z[W[1]]||R.objectStore("media").delete(l.cursor.key);return g.Gbb(l)}).then(function(){return K})})}))})},E7w=function(N,z){var v,R;
return g.S(function(C){if(C.W==1)return g.k(C,g.qp(),2);if(C.W!=3){v=C.V;if(!v)throw g.d8("wct");return g.k(C,g.pW(v),3)}R=C.V;return g.k(C,g.A6(R,["captions"],{mode:"readwrite",sR:!0},function(Z){var Y=[];Z=Z.objectStore("captions");for(var Q=0;Q<z.length;Q++){var L=g.g8(Z,z[Q],N+"|"+z[Q].metadata.vss_id);Y.push(L)}return g.TJ.all(Y)}),0)})},hk5=function(N){var z,v,R;
return g.S(function(C){if(C.W==1)return z=IDBKeyRange.bound(N+"|",N+"~"),g.k(C,g.qp(),2);if(C.W!=3){v=C.V;if(!v)throw g.d8("gactfv");return g.k(C,g.pW(v),3)}R=C.V;return C.return(R.getAll("captions",z))})},HxE=function(N){return g.S(function(z){g.gi(N,0);
return z.return(VGr(N))})},o7r=function(N){return{context:g.q2(),
videoIds:N}},Dn9=function(N){return{context:g.q2(),
playlistIds:N}},bx7=function(N){return{context:g.q2(),
offlinePlaylistSyncChecks:N}},tGm=function(){this.V=new Map},II1=function(){Ox1||(Ox1=new tGm);
return Ox1},XsP=function(N,z){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:N},metadata:z,statusCode:void 0,csn:void 0,can:void 0}},rLZ=function(N,z,v){if(!v){var R=R===void 0?!1:R;
v=N.V.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!v||R)v=g.sD(16),N.V.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",v)}N={flowNonce:v,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:z.eventType};z.metadata&&(N.flowMetadata=z.metadata);z.statusCode!==void 0&&(N.flowEventStatus=z.statusCode);z.csn&&(N.csn=z.csn);z.can&&(N.can=z.can);g.aX("flowEvent",N,void 0)},up5=function(N){var z,v,R,C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n,P,V,D,c,r,Rv,Zu,Nx,av,M,s2,$m,O2,m7,QU,BU,mu,Y5,F,jI,rE,TM;
return g.S(function(gE){if(gE.W==1)return g.k(gE,qo(N,{mode:"readonly",sR:!0},function(x5){return Oa(x5,"playbackData").then(function(Du){var SV=Du.map(function(p){return p.transfer}).filter(function(p){return!!p}),pm=Du.map(function(p){return p.offlineVideoPolicy}).filter(function(p){return!!p}),B=Du.filter(function(p){return!!p.key}).map(function(p){return g.qJ(g.cy(p.key).entityId,"downloadStatusEntity")});
SV=Oa(x5,"transfer",SV);pm=Oa(x5,"offlineVideoPolicy",pm);B=Oa(x5,"downloadStatusEntity",B);var A=SV.then(function(p){p=p.reduce(function(E,O){(O==null?0:O.offlineVideoStreams)&&E.push.apply(E,g.U(O.offlineVideoStreams));return E},[]).filter(function(E){return!!E});
return Oa(x5,"offlineVideoStreams",p)});
return g.TJ.all([SV,pm,A,B]).then(function(p){var E=g.f(p);p=E.next().value;var O=E.next().value;var FK=E.next().value;E=E.next().value;return[Du,p,O,FK,E]})})}),2);
if(gE.W!=3)return z=gE.V,g.k(gE,qo(N,{mode:"readonly",sR:!0},function(x5){return Oa(x5,"mainDownloadsListEntity").then(function(Du){var SV,pm;return(pm=(SV=Du[0])==null?void 0:SV.downloads)!=null?pm:[]})}),3);
v=gE.V;R=g.f(z);C=R.next().value;Z=R.next().value;Y=R.next().value;Q=R.next().value;L=R.next().value;K=C;l=Z;W=Y;G=Q;x=L;e={};d={};T={};m={};n={};P=[];V=g.f(l);for(D=V.next();!D.done;D=V.next())(c=D.value)&&(e[c.key]=c);r=g.f(W);for(Rv=r.next();!Rv.done;Rv=r.next())(Zu=Rv.value)&&(d[Zu.key]=Zu);Nx=g.f(x);for(av=Nx.next();!av.done;av=Nx.next())(M=av.value)&&(T[M.key]=M);s2=g.f(G);for($m=s2.next();!$m.done;$m=s2.next())(O2=$m.value)&&(m[O2.key]=O2);m7=g.f(v);for(QU=m7.next();!QU.done;QU=m7.next())BU=
QU.value,mu=void 0,n[(mu=BU.videoItem)!=null?mu:""]=!0,BU.videoItem&&(F=Y5=void 0,jI=(F=(Y5=g.cy(BU.videoItem))==null?void 0:Y5.entityId)!=null?F:"",P.push({externalVideoId:jI}));rE=K.filter(function(x5){if(!x5||!x5.key||!x5.offlineVideoPolicy)return!1;x5=g.cy(x5.key).entityId;x5=g.qJ(x5,"downloadStatusEntity");var Du;return!(x5&&((Du=T[x5])==null?void 0:Du.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
TM=rE.map(function(x5){var Du=e[x5.transfer],SV=[];if(Du==null?0:Du.offlineVideoStreams)for(var pm=g.f(Du.offlineVideoStreams),B=pm.next();!B.done;B=pm.next())(B=m[B.value])&&SV.push(B);pm=d[x5.offlineVideoPolicy];B=n;var A=x5==null?void 0:x5.playerResponseTimestamp,p=g.cy(pm.key).entityId;x5=g.qJ(p,"mainVideoEntity");if(pm.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var E="OFFLINE_VIDEO_STATE_DISABLED";pm.expirationTimestamp&&Number(pm.expirationTimestamp)<Date.now()/1E3&&(E="OFFLINE_VIDEO_STATE_EXPIRED")}else if(pm.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")E="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Du==null?void 0:Du.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":E="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":E="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":E="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":E="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":E="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":E="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:E="OFFLINE_VIDEO_STATE_UNKNOWN"}if(E==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Du==null?void 0:Du.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":E="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":E="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":E=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}p={id:p,videoState:E};if(Du==null?0:Du.cotn)p.cotn=Du.cotn;if(Du==null?0:Du.maximumDownloadQuality)p.selectedVideoQuality=Du==null?void 0:Du.maximumDownloadQuality;if(Du==null?0:Du.lastProgressTimeMs)p.lastProgressTimeMs=Du.lastProgressTimeMs;A&&(p.playerResponseSavedTimeMs=String(Number(A)*1E3));Du=String;A=0;SV=g.f(SV);for(E=SV.next();!E.done;E=SV.next())if(E=E.value,E.streamsProgress){E=g.f(E.streamsProgress);for(var O=E.next();!O.done;O=E.next()){var FK=void 0;
A+=Number((FK=O.value.numBytesDownloaded)!=null?FK:0)}}p.downloadedBytes=Du(A);p.selectedOfflineMode=B[x5]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";pm.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(p.offlinePlaybackDisabledReason=pm.offlinePlaybackDisabledReason);return p});
return gE.return({offlineVideos:TM,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:P}}})})},cLP=function(){this.locks=navigator.locks},qlr=function(){try{var N=g.qx("ytglobal.locks_");
if(N)return N;var z;if(z=navigator){var v=navigator;z="locks"in v&&!!v.locks}if(z)return g.u7.localStorage&&g.u7.localStorage.getItem("noop"),N=new cLP,g.cU("ytglobal.locks_",N),N}catch(R){}},vg=function(){},MG7=function(){},ws8=function(N){if(N.includes(":"))throw Error("Invalid user cache name: "+N);
return N+":"+g.rY("CacheStorage get")},N27=function(){return g.S(function(N){if(Rr!==void 0)return N.return(Rr);
Rr=new Promise(function(z){var v;return g.S(function(R){switch(R.W){case 1:return g.d_(R,2),g.k(R,Cp.open("test-only"),4);case 4:return g.k(R,Cp.delete("test-only"),5);case 5:g.nO(R,3);break;case 2:if(v=g.U2(R),v instanceof Error&&v.name==="SecurityError")return z(!1),R.return();case 3:z("caches"in window),g.fO(R)}})});
return N.return(Rr)})},vC7=function(){return g.S(function(N){if(N.W==1)return g.k(N,N27(),2);
if(!N.V)return N.return(void 0);zrr||(zrr=new MG7);return N.return(zrr)})},Zc=function(N,z,v){g.PN(new g.XS("Woffle: "+N,v?{cotn:v}:""));
z instanceof Error&&g.PN(z)},Rr8=function(N){var z;
return g.S(function(v){if(v.W==1)return g.k(v,up5(N),2);z=v.V;g.aX("offlineStateSnapshot",z);g.fO(v)})},Yf=function(N){g.H.call(this);
var z=this;this.api=N;this.Oi={fiS:function(){return z.V},
AZL:function(){return z.W}};
typeof g.u7.BroadcastChannel!=="undefined"&&(this.V=new g.u7.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.rY()),this.V.onmessage=this.Z.bind(this),this.W=new g.u7.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.rY()),this.W.onmessage=this.N.bind(this))},iA=function(N,z){N.api.Qp("onOfflineOperationFailure",z);
var v;(v=N.V)==null||v.postMessage(z)},C6V=function(N,z,v,R){var C=this;
this.Y=N;this.J=z;this.visibility=v;this.X=R;this.B=this.L=this.G=this.Z=this.V=!1;this.N=new g.cn(function(){C.mJ()});
this.Oi={GH:function(){return C.W},
mJ:function(){C.mJ()},
Ndl:function(){return C.N}};
this.visibility.subscribe("visibilitystatechange",function(){C.iI()})},Z$8=function(N){if(!N.Z&&!N.V){var z=qlr();
if(z){N.Z=!0;var v=g.rY("OfflineLockManager");z.request("woffle_orchestration_leader:"+v,{},function(){var R,C,Z,Y;return g.S(function(Q){switch(Q.W){case 1:return g.d_(Q,2),N.W=new g.Ww,N.V=!0,N.Z=!1,g.k(Q,N.Y(),4);case 4:return g.k(Q,N.W.promise,5);case 5:g.nO(Q,0);break;case 2:R=g.U2(Q),((Z=(C=N).X)==null?0:Z.call(C,"wo_relinquish_leadership_on_lock_request_error"))||N.mJ(),R instanceof Error&&(Y=R,Y.args=[{name:"WoLockManagerError",by:R.name}],g.kE(Y)),g.fO(Q)}})})}}},YP9=function(N){N.V&&(N.B=
!0,jQ(N))},i$7=function(N,z){N.V&&(N.G=z,jQ(N))},j9w=function(N,z){N.V&&(N.L=z,jQ(N))},jQ=function(N){N.L&&N.G&&N.B&&N.visibility.isBackground()?g.qv(N.N,6E4):N.N.stop()},ar=function(N){var z;
N.offlineDeleteReason=(z=N.offlineDeleteReason)!=null?z:"OFFLINE_DELETE_REASON_UNKNOWN";var v;N.offlineModeType=(v=N.offlineModeType)!=null?v:"OFFLINE_NOW";g.aX("offlineDeleteEvent",N)},QH=function(N,z){var v=z.videoId;
var R=z.vW;z=z.offlineModeType;N.encryptedVideoId=v;N.cotn=R==null?void 0:R.cotn;N.offlineabilityFormatType=R==null?void 0:R.maximumDownloadQuality;var C;N.isRefresh=(C=R==null?void 0:R.isRefresh)!=null?C:!1;var Z;N.softErrorCount=(Z=R==null?void 0:R.transferRetryCount)!=null?Z:0;N.offlineModeType=z!=null?z:"OFFLINE_NOW";(N.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&N.statusType==="UNKNOWN_STATUS_TYPE"||!N.transferStatusType&&!N.statusType)&&g.PN(Error("Woffle unknown transfer status"));
g.aX("offlineTransferStatusChanged",N)},atm=function(N){QH({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},N)},Q91=function(N,z,v,R){R={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!R};z&&v&&(z=Math.floor(z/1024).toFixed(),v=Math.floor(v/1024).toFixed(),R.alreadyDownloadedKbytes=z,R.totalFetchedKbytes=z,R.totalContentKbytes=v);QH(R,N)},L9W=function(N){QH({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},N)},K9E=function(N){QH({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},N)},lt1=function(N){switch(N){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Lp=function(N){var z,v,R;
return((R=(z=N.actionMetadata)==null?void 0:(v=z.retryScheduleIntervalsInSeconds)==null?void 0:v.length)!=null?R:0)>0},Kp=function(N){return N.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!N.entityKey},lA=function(N){return N.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!N.entityKey},Wg=function(N){return N.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!N.entityKey},W9$=function(N){return N.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!N.entityKey},
Gm=function(N,z,v,R,C){C=C===void 0?!1:C;
var Z,Y,Q,L,K,l;return g.S(function(W){if(W.W==1)return Z=g.qJ(N,z),Y=g.qJ(N,"downloadStatusEntity"),g.k(W,qo(v,{mode:"readonly",sR:!0},function(G){return g.TJ.all([tP(G,Z,z),tP(G,Y,"downloadStatusEntity")])}),2);
Q=W.V;L=Q.length?Q[0]:void 0;if(!L)return W.Zp(0);K=GB1;if(l=Q.length>1?Q[1]:void 0){if(l.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!C)return W.return();l.downloadState=R}else l={key:Y,downloadState:R};g.HN(L,K,l);return g.k(W,qo(v,{mode:"readwrite",sR:!0},function(G){return g.TJ.all([Xw(G,L,z),Xw(G,l,"downloadStatusEntity")])}),0)})},xf=function(N,z){return N.actionType===z.actionType&&N.entityKey===z.entityKey},eQ=function(N,z){if(N&&N.transferState!=="TRANSFER_STATE_COMPLETE"&&N.transferState!==
"TRANSFER_STATE_FAILED"){var v=g.cy(N.key).entityId;
QH({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:v,vW:N,offlineModeType:z})}},Jw=function(N){if(!N||!N.thumbnails)return[];
var z=[];N=g.f(N.thumbnails);for(var v=N.next();!v.done;v=N.next())v=v.value,v.url&&z.push(v.url);return z},xm5=function(N,z,v){v=v===void 0?[]:v;
var R,C,Z,Y,Q,L,K,l,W,G,x,e,d;return g.S(function(T){if(T.W==1)return v.length?g.k(T,NC(N,z),2):T.return([]);R=T.V;C=new Set;Z=g.f(R);for(Y=Z.next();!Y.done;Y=Z.next())if(Q=Y.value,L=Q.id||Q.key)K=g.cy(L).entityId,C.add(K);l=[];W=g.f(v);for(G=W.next();!G.done;G=W.next())x=G.value,e=x.offlineVideoData,d=void 0,((d=e)==null?0:d.videoId)&&!C.has(e.videoId)&&l.push(x);return T.return(l)})},erl=function(N,z,v){return new g.Os(N,{cotn:z,
raw_player_response:v,download_media:!0,start:Infinity,disable_watch_next:!0})},JhE=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},yH=function(N,z,v,R,C,Z,Y,Q,L,K,l){this.entityType=N;
this.actionId=z;this.action=v;this.parentActionId=R;this.rootActionId=C===void 0?z:C;this.childActionIds=Z;this.prereqActionId=Y;this.postreqActionIds=Q;this.hasChildActionFailed=K;this.retryScheduleIndex=0;this.V=l||Date.now();this.retryScheduleIndex=L||0},fp=function(N){if(!N.key)throw Error("Entity key is required.");
if(!N.actionProto)throw Error("OfflineOrchestrationAction is required.");var z=g.cy(N.key),v=g.cy(N.actionProto.entityKey);return new yH(v.entityType,z.entityId,N.actionProto,N.parentActionId,N.rootActionId,N.childActionIds,N.prereqActionId,N.postreqActionIds,N.retryScheduleIndex,N.hasChildActionFailed,Number(N.enqueueTimeSec)*1E3)},dh=function(N){return{key:g.qJ(N.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:N.action,parentActionId:N.parentActionId,rootActionId:N.rootActionId,childActionIds:N.childActionIds,prereqActionId:N.prereqActionId,postreqActionIds:N.postreqActionIds,retryScheduleIndex:N.retryScheduleIndex,hasChildActionFailed:N.hasChildActionFailed,enqueueTimeSec:(N.V/1E3).toFixed()}},yh8=function(){var N;
return g.S(function(z){return z.W==1?g.k(z,vC7(),2):(N=z.V)?z.return(N.delete("yt-player-local-img")):z.return(!0)})},sy=function(N){var z,v;
return g.S(function(R){if(R.W==1)return g.k(R,vC7(),2);if(R.W!=3){z=R.V;if(!z)throw Error("Cache API not supported");return N.length?g.k(R,z.open("yt-player-local-img"),3):R.return()}v=R.V;return g.k(R,Promise.all(N.map(function(C){return v.delete(C)})),0)})},Tm=function(N){var z,v;
return g.S(function(R){if(R.W==1)return g.k(R,vC7(),2);if(R.W!=3){z=R.V;if(!z)throw Error("Cache API not supported");return N.length?g.k(R,z.open("yt-player-local-img"),3):R.return()}v=R.V;return g.k(R,v.addAll(N),0)})},Fx=function(N,z,v,R,C){var Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n,P,V,D,c,r,Rv,Zu,Nx,av,M,s2,$m,O2,m7,QU,BU,mu;
return g.S(function(Y5){switch(Y5.W){case 1:return Z=g.qJ(N,"mainVideoEntity"),Y=g.qJ(N,"ytMainChannelEntity"),Q=g.qJ(N,"transfer"),L=g.qJ(N,"videoDownloadContextEntity"),g.k(Y5,qo(z,{mode:"readonly",sR:!0},function(F){return g.TJ.all([tP(F,Z,"mainVideoEntity"),tP(F,Y,"ytMainChannelEntity"),tP(F,Q,"transfer"),tP(F,L,"videoDownloadContextEntity"),Oa(F,"ytMainChannelEntity"),Oa(F,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:K=Y5.V;l=g.f(K);W=l.next().value;G=l.next().value;x=l.next().value;e=l.next().value;d=l.next().value;T=l.next().value;m=W;n=G;P=x;V=e;D=d;c=T;if(!m&&!n){Y5.Zp(3);break}r=m?Jw(m.thumbnail):[];if(!n){Rv=[];Y5.Zp(4);break}return g.k(Y5,ft$(n,D),5);case 5:Rv=Y5.V;case 4:return Zu=Rv,g.k(Y5,sy(r.concat(Zu)),3);case 3:Nx=[];av=g.qJ(N,"downloadStatusEntity");M=g.f(c);for(s2=M.next();!s2.done;s2=M.next())$m=s2.value,O2=g.cy($m.key).entityId,m7=fp($m),QU=g.cy(m7.action.entityKey).entityId,O2!==N&&QU!==
N||xf(v,$m.actionProto)||Nx.push($m.key);return g.k(Y5,qo(z,{mode:"readwrite",sR:!0},function(F){var jI=Nx.map(function(rE){return r7(F,rE)});
jI.push(r7(F,Z,{Go:!0}));jI.push(r7(F,av,{Go:!0}));return g.TJ.all(jI)}),7);
case 7:mu=(BU=V)==null?void 0:BU.offlineModeType,C&&(ar(C),C.offlineModeType&&(mu=C.offlineModeType)),eQ(P,mu),iA(R,{entityKey:Z,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.fO(Y5)}})},T2E=function(N,z,v,R){var C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n,P,V,D,c,r,Rv,Zu,Nx,av,M,s2,$m,O2,m7,QU,BU,mu,Y5,F,jI,rE,TM,gE,x5,Du,SV,pm,B,A,p,E,O,FK,vU,Jb;
return g.S(function(CO){switch(CO.W){case 1:return C=g.qJ(N,"mainPlaylistEntity"),Z=g.qJ(N,"ytMainChannelEntity"),g.k(CO,qo(z,{mode:"readonly",sR:!0},function(g_){return g.TJ.all([tP(g_,C,"mainPlaylistEntity"),tP(g_,Z,"ytMainChannelEntity"),Oa(g_,"mainPlaylistEntity"),Oa(g_,"mainDownloadsListEntity"),Oa(g_,"ytMainChannelEntity"),Oa(g_,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:Y=CO.V;Q=g.f(Y);L=Q.next().value;K=Q.next().value;l=Q.next().value;W=Q.next().value;G=Q.next().value;x=Q.next().value;e=L;d=K;T=l;m=W;n=G;P=x;if(!e&&!d){CO.Zp(3);break}V=e?dmr(e):[];if(!d){D=[];CO.Zp(4);break}return g.k(CO,ft$(d,n),5);case 5:D=CO.V;case 4:return c=D,g.k(CO,sy(V.concat(c)),3);case 3:r=[];Rv=new Map;if(!e){CO.Zp(7);break}return g.k(CO,s9w(e,T,m),8);case 8:r=CO.V;Zu=g.f(r);for(Nx=Zu.next();!Nx.done;Nx=Zu.next())av=Nx.value,Rv.set(av,{videoId:av,playlistId:N,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.k(CO,qo(z,{mode:"readonly",sR:!0},function(g_){return g.TJ.all([Oa(g_,"transfer"),Oa(g_,"videoDownloadContextEntity")])}),9);
case 9:M=CO.V;s2=g.f(M);$m=s2.next().value;O2=s2.next().value;m7=$m;QU=O2;BU=g.f(m7);for(mu=BU.next();!mu.done;mu=BU.next())Y5=mu.value,F=g.cy(Y5.key).entityId,(jI=Rv.get(F))&&Y5&&(jI.cotn=Y5.cotn);rE=g.f(QU);for(TM=rE.next();!TM.done;TM=rE.next())gE=TM.value,x5=g.cy(gE.key).entityId,(Du=Rv.get(x5))&&gE&&(Du.offlineModeType=gE.offlineModeType);case 7:SV=[];pm=g.f(P);for(B=pm.next();!B.done;B=pm.next())A=B.value,p=g.cy(A.key).entityId,E=fp(A),p!==N&&E.rootActionId!==N||xf(v,A.actionProto)||SV.push(A.key);
O=g.qJ(N,"mainPlaylistEntity");return g.k(CO,qo(z,{mode:"readwrite",sR:!0},function(g_){var Mx=SV.map(function(Fr){return r7(g_,Fr)});
Mx.push(r7(g_,O,{Go:!0}));return g.TJ.all(Mx)}),10);
case 10:if(!e){CO.Zp(0);break}r.reverse();if(!r){CO.Zp(0);break}FK=g.f(r);vU=FK.next();case 13:if(vU.done){CO.Zp(0);break}Jb=vU.value;return g.k(CO,Fx(Jb,z,v,R,Rv.get(Jb)),14);case 14:vU=FK.next(),CO.Zp(13)}})},nCZ=function(N,z,v,R){var C,Z,Y,Q,L,K,l,W,G;
return g.S(function(x){if(x.W==1)return C=g.qJ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),Z=new Map,g.k(x,qo(N,{mode:"readwrite",sR:!0},function(e){var d=Oa(e,"transfer"),T=Oa(e,"offlineOrchestrationActionWrapperEntity"),m=Oa(e,"videoDownloadContextEntity"),n=tP(e,C,"mainDownloadsListEntity");return g.TJ.all([d,T,m,n]).then(function(P){P=g.f(P);var V=P.next().value;var D=P.next().value;var c=P.next().value;var r=P.next().value;P=F9V.map(function(Zu){return yLl(e,Zu)});
D=g.f(D);for(var Rv=D.next();!Rv.done;Rv=D.next())Rv=Rv.value,xf(z,Rv.actionProto)||P.push(r7(e,Rv.key,{Go:!0}));r&&(r.downloads=[],P.push(Xw(e,r,"mainDownloadsListEntity")));if(c)for(c=g.f(c),r=c.next();!r.done;r=c.next())r=r.value,D=g.cy(r.key).entityId,D=g.qJ(D,"transfer"),Z.set(D,r.offlineModeType);return g.TJ.all(P).then(function(){return V})})}),2);
Y=x.V;Q=g.f(Y);for(L=Q.next();!L.done;L=Q.next())K=L.value,eQ(K,Z.get(K.key)),l=g.cy(K.key).entityId,W={videoId:l,offlineDeleteReason:R,cotn:K.cotn,offlineModeType:Z.get(K.key)},ar(W),G=g.qJ(l,"mainVideoEntity"),iA(v,{entityKey:G,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.k(x,yh8(),0)})},dmr=function(N,z){var v=[];
if(N.thumbnailStyleData){N=g.f(N.thumbnailStyleData);for(var R=N.next();!R.done;R=N.next()){var C=void 0,Z=void 0,Y=void 0;v=v.concat(Jw((C=R.value)==null?void 0:(Z=C.value)==null?void 0:(Y=Z.collageThumbnail)==null?void 0:Y.coverThumbnail))}}z=Jw(z);return v.concat(z)},s9w=function(N,z,v){var R,C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n,P,V,D,c,r,Rv,Zu;
return g.S(function(Nx){R=[];C=new Set;if(v.length)for(Z=g.f(v),Y=Z.next();!Y.done;Y=Z.next())if(Q=Y.value,L=void 0,(L=Q.downloads)==null?0:L.length)for(K=g.f(Q.downloads),l=K.next();!l.done;l=K.next())W=l.value,W.videoItem&&(G=g.cy(W.videoItem).entityId,C.add(G));if(N.videos){x=g.f(N.videos);for(e=x.next();!e.done;e=x.next())d=e.value,T=JSON.parse(g.cy(d).entityId),T.videoId&&!C.has(T.videoId)&&R.push(T.videoId);m=g.f(z);for(n=m.next();!n.done;n=m.next())if(P=n.value,P.key!==N.key&&(V=P.videos))for(D=
g.f(V),c=D.next();!c.done;c=D.next())r=c.value,Rv=JSON.parse(g.cy(r).entityId),Rv.videoId&&(Zu=R.indexOf(Rv.videoId),Zu!==-1&&R.splice(Zu,1))}return Nx.return(R)})},ft$=function(N,z){var v,R,C,Z,Y,Q,L,K;
return g.S(function(l){v=Jw(N.avatar);R=g.f(z);for(C=R.next();!C.done;C=R.next())if(Z=C.value,Z.id!==N.id)for(Y=g.f(Jw(Z.avatar)),Q=Y.next();!Q.done;Q=Y.next())L=Q.value,K=v.indexOf(L),K!==-1&&v.splice(K,1);return l.return(v)})},mmV=function(N){var z;
return g.S(function(v){z=g.t(N.frameworkUpdates,np);return N.frameworkUpdates&&z?g.k(v,psE(z),0):v.return()})},UmW=function(N){var z;
if((z=N.onResponseReceivedActions)!=null&&z.length){var v;N=(v=g.t(g.t(N.onResponseReceivedActions[0],$ml),g.E_V))==null?void 0:v.actions;if(N!=null&&N.length)return N}},B2U=function(N){var z,v,R;
return g.S(function(C){if(C.W==1)return N?g.k(C,w7(N,g.Sw,"mainDownloadsListEntity"),2):C.return([]);z=C.V;return((v=z)==null?0:(R=v.downloads)==null?0:R.length)?C.return(z.downloads.map(function(Z){var Y;return(Y=Z.videoItem)!=null?Y:""})):C.return([])})},gC8=function(N,z){var v;
return g.S(function(R){return R.W==1?g.k(R,AhU(N,z),2):(v=R.V)?g.k(R,qo(N,{mode:"readwrite",sR:!0},function(C){var Z=[Xw(C,v.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];v.mainDownloadsListEntity&&Z.push(Xw(C,v.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.TJ.all(Z)}),0):R.Zp(0)})},AhU=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n,P;
return g.S(function(V){if(V.W==1)return v=g.qJ("main_downloads_library_id","mainDownloadsLibraryEntity"),R=g.qJ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.k(V,qo(N,{mode:"readonly",sR:!0},function(D){return g.TJ.all([tP(D,v,"mainDownloadsLibraryEntity"),tP(D,R,"mainDownloadsListEntity")])}),2);
C=V.V;Z=g.f(C);Y=Z.next().value;Q=Z.next().value;L=Y;K=Q;L||(L={id:v});l=g.f(z);for(W=l.next();!W.done;W=l.next())if(G=W.value,G===g.Sw){if(L.smartDownloadsList)return V.return();L.smartDownloadsList=G}else if(x=g.cy(G).entityType,e={},x==="mainPlaylistEntity"?e.playlistItem=G:x==="mainVideoEntity"&&(e.videoItem=G),!g.wE(e)){d=void 0;if((d=K)==null?0:d.downloads){T=!1;m=g.f(K.downloads);for(n=m.next();!n.done;n=m.next())if(P=n.value,P.playlistItem===G||P.videoItem===G){T=!0;break}T||K.downloads.push(e)}else K=
{id:R,downloads:[e]};L.downloadsList=R}return V.return({mainDownloadsLibraryEntity:L,mainDownloadsListEntity:K})})},pww=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W,G,x,e,d,T;
return g.S(function(m){if(m.W==1)return v=g.qJ("main_downloads_library_id","mainDownloadsLibraryEntity"),R=g.qJ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.k(m,qo(N,{mode:"readonly",sR:!0},function(n){return g.TJ.all([tP(n,v,"mainDownloadsLibraryEntity"),tP(n,R,"mainDownloadsListEntity"),tP(n,g.Sw,"mainDownloadsListEntity")])}),2);
C=m.V;Z=g.f(C);Y=Z.next().value;Q=Z.next().value;L=Z.next().value;K=Y;l=Q;W=L;if(!K)return m.Zp(0);if(z===g.Sw&&((G=W)==null?0:G.downloads))W.downloads=[];else if((x=l)==null?0:x.downloads)for(e=g.cy(z).entityType,d=0;d<l.downloads.length;d++)if(T=l.downloads[d],e==="mainVideoEntity"&&T.videoItem===z){l.downloads.splice(d,1);break}else if(e==="mainPlaylistEntity"&&T.playlistItem===z){l.downloads.splice(d,1);break}return g.k(m,qo(N,{mode:"readwrite",sR:!0},function(n){var P=[Xw(n,K,"mainDownloadsLibraryEntity")];
l&&P.push(Xw(n,l,"mainDownloadsListEntity"));W&&P.push(Xw(n,W,"mainDownloadsListEntity"));return g.TJ.all(P)}),0)})},mY=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W,G;
return g.S(function(x){if(x.W==1)return v=g.qJ(z,"transfer"),R=g.qJ(z,"videoDownloadContextEntity"),g.k(x,qo(N,{mode:"readonly",sR:!0},function(e){return g.TJ.all([tP(e,v,"transfer"),tP(e,R,"videoDownloadContextEntity")])}),2);
C=x.V;Z=g.f(C);Y=Z.next().value;Q=Z.next().value;L=Y;K=Q;G={videoId:z,cotn:(l=L)==null?void 0:l.cotn,offlineModeType:(W=K)==null?void 0:W.offlineModeType};return x.return(G)})},$f=function(N,z,v,R,C){var Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n,P,V,D,c,r,Rv;
return g.S(function(Zu){switch(Zu.W){case 1:return Z=g.qJ(N,"musicTrack"),Y=g.qJ(N,"transfer"),g.k(Zu,qo(z,{mode:"readonly",sR:!0},function(Nx){return g.TJ.all([tP(Nx,Z,"musicTrack"),tP(Nx,Y,"transfer"),Oa(Nx,"musicTrack"),Oa(Nx,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:Q=Zu.V;L=g.f(Q);K=L.next().value;l=L.next().value;W=L.next().value;G=L.next().value;x=K;e=l;d=W;T=G;if(!x){Zu.Zp(3);break}return g.k(Zu,kBr(x,d),4);case 4:return m=Zu.V,g.k(Zu,sy(m),3);case 3:n=[];P=g.f(T);for(V=P.next();!V.done;V=P.next())D=V.value,c=g.cy(D.key).entityId,r=fp(D),Rv=g.cy(r.action.entityKey).entityId,c!==N&&Rv!==N||xf(v,D.actionProto)||n.push(D.key);return g.k(Zu,qo(z,{mode:"readwrite",sR:!0},function(Nx){var av=n.map(function(M){return r7(Nx,M)});
av.push(r7(Nx,Z,{Go:!0}));return g.TJ.all(av)}),6);
case 6:eQ(e),C&&ar(C),iA(R,{entityKey:Z,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.fO(Zu)}})},Uy=function(N,z,v,R,C){var Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n,P,V,D,c,r,Rv,Zu,Nx,av,M,s2,$m,O2,m7,QU,BU,mu,Y5,F,jI,rE,TM;
return g.S(function(gE){switch(gE.W){case 1:return Z=g.qJ(N,z),Y=g.qJ("music_downloads_library_id","musicDownloadsLibraryEntity"),g.k(gE,qo(v,{mode:"readonly",sR:!0},function(x5){return g.TJ.all([tP(x5,Z,z),tP(x5,Y,"musicDownloadsLibraryEntity"),Oa(x5,z),Oa(x5,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:Q=gE.V;L=g.f(Q);K=L.next().value;l=L.next().value;W=L.next().value;G=L.next().value;x=K;e=l;d=W;T=G;if(!x){gE.Zp(3);break}return g.k(gE,kBr(x,d),4);case 4:return m=gE.V,g.k(gE,sy(m),3);case 3:n=[];P=new Map;if(!x){gE.Zp(6);break}return g.k(gE,P67(x,d,e),7);case 7:n=gE.V;V=g.f(n);for(D=V.next();!D.done;D=V.next())c=D.value,r=g.cy(c).entityId,P.set(r,{videoId:r,playlistId:N,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.k(gE,NC(v,"transfer"),8);case 8:for(Rv=gE.V,Zu=
g.f(Rv),Nx=Zu.next();!Nx.done;Nx=Zu.next())av=Nx.value,M=g.cy(av.key).entityId,(s2=P.get(M))&&av&&(s2.cotn=av.cotn);case 6:$m=[];O2=g.f(T);for(m7=O2.next();!m7.done;m7=O2.next())QU=m7.value,BU=g.cy(QU.key).entityId,mu=fp(QU),BU!==N&&mu.rootActionId!==N||xf(R,QU.actionProto)||$m.push(QU.key);Y5=g.qJ(N,z);return g.k(gE,qo(v,{mode:"readwrite",sR:!0},function(x5){var Du=$m.map(function(SV){return r7(x5,SV)});
Du.push(r7(x5,Y5,{Go:!0}));return g.TJ.all(Du)}),9);
case 9:if(!x){gE.Zp(0);break}n.reverse();if(!n.length){gE.Zp(0);break}F=g.f(n);jI=F.next();case 12:if(jI.done){gE.Zp(0);break}rE=jI.value;TM=g.cy(rE).entityId;if(!TM){gE.Zp(13);break}return g.k(gE,$f(TM,v,R,C,P.get(TM)),13);case 13:jI=F.next(),gE.Zp(12)}})},Bg=function(N,z,v){var R,C,Z,Y,Q,L,K;
return g.S(function(l){if(l.W==1)return g.k(l,qo(N,{mode:"readwrite",sR:!0},function(W){var G=Oa(W,"transfer"),x=Oa(W,"offlineOrchestrationActionWrapperEntity");return g.TJ.all([G,x]).then(function(e){e=g.f(e);var d=e.next().value;var T=e.next().value;e=VU7.map(function(V){return yLl(W,V)});
T=g.f(T);for(var m=T.next();!m.done;m=T.next()){m=m.value;var n=g.cy(m.actionProto.entityKey).entityType==="musicTrack",P=m.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";xf(z,m.actionProto)||n&&(!n||P)||e.push(r7(W,m.key,{Go:!0}))}return g.TJ.all(e).then(function(){return d})})}),2);
R=l.V;C=g.f(R);for(Z=C.next();!Z.done;Z=C.next())Y=Z.value,eQ(Y),Q=g.cy(Y.key).entityId,L={videoId:Q,offlineDeleteReason:void 0,cotn:Y.cotn},ar(L),K=g.qJ(Q,"musicTrack"),iA(v,{entityKey:K,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.k(l,yh8(),0)})},SP9=function(N){for(var z,v=g.f(N.additionalMetadatas),R=v.next();!R.done;R=v.next())R=R.value,R.offlineMusicVideoData&&(z=R.offlineMusicVideoData);
var C,Z,Y,Q,L;return{id:g.qJ(N.videoId,"musicTrack"),videoId:N.videoId,title:N.title,thumbnailDetails:N.thumbnail,lengthMs:String(Number(N.lengthSeconds)*1E3),albumTitle:(C=z)==null?void 0:C.releaseTitle,musicVideoType:(Z=z)==null?void 0:Z.musicVideoType,contentRating:{explicitType:(Y=z)==null?void 0:Y.explicitType},artistNames:((Q=z)==null?void 0:Q.byline)||((L=z)==null?void 0:L.channelName),downloadMetadata:g.qJ(N.videoId,"musicTrackDownloadMetadataEntity")}},P67=function(N,z,v){var R,C,Z,Y,Q,L,
K,l,W,G,x,e,d,T,m,n,P,V;
return g.S(function(D){R=[];C=new Set;if((Z=v)==null?0:(Y=Z.downloadedTracks)==null?0:Y.length)for(Q=g.f(v.downloadedTracks),L=Q.next();!L.done;L=Q.next())K=L.value,C.add(K);if(N.tracks){l=g.f(N.tracks);for(W=l.next();!W.done;W=l.next())G=W.value,C.has(G)||R.push(G);x=g.f(z);for(e=x.next();!e.done;e=x.next())if(d=e.value,d.id!==N.id&&(T=d.tracks))for(m=g.f(T),n=m.next();!n.done;n=m.next())P=n.value,V=R.indexOf(P),V!==-1&&R.splice(V,1)}return D.return(R)})},kBr=function(N,z){var v,R,C,Z,Y,Q,L,K;
return g.S(function(l){v=Jw(N.thumbnailDetails);R=g.f(z);for(C=R.next();!C.done;C=R.next())if(Z=C.value,Z.id!==N.id)for(Y=g.f(Jw(Z.thumbnailDetails)),Q=Y.next();!Q.done;Q=Y.next())L=Q.value,K=v.indexOf(L),K!==-1&&v.splice(K,1);return l.return(v)})},ECW=function(N,z){var v,R,C,Z,Y,Q,L,K,l;
return g.S(function(W){if(W.W==1)return v=g.qJ("music_downloads_library_id","musicDownloadsLibraryEntity"),g.k(W,w7(N,v,"musicDownloadsLibraryEntity"),2);(R=W.V)||(R={id:v});C=g.cy(z).entityType;C==="musicTrack"?(Z=R.downloadedTracks)!=null&&Z.includes(z)||(R.downloadedTracks=((Y=R.downloadedTracks)!=null?Y:[]).concat(z)):C==="musicPlaylist"?(Q=R.downloadedPlaylists)!=null&&Q.includes(z)||(R.downloadedPlaylists=((L=R.downloadedPlaylists)!=null?L:[]).concat(z)):C!=="musicAlbumRelease"||(K=R.downloadedAlbumReleases)!=
null&&K.includes(z)||(R.downloadedAlbumReleases=((l=R.downloadedAlbumReleases)!=null?l:[]).concat(z));return g.k(W,Mo(N,R,"musicDownloadsLibraryEntity"),0)})},hr5=function(N,z){var v,R,C,Z,Y,Q,L;
return g.S(function(K){if(K.W==1)return v=g.qJ("music_downloads_library_id","musicDownloadsLibraryEntity"),g.k(K,w7(N,v,"musicDownloadsLibraryEntity"),2);R=K.V;if(!R)return K.Zp(0);C=g.cy(z).entityType;C==="musicTrack"?Z=R.downloadedTracks:C==="musicPlaylist"&&(Z=R.downloadedPlaylists);if((Y=Z)==null?0:Y.length)for(Q=0;Q<Z.length;Q++)if(L=Z[Q],L===z){Z.splice(Q,1);break}return g.k(K,Mo(N,R,"musicDownloadsLibraryEntity"),0)})},H$r=function(N){var z=N.videos;
N=[];var v=[];if(z){z=g.f(z);for(var R=z.next();!R.done;R=z.next()){var C=R.value.offlineVideoData.videoId;R=g.qJ(C,"musicTrack");C=g.qJ(C,"musicTrackDownloadMetadataEntity");N.push(R);v.push(C)}}return{M5:N,B$:v}},Aw=function(N,z,v){z={track:SP9(z)};
v&&(z.playlistId=v);if(N=g.t(N.actionMetadata,oC5))z.maximumDownloadQuality=N.maximumDownloadQuality;return{musicTrackEntityActionMetadata:z}},b$w=function(N){var z,v,R,C,Z,Y,Q,L;
return g.S(function(K){switch(K.W){case 1:return z=g.ZX(),v=o7r(N),R=g.N3(Dmw),g.d_(K,2),Z={xC:!0},g.k(K,g.rZ(z,v,R,void 0,Z),4);case 4:C=K.V;g.nO(K,3);break;case 2:Y=g.U2(K);if(Y instanceof g.vy)throw Q="GetOffline network manager error: "+Y.message,Zc(Q,Y),Error(Q);Zc("GetOffline fetch request error",Y);throw Error("GetOffline fetch request error");case 3:L=gh(C);if(!C)throw Zc("Network request failed"),Error("Network request failed");if(L!==void 0)pp(L);else if(!C.videos||!C.videos.length)throw Zc("No data"),
Error("No data");return K.return(C.videos.map(function(l){return l.offlineVideoData}))}})},tUr=function(N){var z,v,R,C,Z,Y,Q,L;
return g.S(function(K){switch(K.W){case 1:return z=g.ZX(),v=Dn9(N),R=g.N3(Dmw),g.d_(K,2),Z={xC:!0},g.k(K,g.rZ(z,v,R,void 0,Z),4);case 4:C=K.V;g.nO(K,3);break;case 2:Y=g.U2(K);if(Y instanceof g.vy)throw Q="GetOffline network manager error for playlist: "+Y.message,Zc(Q,Y),Error(Q);Zc("GetOffline fetch request error for playlist",Y);throw Error("GetOffline fetch request error for playlist");case 3:L=gh(C);if(!C)throw Zc("Network request failed for playlist"),Error("Network request failed for playlist");
if(L!==void 0)pp(L,"playlist");else if(!C.playlists||!C.playlists.length)throw Zc("No data for playlist"),Error("No data for playlist");return K.return(C.playlists.map(function(l){return l.offlinePlaylistData}))}})},ItP=function(N,z,v,R){var C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n,P,V,D,c,r,Rv,Zu,Nx,av,M,s2,$m,O2,m7,QU;
return g.S(function(BU){switch(BU.W){case 1:return g.k(BU,zm(),2);case 2:C=BU.V;if(!C)return BU.return([]);Z=[];if((Y=R)==null?0:Y.length){Z=R;BU.Zp(3);break}return g.k(BU,NC(C,"mainPlaylistEntity"),4);case 4:Z=BU.V;case 3:if(!Z.length)return BU.return([]);Q=[];L=Date.now()/1E3;K=g.f(Z);l=K.next();case 5:if(l.done)return Q.length?g.k(BU,O$P(Q),10):BU.return([]);W=l.value;if(!W.downloadState){G=void 0;BU.Zp(8);break}return g.k(BU,w7(C,W.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:G=
BU.V;case 8:x=G;e=void 0;T=(d=(e=W)==null?void 0:e.entityMetadata)&&d.nextAutoRefreshIntervalSeconds?Number(d.nextAutoRefreshIntervalSeconds):NaN;m=Number.isNaN(T)?N:T;P=n=void 0;V=((n=x)==null?0:n.lastSyncedTimestampMillis)?Number((P=x)==null?void 0:P.lastSyncedTimestampMillis)/1E3:0;c=D=void 0;r=((D=x)==null?0:D.addedTimestampMillis)?Number((c=x)==null?void 0:c.addedTimestampMillis)/1E3:0;if(v||!d||V+m<=L){Rv=[];Zu=void 0;if((Zu=W.videos)==null?0:Zu.length)for(Nx=g.f(W.videos),av=Nx.next();!av.done;av=
Nx.next())M=av.value,s2=JSON.parse(g.cy(M).entityId),s2.videoId&&Rv.push(s2.videoId);$m="0";d&&(O2=void 0,$m=String(Number((O2=d.offlineLastModifiedTimestampSeconds)!=null?O2:0).toFixed()));m7={playlistId:W.playlistId,videoIds:Rv,offlineLastModifiedTimestamp:$m,autoSync:z,offlineDateAddedTimestamp:String(r.toFixed())};Q.push(m7)}l=K.next();BU.Zp(5);break;case 10:return QU=BU.V,BU.return(QU)}})},XwV=function(){var N,z,v,R,C;
return g.S(function(Z){if(Z.W==1)return g.k(Z,zm(),2);if(Z.W!=3)return(N=Z.V)?g.k(Z,NC(N,"refresh"),3):Z.return(!1);z=Z.V;if((v=z[0])==null||!v.refreshTime)return Z.return(!1);R=Number(z[0].refreshTime);C=Date.now()/1E3;return Z.return(isFinite(R)&&C>=R)})},u9V=function(N,z){var v,R,C;
return g.S(function(Z){switch(Z.W){case 1:return g.d_(Z,2),g.k(Z,rh9(N,z),4);case 4:return R=Z.V,g.k(Z,mmV(R),5);case 5:v=UmW(R);g.nO(Z,3);break;case 2:C=g.U2(Z),Zc("getAndProcessSmartDownloadsResponse request or processing error",C);case 3:return Z.return(v)}})},ch8=function(N,z,v,R){var C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n,P,V,D,c,r,Rv,Zu,Nx,av,M,s2,$m,O2,m7,QU;
return g.S(function(BU){switch(BU.W){case 1:return g.k(BU,zm(),2);case 2:C=BU.V;if(!C)return BU.return([]);Z=[];if((Y=R)==null?0:Y.length){Z=R;BU.Zp(3);break}return g.k(BU,NC(C,"musicPlaylist"),4);case 4:Z=BU.V;case 3:if(!Z.length)return BU.return([]);Q=[];L=Date.now()/1E3;K=g.f(Z);l=K.next();case 5:if(l.done)return Q.length?g.k(BU,O$P(Q),10):BU.return([]);W=l.value;G=void 0;e=(x=(G=W)==null?void 0:G.entityMetadata)&&x.nextAutoRefreshIntervalSeconds?Number(x.nextAutoRefreshIntervalSeconds):NaN;d=
Number.isNaN(e)?N:e;m=T=0;n="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!W.downloadMetadata){BU.Zp(8);break}return g.k(BU,w7(C,W.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:P=BU.V,D=V=void 0,T=Number((D=(V=P)==null?void 0:V.addedTimestampMillis)!=null?D:"0")/1E3,r=c=void 0,m=Number((r=(c=P)==null?void 0:c.lastModifiedTimestampMillis)!=null?r:"0")/1E3,Zu=Rv=void 0,n=(Zu=(Rv=P)==null?void 0:Rv.syncState)!=null?Zu:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:Nx=void 0;if(v||n!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!x||Number((Nx=x.lastSyncedTimestampSeconds)!=null?Nx:0)+d<=L){av=[];M=void 0;if((M=W.tracks)==null?0:M.length)for(s2=g.f(W.tracks),$m=s2.next();!$m.done;$m=s2.next())O2=$m.value,av.push(g.cy(O2).entityId);m7={playlistId:W.playlistId,videoIds:av,offlineLastModifiedTimestamp:String(m.toFixed()),autoSync:z,offlineDateAddedTimestamp:String(T.toFixed())};Q.push(m7)}l=K.next();BU.Zp(5);break;case 10:return QU=BU.V,BU.return(QU)}})},rh9=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W;
return g.S(function(G){switch(G.W){case 1:return v=g.ZX(),g.k(G,zm(),2);case 2:R=G.V;if(!R){G.Zp(3);break}return g.k(G,up5(R),4);case 4:C=G.V;case 3:var x=C;Z={context:g.q2(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:N},offlineClientState:x,clientStateRequestData:{preferredFormatType:z}}}};Y=g.N3(qPP);g.d_(G,5);L={xC:!0};return g.k(G,g.rZ(v,Z,Y,void 0,L),7);case 7:Q=G.V;g.nO(G,6);break;case 5:K=g.U2(G);if(K instanceof g.vy)throw l=
"DPS network manager error for smart downloads: "+K.message,Zc(l,K),Error(l);Zc("DPS fetch request error for smart downloads",K);throw Error("DPS fetch request error for smart downloads");case 6:W=gh(Q);if(Q)W!==void 0&&pp(W,"smart downloads");else throw Zc("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return G.return(Q)}})},ww7=function(N,z){var v,R,C,Z,Y,Q,L,K;
return g.S(function(l){switch(l.W){case 1:return v=g.ZX(),R={context:g.q2(),videoPlaybackPositionEntities:N,lastSyncTimestampUsec:z},C=g.N3(MUP),g.d_(l,2),Y={xC:!0},g.k(l,g.rZ(v,R,C,void 0,Y),4);case 4:Z=l.V;g.nO(l,3);break;case 2:Q=g.U2(l);if(Q instanceof g.vy)throw L="VPPS network manager error: "+Q.message,Zc(L,Q),Error(L);Zc("VPPS fetch request error",Q);throw Error("VPPS fetch request error");case 3:K=gh(Z);if(Z)K!==void 0&&pp(K,"position sync");else throw Zc("Network request failed for position sync"),
Error("Network request failed for position sync");return l.return(Z)}})},z3m=function(N,z,v){var R,C,Z,Y,Q,L,K,l;
return g.S(function(W){switch(W.W){case 1:R=g.ZX();var G=v.refreshData,x=v.isEnqueuedForExpiredStreamUrlRefetch,e=v.q0,d=v.offlineSourceData,T=v.mediaCapabilities,m={entityKey:N};G&&(m.refreshData=G);x&&(m.isExpiredStreamUrlRefetch=x);e&&(m.downloadParameters=e);d&&(m.offlineSourceData=d);G={context:g.C2(z),signatureTimestamp:20208,videos:[m]};T&&(G.mediaCapabilities=T);C=G;Z=g.N3(Ns1);g.d_(W,2);Q={xC:!0};return g.k(W,g.rZ(R,C,Z,void 0,Q),4);case 4:Y=W.V;g.nO(W,3);break;case 2:L=g.U2(W);if(L instanceof
g.vy)throw K="GetPDE network manager error: "+L.message,Zc(K,L),Error(K);Zc("GetPDE fetch request error",L);throw Error("GetPDE fetch request error");case 3:l=gh(Y);if(Y)l!==void 0&&pp(l,"PDE");else throw Zc("Network request failed for PDE"),Error("Network request failed for PDE");return W.return(Y)}})},gh=function(N){var z;
return(z=N.errorMetadata)==null?void 0:z.status},pp=function(N,z){z=z?" for "+z:"";
if(N===0)throw N="Empty response body"+z,Zc(N),Error(N);N="Response with error"+z;Zc(N);throw Error(N);},O$P=function(N){var z,v,R,C,Z,Y,Q,L;
return g.S(function(K){switch(K.W){case 1:return z=g.ZX(),v=bx7(N),R=g.N3(vZ9),g.d_(K,2),Z={xC:!0},g.k(K,g.rZ(z,v,R,void 0,Z),4);case 4:C=K.V;g.nO(K,3);break;case 2:Y=g.U2(K);if(Y instanceof g.vy)throw Q="offlinePlaylistSyncCheck network manager error: "+Y.message,Zc(Q,Y),Error(Q);Zc("offlinePlaylistSyncCheck fetch request error",Y);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:L=gh(C);if(!C)throw Zc("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(L!==void 0)pp(L,"playlist sync");else if(!C.offlinePlaylistSyncCheckDatas||!C.offlinePlaylistSyncCheckDatas.length)throw Zc("No data for playlist sync"),Error("No data for playlist sync");return K.return(C.offlinePlaylistSyncCheckDatas.map(function(l){return l.offlinePlaylistSyncCheckData}))}})},kf=function(N){this.V=N},R31=function(N,z){var v,R,C,Z,Y,Q;
return g.S(function(L){switch(L.W){case 1:v=new Map,R=g.f(z),C=R.next();case 2:if(C.done){L.Zp(4);break}Z=C.value;Y=v;Q=Y.set;return g.k(L,N.W(Z),5);case 5:Q.call(Y,Z,L.V);C=R.next();L.Zp(2);break;case 4:return L.return(v)}})},Pg=function(N,z,v,R,C,Z){z=g.qJ(z,v);
R=Object.assign({},Z,{priority:R,retryScheduleIntervalsInSeconds:C});return{actionType:N,entityKey:z,actionMetadata:R}},VH=function(N,z,v,R,C,Z){this.status=N;
this.V=z;this.N=v;this.W=R;this.Z=C;this.downloadState=Z},CkW=function(N,z,v){this.V=N;
this.iS=z;this.Z=v},ijw=function(N,z){var v,R,C,Z,Y,Q,L,K,l;
return g.S(function(W){switch(W.W){case 1:return v=z.entityKey,C=(R=g.t(z.actionMetadata,SQ))==null?void 0:R.isEnqueuedForExpiredStreamUrlRefetch,g.d_(W,2),Z=void 0,g.k(W,Zjr(N,z),4);case 4:Z=W.V;g.d_(W,5);var G=(G=g.t(z.actionMetadata,SQ))?{maximumDownloadQuality:G.maximumDownloadQuality}:void 0;return g.k(W,z3m(v,N.iS,{isEnqueuedForExpiredStreamUrlRefetch:C,q0:G,offlineSourceData:Z}),7);case 7:Y=W.V;g.nO(W,6,2);break;case 5:return g.U2(W,2),Q=Lp(z)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Zc("PDE handleAdd error"),W.return(Ey(z,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",Q,"DOWNLOAD_STATE_FAILED"));case 6:return g.k(W,Yow(N,Y,z),8);case 8:return W.return(Ey(z,!0,Y.orchestrationActions));case 2:return L=g.U2(W),K="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",L instanceof g.xp&&L.type==="QUOTA_EXCEEDED"&&(K="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Zc("PDE handleAdd error"),W.return(Ey(z,!1,void 0,K,l,"DOWNLOAD_STATE_FAILED"))}})},QHr=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n,P,V,D,c,r,Rv,Zu;
return g.S(function(Nx){switch(Nx.W){case 1:return v=z.entityKey,R=g.cy(v).entityId,g.k(Nx,qo(N.V,{mode:"readonly",sR:!0},function(av){var M=tP(av,v,"playbackData"),s2=tP(av,g.qJ(R,"offlineVideoPolicy"),"offlineVideoPolicy");av=tP(av,g.qJ(R,"transfer"),"transfer");return g.TJ.all([M,s2,av])}),2);
case 2:C=Nx.V;Z=g.f(C);Y=Z.next().value;Q=Z.next().value;L=Z.next().value;K=Y;l=Q;W=L;if(!K||!l)return Nx.return(Ey(z,!0));G=[];d=((e=K)==null?0:e.playerResponseJson)?JSON.parse(K.playerResponseJson):null;if(!(W&&d&&N.iS.X("html5_refresh_deprecated_downloads"))){Nx.Zp(3);break}x=jH8(N,d,W);return g.k(Nx,aF1(N,W),4);case 4:G=Nx.V;case 3:T={lastPlayerResponseTimestampSeconds:K.playerResponseTimestamp,offlineToken:l.offlineToken,formatIds:G};m={};if((n=W)==null?0:n.maximumDownloadQuality)m.maximumDownloadQuality=
W.maximumDownloadQuality;g.d_(Nx,5);P=void 0;return g.k(Nx,Zjr(N,z),7);case 7:return P=Nx.V,g.d_(Nx,8),g.k(Nx,z3m(v,N.iS,{refreshData:T,q0:m,offlineSourceData:P,mediaCapabilities:x}),10);case 10:V=Nx.V;g.nO(Nx,9,5);break;case 8:return g.U2(Nx,5),D=Lp(z)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Zc("PDE handleRefresh error"),Nx.return(Ey(z,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",D,
"DOWNLOAD_STATE_FAILED"));case 9:return g.k(Nx,Yow(N,V,z),11);case 11:return Nx.return(Ey(z,!0,V.orchestrationActions));case 5:return c=g.U2(Nx),r="PDE handleRefresh error",c instanceof Error&&(r="PDE handleRefresh error: "+c.message),Rv="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Zu="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.xp&&c.type==="QUOTA_EXCEEDED"&&(Rv="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Zu="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Zc(r),Nx.return(Ey(z,!1,void 0,Rv,Zu,"DOWNLOAD_STATE_FAILED"))}})},Zjr=function(N,z){var v,R,C,Z;
return g.S(function(Y){if(Y.W==1)return v=g.cy(z.entityKey).entityId,R=g.qJ(v,"videoDownloadContextEntity"),g.k(Y,w7(N.V,R,"videoDownloadContextEntity"),2);C=Y.V;return(Z=C)!=null&&Z.offlineModeType?Y.return({offlineModeType:C.offlineModeType}):Y.return(void 0)})},Yow=function(N,z,v){var R,C,Z,Y,Q;
return g.S(function(L){if(L.W==1){if(!z.frameworkUpdates||!g.t(z.frameworkUpdates,np))return L.return();if(!(g.t(z.frameworkUpdates,np).mutations&&g.t(z.frameworkUpdates,np).mutations.length>0&&g.t(z.frameworkUpdates,np).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return L.Zp(2);R=g.cy(g.t(z.frameworkUpdates,np).mutations[0].entityKey).entityId;return g.k(L,mY(N.V,R),3)}if(L.W!=2){C=L.V;Z=g.t(v.actionMetadata,SQ);if(Q=(Y=Z)==null?void 0:Y.playlistId)C.playlistId=Q;C.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.ci(N.iS)?g.k(L,Fx(R,N.V,v,N.Z,C),2):g.S0(N.iS)?g.k(L,$f(R,N.V,v,N.Z),2):L.Zp(2)}return g.k(L,psE(g.t(z.frameworkUpdates,np)),0)})},Ey=function(N,z,v,R,C,Z){return new VH(z?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Lp(N),v,R,C,Z)},jH8=function(N,z,v){z=erl(N.iS,v.cotn,z);
v=g.jM(z);return g.uyx(z,v,N.iS)},aF1=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W,G;
return g.S(function(x){if(x.W==1)return v=[],g.k(x,qo(N.V,{mode:"readonly",sR:!0},function(e){var d=[],T=z.offlineVideoStreams;if(T){T=g.f(T);for(var m=T.next();!m.done;m=T.next())d.push(tP(e,m.value,"offlineVideoStreams"))}return g.TJ.all(d)}),2);
if(R=x.V)for(C=g.f(R),Z=C.next();!Z.done;Z=C.next())if(Y=Z.value,Q=void 0,(Q=Y)==null?0:Q.streamsProgress)for(L=Y.streamsProgress,K=0;K<L.length;K++)l=L[K],W=JSON.parse(l.formatStreamBytes),G={itag:W.itag,lmt:W.lastModified,xtags:W.xtags},v.push(G);return x.return(v)})},Lqw=function(N,z){this.V=N;
this.iS=z},KqE=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W,G,x;
return g.S(function(e){switch(e.W){case 1:return v=Lp(z),g.k(e,NC(N.V,"videoPlaybackPositionEntity"),2);case 2:R=e.V;if(R.length===0)return e.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));g.d_(e,3);return g.k(e,oU.getInstance(),5);case 5:C=e.V;if(!C)throw Error("prefStorage is undefined");return g.k(e,C.get("psi"),6);case 6:return Z=e.V,L=(Q=(Y=Z)==null?void 0:Y.ST)!=null?Q:"0",g.k(e,ww7(R,L),7);case 7:return K=e.V,l={isPaused:K.watchHistoryPaused,ST:K.syncTimestampUsec},g.k(e,C.set("psi",
l),8);case 8:if(l.isPaused){e.Zp(9);break}W=g.t(K.frameworkUpdates,np);if(!K.frameworkUpdates||!W){e.Zp(9);break}return g.k(e,psE(W),9);case 9:g.nO(e,4);break;case 3:return G=g.U2(e),x="PPE handleRefresh error: "+(G instanceof Error?G.message:"unknown error"),Zc(x),e.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return e.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v))}})},WqW=function(N,z){var v,R,C,Z,Y,Q,L,K;
return g.S(function(l){switch(l.W){case 1:return v=Lp(z),R=g.cy(z.entityKey).entityId,g.d_(l,2),g.k(l,oU.getInstance(),4);case 4:C=l.V;if(!C)throw Error("prefStorage is undefined");return g.k(l,C.get("psi"),5);case 5:Z=l.V;Y=g.t(z.actionMetadata,lFU);if(((Q=Z)==null?void 0:Q.isPaused)!==!1||(L=Y)==null||!L.lastPlaybackPositionSeconds){l.Zp(6);break}K={key:g.qJ(R,"videoPlaybackPositionEntity"),videoId:R,lastPlaybackPositionSeconds:Y.lastPlaybackPositionSeconds};return g.k(l,Mo(N.V,K,"videoPlaybackPositionEntity"),
6);case 6:g.nO(l,3);break;case 2:return g.U2(l),l.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return l.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v))}})},GE5=function(N,z){var v,R,C;
return g.S(function(Z){switch(Z.W){case 1:v=Lp(z);g.d_(Z,2);R=g.cy(z.entityKey).entityId;if(R==="!*$_ALL_ENTITIES_!*$")return g.k(Z,$n1(N.V),5);C=g.qJ(R,"videoPlaybackPositionEntity");return g.k(Z,mnr(N.V,C),5);case 5:g.nO(Z,3);break;case 2:return g.U2(Z),Z.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Z.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v))}})},xvV=function(N,z){this.api=N;
this.V=z;this.logger=new g.Ry("woffle");this.W=!1;this.Oi={AN:this.AN};this.logger.debug("Initialized OfflineMediaManager")},e3E=function(N){return g.S(function(z){return z.return(HxE(N))})},J4E=function(N){var z;
return g.S(function(v){if(v.W==1)return g.k(v,g.WIY(N),2);z=v.V;return v.return(z.filter(function(R){return!!R.url}).map(function(R){return R.url}))})},hw=function(N,z){var v=g.AK(z);
if(v===1||v===0)return Promise.resolve();(v=y45(N,z))&&v.stopVideo();N.Z=0;return e3E(z)},Hg=function(N,z,v,R){v=v===void 0?!1:v;
R=R===void 0?!0:R;var C=typeof z==="string"?z:z.videoDetails.videoId;g.AK(C)===2&&((z=y45(N,C))?z.stopVideo():N.logger.info(function(){return"Corresponding player for "+C+" not found. Pausing anyway"}),g.gi(C,2),N.Z=2,v?fFP(N.V):R&&dvP(N.V))},y45=function(N,z){var v;
return((v=N.player)==null?void 0:v.getVideoData().videoId)===z?N.player:null},sHr=function(N,z,v){z.getPlayerResponse();
g.gi(z.videoId,2);N.Z=2;N.W=!1;var R;(R=N.player)==null||R.dispose();N.player=N.api.Ap(z);z={};N.player.wy((z.localmediachange=N.JB,z.signatureexpired=N.LD,z.statechange=N.axp,z),N);var C=N.AN(v);N.player.cn(g.aS(C,C,!0,"m"),!1);N.logger.debug(function(){return"Starting headless playback with quality: "+C});
N.player.jW(!1)},Tsm=function(N,z){this.V=N;
this.iS=z},nZr=function(N,z){var v,R;
return g.S(function(C){switch(C.W){case 1:return v=Lp(z),g.k(C,w7(N.V,z.entityKey,"transfer"),2);case 2:if(R=C.V)return C.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));g.d_(C,3);return g.k(C,Fq9(N,z),5);case 5:g.nO(C,4);break;case 3:return g.U2(C),C.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return C.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v))}})},mvU=function(N,z){var v,R;
return g.S(function(C){switch(C.W){case 1:return v=Lp(z),g.k(C,w7(N.V,z.entityKey,"transfer"),2);case 2:R=C.V;if(!R||R.transferState!=="TRANSFER_STATE_COMPLETE")return C.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));g.d_(C,3);return g.k(C,Fq9(N,z,!0),5);case 5:g.nO(C,4);break;case 3:return g.U2(C),C.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return C.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v))}})},$vl=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W;
return g.S(function(G){switch(G.W){case 1:return v=Lp(z),R=g.cy(z.entityKey).entityId,g.k(G,qo(N.V,{mode:"readonly",sR:!0},function(x){var e=tP(x,z.entityKey,"transfer");x=tP(x,g.qJ(R,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.TJ.all([e,x])}),2);
case 2:C=G.V;Z=g.f(C);Y=Z.next().value;Q=Z.next().value;L=Y;K=Q;if(!L||L.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return G.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));g.d_(G,3);L.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.k(G,Mo(N.V,L,"transfer"),5);case 5:l=g.cy(L.key).entityId;L9W({videoId:l,vW:L,offlineModeType:(W=K)==null?void 0:W.offlineModeType});g.nO(G,4);break;case 3:return g.U2(G),G.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return G.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v))}})},Fq9=function(N,z,v){v=v===void 0?!1:v;
var R,C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m;return g.S(function(n){switch(n.W){case 1:return R=g.t(z.actionMetadata,Uv5),C=g.cy(z.entityKey).entityId,Z=g.qJ(C,"downloadStatusEntity"),g.k(n,qo(N.V,{mode:"readonly",sR:!0},function(P){var V=tP(P,Z,"downloadStatusEntity");P=tP(P,g.qJ(C,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.TJ.all([V,P])}),2);
case 2:return Y=n.V,Q=g.f(Y),L=Q.next().value,K=Q.next().value,l=L,W=K,G="TRANSFER_STATE_TRANSFER_IN_QUEUE",((x=l)==null?void 0:x.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(G="TRANSFER_STATE_PAUSED_BY_USER"),T={key:z.entityKey,transferState:G,cotn:g.sD(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(e=R)==null?void 0:e.maximumDownloadQuality,preferredAudioTrack:(d=R)==null?void 0:d.preferredAudioTrack,transferRetryCount:0,isRefresh:v,hasLoggedFirstStarted:!1},g.k(n,qo(N.V,
{mode:"readwrite",sR:!0},function(P){var V=[];v&&V.push(r7(P,g.qJ(C,"offlineVideoStreams")));V.push(Xw(P,T,"transfer"));return g.TJ.all(V)}),3);
case 3:if(!v){n.Zp(4);break}return g.k(n,e3E(C),4);case 4:atm({videoId:C,vW:T,offlineModeType:(m=W)==null?void 0:m.offlineModeType}),g.fO(n)}})},A4W=function(N,z,v,R){if(!N.action.entityKey)throw Error("entityKey is missing.");
var C=g.cy(N.action.entityKey);C={entityType:C.RF,entityId:C.entityId,offlineOrchestrationActionType:N.action.actionType,orchestrationAction:{orchestrationActionId:N.actionId}};z&&(C.offlineOrchestrationActionResult=z.status,C.isRetryable=v?!1:z.V,z.Z&&(C.offlineOrchestrationFailureReason=Bsm(z.Z,C.isRetryable)));var Z,Y;if((Z=N.action.actionMetadata)==null?0:(Y=Z.offlineLoggingData)==null?0:Y.offlineModeType)C.offlineModeType=N.action.actionMetadata.offlineLoggingData.offlineModeType;R&&(C.additionalOrchestrationActions=
R.map(function(Q){return{orchestrationActionId:Q.actionId}}));
return C},Bsm=function(N,z){return N!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||z?N==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&z?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":N:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},gZE=function(N,z){var v={offlineOrchestrationContext:A4W(N)};
z=XsP(z,v);rLZ(II1(),z,N.rootActionId)},pnW=function(N,z,v,R){R=R===void 0?[]:R;
z={offlineOrchestrationContext:A4W(N,z,v,R)};z=XsP(3,z);rLZ(II1(),z,N.rootActionId)},kE8=function(){this.actions=[]},Pkw=function(N,z){z=g.f(z);
for(var v=z.next();!v.done;v=z.next())v=v.value,gZE(v,1),N.actions.push(v);N.actions.sort(N.V)},Vjm=function(N,z){if(z)for(var v=0;v<N.actions.length;v++)if(z==="!*$_ALL_ENTITIES_!*$"&&N.actions[v].actionId!==z||z!=="!*$_ALL_ENTITIES_!*$"&&N.actions[v].rootActionId===z&&N.actions[v].actionId!==z)N.actions.splice(v,1),v--},So7=function(N,z){N=g.f(N.actions);
for(var v=N.next();!v.done;v=N.next())if(v.value.actionId===z)return!0;return!1},or=function(N,z,v,R,C){g.H.call(this);
var Z=this;this.W=N;this.PL=z;this.qd=v;this.L=R;this.iS=C;this.V=new kE8;this.G=new g.XC;this.Z=new g.cn(function(){Z.retry()});
this.Y=NaN;this.B=!1;this.Oi={eEd:function(){return Z.V},
pk:function(){return Z.G},
Ca8:function(){return Z.Z},
retry:function(){return Z.retry()}};
g.b(this,this.Z);this.J=this.W.observe(this.Vp.bind(this))},Hj8=function(N,z,v,R,C){var Z;
return g.S(function(Y){if(Y.W==1)return Z=new or(N,z,v,R,C),g.k(Y,EZU(Z),2);h3U(Z);return Y.return(Z)})},h3U=function(N){var z=N.V.actions[0];
return N.N?((z==null?void 0:z.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&N.N[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(N.B=!0),Promise.resolve()):oZr(N)},oZr=function(N){var z,v,R,C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m;
return g.S(function(n){switch(n.W){case 1:if(N.N)throw Error("Already processing an action");if(N.HL())return n.return();z=N.V.actions.shift();i$7(N.qd,!z);if(z===void 0)return n.return();z.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&z.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&Vjm(N.V,z.actionId);v="";z.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&z.rootActionId===z.actionId&&(v=z.actionId);R=[z];N.N=R;if(C=N.PL[z.entityType]){n.Zp(2);break}N.N=
void 0;return g.k(n,oZr(N),3);case 3:return n.return();case 2:Z=g.f(R);for(Y=Z.next();!Y.done;Y=Z.next())Q=Y.value,gZE(Q,2);g.d_(n,4,5);return g.k(n,R31(C,R.map(function(P){return P.action})),7);
case 7:L=n.V,K=g.f(R),l=K.next();case 8:if(l.done){n.Zp(10);break}W=l.value;G=L.get(W.action);return g.k(n,Dv8(N,W,G),9);case 9:l=K.next();n.Zp(8);break;case 10:Vjm(N.V,v);case 5:g.Ab(n);N.N=void 0;g.pO(n,6);break;case 4:return x=g.U2(n),Zc("Orchestration error",x),g.d_(n,12),g.k(n,bjE(N,R),14);case 14:g.nO(n,5);break;case 12:e=g.U2(n);Zc("Orchestration retry error",e);d=g.f(R);for(T=d.next();!T.done;T=d.next())m=T.value,m.retryScheduleIndex<3&&Pkw(N.V,[m]);n.Zp(5);break;case 6:return g.k(n,oZr(N),
0)}})},Dv8=function(N,z,v){var R,C,Z,Y,Q,L,K,l,W,G,x,e;
return g.S(function(d){switch(d.W){case 1:R=z.retryScheduleIndex+2===3;if(v.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){d.Zp(2);break}if(v.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){d.Zp(0);break}pnW(z,v,R);if(v.V&&z.retryScheduleIndex+1<3)return g.k(d,bjE(N,[z]),0);Z=((C=v)==null?0:C.W)?v.W:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";Y={entityKey:z.action.entityKey,failureReason:Z};Q=void 0;g.ci(N.iS)?Q="mainVideoDownloadStateEntity":g.S0(N.iS)&&(Q="musicTrackDownloadMetadataEntity");
if(!Q||!v.downloadState){d.Zp(7);break}L=g.cy(z.action.entityKey).entityId;return g.k(d,Gm(L,Q,N.W,v.downloadState),7);case 7:iA(N.L,Y);if(v.downloadState==="DOWNLOAD_STATE_FAILED"&&N.iS.X("html5_auto_retry_failed_pde_actions")){d.Zp(0);break}Zc("Orchestration result is not retryable, deleting action");return g.k(d,mnr(N.W,dh(z).key),0);case 2:K=void 0;try{K=(l=v.N)==null?void 0:l.map(function(T){return N.createAction(T,z)})}catch(T){return pnW(z,v,R),W={entityKey:z.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},iA(N.L,W),Zc("Orchestration subactions creation error",T),d.return()}pnW(z,v,R,K);if(!K){d.Zp(12);break}G=K.map(function(T){return dh(T)});
x=0;case 13:if(!(x<K.length)||N.B){d.Zp(15);break}return g.k(d,qo(N.W,{mode:"readwrite",sR:!0},function(T){var m=[];m.push(xnU(T,G.slice(x,x+10),"offlineOrchestrationActionWrapperEntity"));return g.TJ.all(m)}),16);
case 16:x+=10;d.Zp(13);break;case 15:if(N.B)return N.B=!1,d.return();case 12:return e=dh(z),g.k(d,mnr(N.W,e.key),17);case 17:gZE(z,4),g.fO(d)}})},Xnw=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W,G,x;
return g.S(function(e){v=[];R=Infinity;C=4E3;Z=g.f(z);for(Y=Z.next();!Y.done;Y=Z.next())Q=Y.value,L=Number(Q.enqueueTimeSec),K=tjV(L),l=Q.retryScheduleIndex,W=l!=null&&l>0,K>0&&W?(R=Math.min(R,L),C=Math.min(K,C)):v.push(Q);isFinite(R)&&(!N.Z.isActive()||R<N.Y)&&(N.Y=R,N.Z.start(C));N.G.r$()||(G=v.length,v=v.filter(function(d){var T;d=((T=d.actionProto)==null?void 0:T.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!Oj8.includes(d)}),x=v.length<G,!N.Z.isActive()&&x&&N.Z.start(1));
v.length>0&&IFZ(N,v);return g.k(e,h3U(N),0)})},uQr=function(N){var z,v,R,C,Z,Y,Q;
return g.S(function(L){if(L.W==1)return g.k(L,r45(N),2);z=L.V;v=[];R=g.f(z);for(C=R.next();!C.done;C=R.next())Z=C.value,Y=g.cy(Z.key),Q=Y.entityId,So7(N.V,Q)||v.push(Z);return g.k(L,Xnw(N,v),0)})},tjV=function(N){N=N*1E3-Date.now();
return N>4E3?4E3:N},bjE=function(N,z){var v,R,C;
return g.S(function(Z){v=g.f(z);for(R=v.next();!R.done;R=v.next()){C=R.value;var Y=void 0,Q=void 0,L=((Q=C.action)==null?void 0:(Y=Q.actionMetadata)==null?void 0:Y.retryScheduleIntervalsInSeconds)||[1,2,4];Y=1;C.retryScheduleIndex<L.length&&(Y=L[C.retryScheduleIndex]);C.V=Y*1E3+Date.now();C.retryScheduleIndex++}return g.k(Z,c4V(N,z),0)})},EZU=function(N){var z;
return g.S(function(v){if(v.W==1)return g.k(v,NC(N.W,"offlineOrchestrationActionWrapperEntity"),2);z=v.V;return g.k(v,Xnw(N,z),0)})},IFZ=function(N,z){z.length!==0&&z.forEach(function(v){v=fp(v);
v.retryScheduleIndex<3&&Pkw(N.V,[v])})},r45=function(N,z){var v;
return g.S(function(R){if(R.W==1)return g.k(R,NC(N.W,"offlineOrchestrationActionWrapperEntity",z),2);v=R.V;return R.return(v.filter(k5$))})},c4V=function(N,z){if(z.length===0)return Promise.resolve([]);
z=z.map(function(v){return dh(v)});
return n77(N.W,z)},qo5=function(N){this.L0=N;
this.V=void 0},Mj$=function(N,z){var v,R,C,Z;
return g.S(function(Y){v=z.videoId;R=!0;if(z.captionTracks.length)C=K$U(z),N.V=new g.Jk(N.L0,z,C);else if(z.er)Z=g.msU(z),N.V=new g.fL(N.L0,z.er,v,Z,z.gQ,z.eventId),R=z.gQ;else return Y.return();return Y.return(new Promise(function(Q){var L;(L=N.V)==null||L.dk({HK:function(){return g.S(function(K){if(K.W==1)return g.k(K,N.HK(v,R),2);Q();g.fO(K)})},
xP:function(){}})}))})},wn5=function(N){var z;
return g.S(function(v){if(v.W==1)return g.k(v,hk5(N),2);z=v.V;return v.return(!!z&&z.length>0)})},Dc=function(N){g.H.call(this);
this.V=N;this.W=this.V.observe(this.Z.bind(this))},NA5=function(N,z){var v,R,C,Z,Y,Q,L;
return g.S(function(K){switch(K.W){case 1:if(z.length===0)return K.return([]);v=z.map(function(l){return g.qJ(l,"transfer")});
return g.k(K,NC(N.V,"transfer",v),2);case 2:R=K.V;C=R.filter(k5$).map(function(l){return g.cy(l.key).entityId});
Z=z.filter(function(l){return C.indexOf(l)===-1});
if(Z.length===0)return K.return([]);Y=g.f(Z);Q=Y.next();case 3:if(Q.done){K.Zp(5);break}L=Q.value;return g.k(K,e3E(L),4);case 4:Q=Y.next();K.Zp(3);break;case 5:return K.return(Z)}})},R$w=function(N,z,v,R,C,Z){var Y,Q,L;
return g.S(function(K){Y="STREAM_TYPE_UNKNOWN";v.video&&v.audio?(Y="STREAM_TYPE_AUDIO_AND_VIDEO",Zc("unexpected stream type")):v.video&&!v.audio?Y="STREAM_TYPE_VIDEO":!v.video&&v.audio&&(Y="STREAM_TYPE_AUDIO");Q=g.qJ(z,"offlineVideoStreams");L={numBytesDownloaded:C.toFixed(),numTotalBytes:Z.toFixed(),streamType:Y,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(R),itag:Y==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(v.itag):void 0};return g.k(K,qo(N,{mode:"readwrite",sR:!0},
function(l){var W=tP(l,Q,"offlineVideoStreams"),G=tP(l,g.qJ(z,"transfer"),"transfer");return g.TJ.all([W,G]).then(function(x){x=g.f(x);var e=x.next().value;x=x.next().value;if(!x)return r7(l,Q).then(function(){});
var d=z$7(e);e=veP(e,R,L,Q);var T=Xw(l,e,"offlineVideoStreams");z$7(e)>d&&(x.lastProgressTimeMs=Date.now().toString());d=[T];x.offlineVideoStreams||(x.offlineVideoStreams=[]);x.offlineVideoStreams.indexOf(Q)===-1&&(x.offlineVideoStreams.push(Q),d.push(Xw(l,x,"transfer")));return g.TJ.all(d)})}),0)})},CPZ=function(N,z){var v,R,C,Z,Y;
return g.S(function(Q){if(Q.W==1)return v=g.qJ(z,"offlineVideoStreams"),g.k(Q,w7(N,v,"offlineVideoStreams"),2);R=Q.V;if(!R||!R.streamsProgress)return Q.return();C=g.f(R.streamsProgress);for(Z=C.next();!Z.done;Z=C.next())Y=Z.value,Y.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",Y.numTotalBytes!==Y.numBytesDownloaded&&(Y.numBytesDownloaded=Y.numTotalBytes);return g.k(Q,Mo(N,R,"offlineVideoStreams"),0)})},veP=function(N,z,v,R){if(N&&N.streamsProgress){R=N;
a:{z=z.itag+";"+z.xtags;for(var C=N.streamsProgress,Z=0;Z<C.length;Z++){var Y=JSON.parse(C[Z].formatStreamBytes);if(Y.itag+";"+Y.xtags===z){C[Z]=v;v=C;break a}}C.push(v);v=C}R.streamsProgress=v}else N={key:R,streamsProgress:[v]};return N},z$7=function(N){if(N==null?0:N.streamsProgress){var z=0;
N=N.streamsProgress;for(var v=0;v<N.length;v++){var R=N[v];isNaN(Number(R.numBytesDownloaded))?Zc("stream progress bytes number invalid"):z+=Number(R.numBytesDownloaded)}return z}return 0},Z6U=function(N,z,v,R){g.H.call(this);
var C=this;this.W=N;this.api=z;this.UT=v;this.Vp=R;this.G=new g.XC;this.N=new g.cn(function(){C.V&&C.V.transferState==="TRANSFER_STATE_TRANSFERRING"&&C.G.r$()&&((C.V.transferRetryCount||0)<3?Hg(C.L,C.B,!1,!1):hw(C.L,C.B.videoDetails.videoId),C.wk("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.qd=this.Rd=0;this.J=this.Y=!1;this.S8=g.LM(this.api.D().experiments,"html5_transfer_processing_logs_interval");this.BL=new g.VV(this);this.Oi={Bd0:function(){return C.N},
qOd:function(){return C.Vp},
pk:function(){return C.G}};
this.PL=this.W.observe(this.d2.bind(this));this.L=new xvV(z,this);this.vL=new qo5(z);this.K0=new Dc(this.W);this.tO=this.G.listen("publicytnetworkstatus-online",this.At.bind(this));this.Id=this.G.listen("publicytnetworkstatus-offline",this.LQT.bind(this));this.J=this.api.D().X("html5_less_transfer_processing_logs");g.b(this,this.BL);this.BL.S(z,"offlinetransferpause",this.UvT);g.ci(this.api.D())?this.Z="mainVideoDownloadStateEntity":g.S0(this.api.D())&&(this.Z="musicTrackDownloadMetadataEntity")},
Yb5=function(N){return g.S(function(z){if(z.W==1)z=g.k(z,Sl9(),2);
else{var v=N.K0;var R=g.B3();R=Object.keys(R);v=NA5(v,R);z=g.k(z,v,0)}return z})},tw=function(N,z){z=z===void 0?!1:z;
var v;return g.S(function(R){if(R.W==1){if(N.V)throw Error("Already downloading a video");N.qd=0;N.Y=!1;return g.k(R,i6r(N),2)}return R.W!=4?(v=R.V,j9w(N.UT,!v),v&&N.G.r$()?z?g.k(R,new Promise(function(C){g.W9(C,1E3)}),4):R.Zp(4):(!v&&N.V&&bA(N),R.Zp(0))):g.k(R,jO8(N,v),0)})},adl=function(N){return g.S(function(z){if(z.W==1)return N.B?g.k(z,hw(N.L,N.B.videoDetails.videoId),3):z.Zp(0);
bA(N);g.fO(z)})},QOW=function(N,z){var v,R,C;
return g.S(function(Z){switch(Z.W){case 1:return g.d_(Z,2),(v=!!z.captionTracks.length||!!z.er)?g.k(Z,wn5(z.videoId),4):Z.return();case 4:return(R=Z.V)?Z.return():g.k(Z,Mj$(N.vL,z),5);case 5:g.nO(Z,0);break;case 2:C=g.U2(Z),Zc("Caption downloading error",C,z.cotn),g.fO(Z)}})},jO8=function(N,z){var v,R,C,Z,Y,Q;
return g.S(function(L){switch(L.W){case 1:if(N.Y)return L.return();N.Y=!0;N.V=z;v=g.cy(N.V.key);R=v.entityId;C=void 0;if(N.V.transferState==="TRANSFER_STATE_TRANSFERRING")return g.k(L,Oy(N,R),7);if(N.V.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||N.V.transferRetryCount||N.V.hasLoggedFirstStarted){L.Zp(3);break}return g.k(L,Oy(N,R),5);case 5:return C=L.V,N.V.hasLoggedFirstStarted=!0,g.k(L,LNw(N),6);case 6:Q91({videoId:R,vW:N.V,offlineModeType:C},void 0,void 0,!0);L.Zp(3);break;case 7:C=L.V,
QH({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:R,vW:N.V,offlineModeType:C});case 3:return g.k(L,KNm(N),8);case 8:return Z=null,g.d_(L,9),g.k(L,ld1(N,z),11);case 11:Z=L.V;N.B=Z;g.nO(L,10);break;case 9:return Y=g.U2(L),Zc("error getting player response",Y,z.cotn),g.k(L,N.wk("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return L.return();case 10:return Q=erl(N.api.D(),z.cotn,Z),g.k(L,QOW(N,Q),13);case 13:return g.k(L,J4E(Q.videoId),
14);case 14:Q.iQ=L.V,sHr(N.L,Q,z.maximumDownloadQuality),N.N.start(108E5),g.fO(L)}})},i6r=function(N){var z,v;
return g.S(function(R){if(R.W==1)return g.k(R,NC(N.W,"transfer"),2);z=R.V;v=z.filter(WNV).sort(Gb8);return v.length===0?R.return():R.return(v[0])})},KNm=function(N){var z,v,R;
return g.S(function(C){if(C.W==1){if(!N.V)return Ir(N,"onTransferStart"),C.return();N.N.start(108E5);return g.k(C,Xx(N,"TRANSFER_STATE_TRANSFERRING"),2)}z=N.V;return(R=((v=z)==null?0:v.key)?g.cy(z.key).entityId:"")&&N.Z?g.k(C,Gm(R,N.Z,N.W,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):C.Zp(0)})},fFP=function(N){var z,v,R,C;
g.S(function(Z){switch(Z.W){case 1:if(!N.V){Ir(N,"onTransferPausedByUser");Z.Zp(2);break}z=N.V;N.N.stop();return g.k(Z,Xx(N,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:R=((v=z)==null?0:v.key)?g.cy(z.key).entityId:"";if(!R||!N.Z){Z.Zp(4);break}return g.k(Z,Gm(R,N.Z,N.W,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.k(Z,Oy(N,R),6);case 6:C=Z.V,K9E({videoId:R,vW:z,offlineModeType:C});case 2:bA(N),tw(N),g.fO(Z)}})},dvP=function(N){var z,v,R;
g.S(function(C){if(C.W==1){if(!N.V)return Ir(N,"onTransferPausedByNetwork"),C.return();N.N.stop();return g.k(C,Xx(N,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(C.W!=3)return z=N.V,(R=((v=z)==null?0:v.key)?g.cy(z.key).entityId:"")&&N.Z?g.k(C,Gm(R,N.Z,N.W,"DOWNLOAD_STATE_PAUSED"),3):C.Zp(3);bA(N);g.fO(C)})},x4U=function(N){var z,v,R,C,Z;
g.S(function(Y){switch(Y.W){case 1:if(!N.V)return Ir(N,"onTransferComplete"),Y.return();z=N.V;N.N.stop();if(!z||!N.B){Y.Zp(2);break}v=erl(N.api.D(),z.cotn,N.B);return g.k(Y,QOW(N,v),2);case 2:return g.k(Y,Xx(N,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:C=((R=z)==null?0:R.key)?g.cy(z.key).entityId:"";if(!C||!N.Z){Y.Zp(5);break}return g.k(Y,Gm(C,N.Z,N.W,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.k(Y,CPZ(N.W,C),7);case 7:return g.k(Y,Oy(N,C),8);case 8:Z=Y.V,QH({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:C,vW:z,offlineModeType:Z}),bA(N),tw(N),g.fO(Y)}})},e$W=function(N,z,v){var R,C;
g.S(function(Z){switch(Z.W){case 1:if(!N.V)return Ir(N,"onTransferProgress: "+z),Z.return();if(N.V.transferState==="TRANSFER_STATE_TRANSFERRING"){Z.Zp(2);break}return g.k(Z,KNm(N),2);case 2:R=Date.now();if(!(R-N.Rd>1E3)){Z.Zp(4);break}N.Rd=R;return g.k(Z,R$w(N.W,v.videoId,v.W,v.ji,v.bytesDownloaded,v.V),5);case 5:if(N.J&&!(N.J&&R-N.qd>N.S8)){Z.Zp(4);break}N.qd=R;return g.k(Z,Oy(N,z),7);case 7:C=Z.V,Q91({videoId:z,vW:N.V,offlineModeType:C},v.bytesDownloaded,v.V);case 4:N.N.start(108E5),g.fO(Z)}})},
J7P=function(N){var z=(N.V.transferRetryCount||0)<3;
z&&(N=N.V,N.transferRetryCount=(N.transferRetryCount||0)+1);return z},y78=function(N,z){z=z===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":z;
var v,R,C,Z;return g.S(function(Y){if(Y.W==1)return N.V||Ir(N,"setTransferToFailed: "+z),v="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",z==="TRANSFER_FAILURE_REASON_NETWORK"?v="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":z==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(v="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.k(Y,Xx(N,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",z),2);if(Y.W!=3)return iA(N.Vp,{entityKey:(R=N.V)==null?void 0:R.key,failureReason:v}),
C=N.V?g.cy(N.V.key).entityId:"",g.k(Y,Oy(N,C),3);Z=Y.V;var Q={videoId:C,vW:N.V,offlineModeType:Z},L=z,K={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};L&&(K.transferFailureReason=L,K.failureReason=lt1(L));QH(K,Q);g.fO(Y)})},Xx=function(N,z,v,R){var C;
return g.S(function(Z){if(Z.W==1){if(!N.V)return Ir(N,"saveTransferState: "+z),Z.return();N.V.transferState=z;N.V.failureReason=R;g.d_(Z,2);return g.k(Z,LNw(N,function(Y){return v?Oa(Y,"offlineVideoStreams",N.V.offlineVideoStreams).then(function(Q){for(var L=g.f(Q),K=L.next();!K.done;K=L.next())if((K=K.value)&&K.streamsProgress){K=g.f(K.streamsProgress);for(var l=K.next();!l.done;l=K.next())l.value.streamState=v}return xnU(Y,Q.filter(function(W){return!!W}),"offlineVideoStreams")}):g.TJ.resolve(void 0)}),
4)}if(Z.W!=2)return g.nO(Z,0);
C=g.U2(Z);return C instanceof g.xp&&C.type==="QUOTA_EXCEEDED"?g.k(Z,N.wk("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):Z.Zp(0)})},LNw=function(N,z){var v;
return g.S(function(R){if(!N.V)return R.return();v=N.V;return g.k(R,qo(N.W,{mode:"readwrite",sR:!0},function(C){var Z=[Xw(C,v,"transfer")];z&&Z.push(z(C));return g.TJ.all(Z)}),0)})},bA=function(N){N.V=void 0;
N.B=void 0;N.N.stop()},ld1=function(N,z){var v,R,C,Z,Y;
return g.S(function(Q){if(Q.W==1)return v=g.cy(z.key),R=v.entityId,C=g.qJ(R,"playbackData"),g.k(Q,w7(N.W,C,"playbackData"),2);Z=Q.V;if((Y=Z)==null?0:Y.playerResponseJson)return Q.return(JSON.parse(Z.playerResponseJson));throw Error("No PlayerResponse found");})},Ir=function(N,z){N.api.WL("woffle",{mcte:z});
Zc("missing current transfer entity.")},Oy=function(N,z){var v,R,C;
return g.S(function(Z){if(Z.W==1)return g.k(Z,w7(N.W,g.qJ(z,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);v=Z.V;return Z.return((C=(R=v)==null?void 0:R.offlineModeType)!=null?C:void 0)})},WNV=function(N){return fd1[N.transferState]!==void 0},Gb8=function(N,z){var v=fd1[N.transferState],R=fd1[z.transferState];
return v!==R?v-R:Number(N.enqueuedTimestampMs)-Number(z.enqueuedTimestampMs)},rh=function(N,z){var v=this;
this.iS=N;this.api=z;this.G=new g.XC;this.B=new g.Ww;this.Oi={GH:function(){return v.Z.Oi.GH()},
pk:function(){return v.G},
V_T:function(){return v.Z},
Z5:function(){return v.Z5()},
Uj:function(){return v.Uj()},
Sw:function(){return v.Sw()},
Jl:function(){return v.Jl()},
Ef:function(){return v.Ef()},
lM:function(R){return v.lM(R)}};
this.Z=new C6V(function(){return d4r(v)},function(){v.Sw()},this.api.p8(),this.api.X.bind(this.api));
this.V=new Yf(this.api);Z$8(this.Z)},d4r=function(N){return g.S(function(z){N.api.Qp("onOrchestrationBecameLeader");
return g.k(z,N.Uj(),0)})},TAl=function(N){var z,v;
return g.S(function(R){if(R.W==1)return g.k(R,zm(),2);if(R.W!=3){z=R.V;if(!z)return Zc("PES is undefined"),R.return();N.W=new Z6U(z,N.api,N.Z,N.V);v=N.Yc(z);return g.k(R,Hj8(z,v,N.Z,N.V,N.iS),3)}N.L=R.V;return g.k(R,sO9(N),0)})},sO9=function(N){var z;
return g.S(function(v){switch(v.W){case 1:if(!N.W)return Zc("transferManager is undefined"),v.return();if(N.W.V){v.Zp(2);break}return g.k(v,tw(N.W),2);case 2:if(!N.iS.X("woffle_enable_main_downloads_library")){v.Zp(4);break}return g.k(v,N.sF(),4);case 4:if(!N.iS.X("html5_offline_playback_position_sync")){v.Zp(6);break}return g.k(v,N.nH(),7);case 7:return g.k(v,N.lM(864E5),6);case 6:return g.k(v,N.refreshAllStaleEntities(43200,!0),9);case 9:return g.k(v,N.Y0(),10);case 10:if(!N.iS.X("html5_retry_downloads_for_expiration")){v.Zp(11);
break}return g.k(v,N.Ef(),11);case 11:return N.Y=g.GU(function(){N.refreshAllStaleEntities(43200,!0);N.Y0()},9E5),g.M0(g.Np(),function(){return N.Jl()}),g.k(v,zm(),13);
case 13:return z=v.V,g.k(v,Rr8(z),14);case 14:YP9(N.Z),g.fO(v)}})},FNW=function(){var N,z,v,R,C,Z;
return g.S(function(Y){switch(Y.W){case 1:return g.k(Y,zm(),2);case 2:N=Y.V;if(!N)return Y.return([]);z=Date.now()/1E3;return g.k(Y,NC(N,"offlineVideoPolicy"),3);case 3:v=Y.V,R=g.f(v),C=R.next();case 4:if(C.done){Y.Zp(6);break}Z=C.value;if(!(Z.expirationTimestamp&&Number(Z.expirationTimestamp)<z)){Y.Zp(5);break}Z.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";Z.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.k(Y,Mo(N,Z,"offlineVideoPolicy"),5);
case 5:C=R.next();Y.Zp(4);break;case 6:return Y.return(v.map(function(Q){return Q.key}))}})},uA=function(N,z,v,R,C){var Z,Y,Q;
return g.S(function(L){if(L.W==1)return g.k(L,zm(),2);Z=L.V;if(!Z)return L.return([]);Y=z.map(function(K){var l=g.qJ(K,v);l={actionType:R,entityKey:l,actionMetadata:Object.assign({},JhE(),C)};R!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(l.actionMetadata.priority=0);K=new yH(v,K,l);return dh(K)});
Q=n77(Z,Y);Z$8(N.Z);return L.return(Q)})},ne7=function(N,z,v,R){var C,Z,Y,Q,L,K,l,W;
return g.S(function(G){switch(G.W){case 1:C=[],Z=g.f(z),Y=Z.next();case 2:if(Y.done){G.Zp(4);break}Q=Y.value;if(Q.upToDate||v&&!Q.shouldAutoSyncMetadata||!Q.playlistId){G.Zp(3);break}L={};switch(R){case "mainPlaylistEntity":K={nextAutoRefreshIntervalSeconds:Q.checkInSeconds,autoSync:v};L={mainPlaylistEntityActionMetadata:K};break;case "musicPlaylist":l={autoSync:v},L={musicPlaylistEntityActionMetadata:l}}return g.k(G,uA(N,[Q.playlistId],R,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",L),6);case 6:(W=
G.V)&&C.push.apply(C,g.U(W));case 3:Y=Z.next();G.Zp(2);break;case 4:return G.return(C)}})},m4$=function(N,z){var v;
return g.S(function(R){return z.length?(v=JhE(),g.HN(v,SQ,{isEnqueuedForExpiredStreamUrlRefetch:!0}),N.api.WL("qrd",{v:z.length}),R.return(uA(N,z,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",v))):R.return([])})},$4P=function(N,z,v){this.V=N;
this.iS=z;this.Z=v},A7W=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n;
return g.S(function(P){switch(P.W){case 1:return v=Lp(z),R=g.cy(z.entityKey),C=R.entityId,Z=[],g.d_(P,2),g.k(P,U4W(N,C),4);case 4:Z=P.V;if(!(N.iS.X("woffle_enable_main_downloads_library")&&((Y=Z)==null?0:Y.length))){P.Zp(5);break}return g.k(P,gC8(N.V,[z.entityKey]),5);case 5:g.nO(P,3);break;case 2:return Q=g.U2(P),L="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Q instanceof g.xp&&Q.type==="QUOTA_EXCEEDED"?(L="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
K="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):Zc("Playlist add error"),P.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,L,K));case 3:l=[];if(!N.iS.X("html5_offline_prevent_redownload_downloaded_video")){P.Zp(7);break}return g.k(P,xm5(N.V,"mainVideoEntity",Z),8);case 8:Z=P.V;case 7:if((W=Z)==null?0:W.length)for(G=g.f(Z),x=G.next();!x.done;x=G.next())if(e=x.value,d=e.offlineVideoData,T=void 0,(T=d)==null?0:T.videoId)m=void 0,n=Number(((m=z.actionMetadata)==null?void 0:m.priority)||
0)+1,l.push(Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",d.videoId,"mainVideoEntity",n,cg,BAV(z,d,C)));return P.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,l))}})},plP=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n,P,V,D,c,r,Rv,Zu,Nx,av,M,s2,$m,O2,m7,QU,BU,mu,Y5,F,jI,rE,TM,gE,x5,Du,SV,pm,B,A,p,E,O,FK,vU,Jb,CO,g_,Mx,Fr,F_,k_,Xl,X_,rT,dT,Ly,AJ,Jj,gv,tv,Op,Tc,YQ,u8,jz,FQ,oh;
return g.S(function(J0){switch(J0.W){case 1:return v=Lp(z),R=z.entityKey,C=g.cy(R).entityId,Z=[],Y=!1,C==="!*$_ALL_ENTITIES_!*$"?(Y=!0,g.k(J0,NC(N.V,"mainPlaylistEntity"),5)):g.k(J0,w7(N.V,R,"mainPlaylistEntity"),4);case 4:(Q=J0.V)&&Z.push(Q);J0.Zp(3);break;case 5:Z=J0.V;case 3:if((L=Z)==null||!L.length)return J0.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));K=g.t(z.actionMetadata,ger);W=(l=K)==null?void 0:l.nextAutoRefreshIntervalSeconds;x=(G=K)==null?void 0:G.autoSync;e=[];T=d=
!0;m=!1;if(!Y&&x===!1){J0.Zp(6);break}g.d_(J0,7);return g.k(J0,ItP(0,!!x,!0,Z),9);case 9:e=J0.V;g.nO(J0,8);break;case 7:n=g.U2(J0);if(!(n instanceof Error&&n.message==="No data")){n instanceof Error&&n.message==="Empty response body"&&Zc(n.message);J0.Zp(8);break}return C==="!*$_ALL_ENTITIES_!*$"?g.k(J0,nCZ(N.V,z,N.Z,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.k(J0,T2E(C,N.V,z,N.Z),8);case 8:if(!e.length||!Y&&e[0].playlistId!==C)return J0.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v));case 6:if(Y){P=[];V=g.f(e);for(D=V.next();!D.done;D=V.next())c=D.value,c.upToDate||x&&!c.shouldAutoSyncMetadata||!c.playlistId||(r={nextAutoRefreshIntervalSeconds:c.checkInSeconds,autoSync:x},P.push(Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",c.playlistId,"mainPlaylistEntity",0,cg,{mainPlaylistEntityActionMetadata:r})));return J0.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,P))}e.length&&(Rv=e[0],m=!!Rv.upToDate,x&&(d=(Zu=Rv.shouldAutoSyncMetadata)!=null?Zu:!0,T=(Nx=Rv.shouldAutoSyncVideos)!=
null?Nx:!0,Rv.checkInSeconds&&(W=Rv.checkInSeconds)));if(m||!d)return J0.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));av=[];M=Z[0];if(!M.downloadState){s2=void 0;J0.Zp(15);break}return g.k(J0,w7(N.V,M.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:s2=J0.V;case 15:return $m=s2,m7=((O2=$m)==null?0:O2.addedTimestampMillis)?String($m.addedTimestampMillis):void 0,g.d_(J0,17),g.k(J0,U4W(N,C,m7,W),19);case 19:av=J0.V;g.nO(J0,18);break;case 17:QU=g.U2(J0);if(!(QU instanceof
Error&&QU.message==="No data for playlist")){if(QU instanceof Error&&QU.message==="Empty response body for playlist")Zc(QU.message);else return BU="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",mu="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",QU instanceof g.xp&&QU.type==="QUOTA_EXCEEDED"&&(BU="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",mu="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),J0.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,BU,mu));
J0.Zp(18);break}return g.k(J0,T2E(C,N.V,z,N.Z),18);case 18:if(!T)return J0.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));Y5=[];F=new Map;if((jI=av)==null?0:jI.length)for(rE=g.f(av),TM=rE.next();!TM.done;TM=rE.next())gE=TM.value,x5=gE.offlineVideoData,Du=void 0,((Du=x5)==null?0:Du.videoId)&&F.set(x5.videoId,x5);SV=new Map;pm=[];if((B=M)==null?0:(A=B.videos)==null?0:A.length)for(p=g.f(M.videos),E=p.next();!E.done;E=p.next())if(O=E.value,FK=JSON.parse(g.cy(O).entityId),vU=FK.videoId)F.has(vU)?
(SV.set(vU,F.get(vU)),F.delete(vU)):pm.push(vU);CO=Number(((Jb=z.actionMetadata)==null?void 0:Jb.priority)||0)+1;g_=g.f(F.entries());for(Mx=g_.next();!Mx.done;Mx=g_.next())Fr=Mx.value,F_=g.f(Fr),k_=F_.next().value,Xl=F_.next().value,X_=k_,rT=Xl,Y5.push(Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",X_,"mainVideoEntity",CO,cg,BAV(z,rT,C)));dT=g.f(SV.entries());for(Ly=dT.next();!Ly.done;Ly=dT.next())AJ=Ly.value,Jj=g.f(AJ),gv=Jj.next().value,tv=Jj.next().value,Op=gv,Tc=tv,Y5.push(Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Op,"mainVideoEntity",CO,cg,BAV(z,Tc,C)));YQ=g.f(pm);for(u8=YQ.next();!u8.done;u8=YQ.next())jz=u8.value,FQ={playlistId:C},oh={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:FQ},Y5.push(Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",jz,"mainVideoEntity",0,cg,oh));return J0.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,Y5))}})},kbm=function(N,z){var v,R,C,Z;
return g.S(function(Y){switch(Y.W){case 1:return v=Lp(z),g.d_(Y,2),R=g.cy(z.entityKey).entityId,R==="!*$_ALL_ENTITIES_!*$"?g.k(Y,nCZ(N.V,z,N.Z,(C=z.actionMetadata)==null?void 0:(Z=C.offlineLoggingData)==null?void 0:Z.offlineDeleteReason),5):g.k(Y,T2E(R,N.V,z,N.Z),6);case 6:if(!N.iS.X("woffle_enable_main_downloads_library")){Y.Zp(5);break}return g.k(Y,pww(N.V,z.entityKey),5);case 5:g.nO(Y,3);break;case 2:return g.U2(Y),Y.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Y.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v))}})},U4W=function(N,z,v,R){var C,Z,Y,Q,L,K,l;
return g.S(function(W){switch(W.W){case 1:return g.k(W,tUr([z]),2);case 2:return C=W.V,g.k(W,PPl(N,C[0],v,R),3);case 3:return Z=W.V,Y=Z.mainPlaylistEntity,Q=Z.fCT,K=dmr(Y,(L=Q)==null?void 0:L.avatar),g.d_(W,4),g.k(W,Tm(K),6);case 6:g.nO(W,5);break;case 4:l=g.U2(W),l instanceof Error&&l.message==="Failed to fetch"&&Zc(l.message);case 5:return W.return(C[0].videos)}})},PPl=function(N,z,v,R){var C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n,P,V;
return g.S(function(D){switch(D.W){case 1:C=Date.now().toString();v||(v=C);Z=z.videos;Y=z.playlistId;Q=[];L=[];if(Z)for(K=g.f(Z),l=K.next();!l.done;l=K.next()){W=l.value;G=W.offlineVideoData;if(!G||!G.videoId)throw Zc("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");x=G.videoId;e={videoId:x,playlistId:Y};d={id:g.qJ(JSON.stringify(e),"mainPlaylistVideoEntity"),video:g.qJ(x,"mainVideoEntity")};Q.push(d);L.push(d.id)}m={key:g.qJ(Y,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:v,lastSyncedTimestampMillis:C};n={key:g.qJ(Y,"mainPlaylistEntity"),playlistId:Y,videos:L,title:z.title,thumbnailStyleData:VWW(z),visibility:Sbl(z),downloadState:m.key};z.channel&&(P=z.channel.offlineChannelData,T=Ee8(g.qJ(Y,"ytMainChannelEntity"),P),n.channelOwner=T.id);((V=n)==null?0:V.entityMetadata)?(n.entityMetadata.offlineLastModifiedTimestampSeconds=z.lastModifiedTimestamp,R&&(n.entityMetadata.nextAutoRefreshIntervalSeconds=String(R))):n&&(n.entityMetadata={nextAutoRefreshIntervalSeconds:R?
String(R):void 0,offlineLastModifiedTimestampSeconds:z.lastModifiedTimestamp});g.d_(D,2);return g.k(D,qo(N.V,{mode:"readwrite",sR:!0},function(c){var r=Xw(c,n,"mainPlaylistEntity"),Rv=Xw(c,m,"mainPlaylistDownloadStateEntity");r=[r,Rv];Rv=g.f(Q);for(var Zu=Rv.next();!Zu.done;Zu=Rv.next())r.push(Xw(c,Zu.value,"mainPlaylistVideoEntity"));T&&r.push(Xw(c,T,"ytMainChannelEntity"));return g.TJ.all(r)}),4);
case 4:g.nO(D,3);break;case 2:throw g.U2(D),Zc("PES failure for playlist"),Error("PES failure for playlist");case 3:return D.return({mainPlaylistEntity:n,fCT:T,Xv1:Q})}})},Ee8=function(N,z){return{id:N,
channelId:z.channelId,title:z.title,avatar:z.thumbnail}},VWW=function(N){var z=[],v=N.videos;
v&&v.length>0&&z.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:v[0].offlineVideoData.thumbnail}}});if((N=N.additionalMetadadatas)&&N.length>0)for(N=g.f(N),v=N.next();!v.done;v=N.next()){var R=v.value.offlineBundleItemPlaylistData,C=void 0;v=(C=R)==null?void 0:C.style;C=void 0;R={collageThumbnail:{coverThumbnail:(C=R)==null?void 0:C.coverThumbnail}};switch(v){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":z.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:R});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":z.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:R});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":z.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:R});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":z.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:R})}}return z},Sbl=function(N){switch(N.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},BAV=function(N,z,v){z={offlineVideoData:z,
playlistId:v};if(N=g.t(N.actionMetadata,ger))z.maximumDownloadQuality=N.maximumDownloadQuality;return{mainVideoEntityActionMetadata:z}},h$7=function(N,z,v){this.V=N;
this.iS=z;this.Z=v},D48=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W,G,x,e;
return g.S(function(d){switch(d.W){case 1:return v=Lp(z),R=g.cy(z.entityKey),C=R.entityId,Z=g.t(z.actionMetadata,qC),Q=!((Y=Z)==null?0:Y.playlistId),g.d_(d,2),g.k(d,H6m(N,C,void 0,(L=Z)==null?void 0:L.offlineVideoData,Q),4);case 4:g.nO(d,3);break;case 2:return K=g.U2(d),l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",K instanceof g.xp&&K.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
d.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,l,W));case 3:G=1;G=Number(((x=z.actionMetadata)==null?void 0:x.priority)||0)+1;var T=(T=g.t(z.actionMetadata,qC))?{playbackDataActionMetadata:{maximumDownloadQuality:T.maximumDownloadQuality}}:void 0;e=Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",C,"playbackData",G,oem,T);return d.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,[e]))}})},b6$=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n;
return g.S(function(P){switch(P.W){case 1:return v=Lp(z),R=g.cy(z.entityKey),C=R.entityId,g.k(P,w7(N.V,z.entityKey,"mainVideoEntity"),2);case 2:Z=P.V;if(!Z){Y=void 0;P.Zp(3);break}return g.k(P,w7(N.V,Z.downloadState,"mainVideoDownloadStateEntity"),4);case 4:Y=P.V;case 3:Q=Y;if(!Z||!Q)return P.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));g.d_(P,5);return g.k(P,H6m(N,C,Q.addedTimestampMillis,(K=g.t(z.actionMetadata,qC))==null?void 0:K.offlineVideoData),7);case 7:l=1;l=Number(((W=
z.actionMetadata)==null?void 0:W.priority)||0)+1;L=Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",C,"playbackData",l,oem);g.nO(P,6);break;case 5:G=g.U2(P);if(!(G instanceof Error&&G.message==="No data")){if(G instanceof Error&&G.message==="Empty response body")Zc(G.message);else return x="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.xp&&G.type==="QUOTA_EXCEEDED"&&(x="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
e="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),P.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,x,e));P.Zp(6);break}return g.k(P,mY(N.V,C),9);case 9:d=P.V;T=g.t(z.actionMetadata,qC);if(n=(m=T)==null?void 0:m.playlistId)d.playlistId=n;d.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.k(P,Fx(C,N.V,z,N.Z,d),6);case 6:return P.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,L?[L]:void 0))}})},tWZ=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W;
return g.S(function(G){switch(G.W){case 1:return v=Lp(z),g.d_(G,2),R=g.cy(z.entityKey).entityId,R==="!*$_ALL_ENTITIES_!*$"?g.k(G,nCZ(N.V,z,N.Z,(l=z.actionMetadata)==null?void 0:(W=l.offlineLoggingData)==null?void 0:W.offlineDeleteReason),5):g.k(G,mY(N.V,R),6);case 6:C=G.V;Z=g.t(z.actionMetadata,qC);if(Q=(Y=Z)==null?void 0:Y.playlistId)C.playlistId=Q;C.offlineDeleteReason=(L=z.actionMetadata)==null?void 0:(K=L.offlineLoggingData)==null?void 0:K.offlineDeleteReason;return g.k(G,Fx(R,N.V,z,N.Z,C),7);
case 7:if(!N.iS.X("woffle_enable_main_downloads_library")){G.Zp(5);break}return g.k(G,pww(N.V,z.entityKey),5);case 5:g.nO(G,3);break;case 2:return g.U2(G),G.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return G.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v))}})},H6m=function(N,z,v,R,C){var Z,Y,Q,L,K,l;
return g.S(function(W){switch(W.W){case 1:if(Z=R){W.Zp(2);break}return g.k(W,b$w([z]),3);case 3:Y=W.V,Z=Y[0];case 2:return g.k(W,O6W(N,Z,v,C),4);case 4:Q=W.V;L=Q.mainVideoEntity;K=Q.channelEntity;g.d_(W,5);var G=Jw(L.thumbnail),x=Jw(K.avatar);return g.k(W,Tm(G.concat(x)),7);case 7:g.nO(W,0);break;case 5:l=g.U2(W),l instanceof Error&&l.message==="Failed to fetch"&&Zc(l.message),g.fO(W)}})},O6W=function(N,z,v,R){var C,Z,Y,Q,L,K,l,W,G,x,e,d,T;
return g.S(function(m){switch(m.W){case 1:v||(v=Date.now().toString());Z=(C=z.channel)==null?void 0:C.offlineChannelData;Y={id:g.qJ(z.videoId,"ytMainChannelEntity"),channelId:Z.channelId,title:Z.title,avatar:Z.thumbnail};Q={key:g.qJ(z.videoId,"mainVideoDownloadStateEntity"),playbackData:g.qJ(z.videoId,"playbackData"),addedTimestampMillis:v,videoDownloadContextEntity:g.qJ(z.videoId,"videoDownloadContextEntity")};L={key:g.qJ(z.videoId,"videoPlaybackPositionEntity"),videoId:z.videoId,lastPlaybackPositionSeconds:"0"};
N.iS.X("html5_offline_playback_position_sync")&&(K={playbackPosition:L.key});l=g.qJ(z.videoId,"mainVideoEntity");W={key:l,videoId:z.videoId,title:z.title,thumbnail:z.thumbnail,localizedStrings:{viewCount:z.shortViewCountText},userState:K,lengthSeconds:z.lengthSeconds?Number(z.lengthSeconds):void 0,publishedTimestampMillis:z.publishedTimestamp?(Number(z.publishedTimestamp)*1E3).toString():void 0,formattedDescription:z.description,owner:Y.id,downloadState:Q.key};if(!N.iS.X("woffle_enable_main_downloads_library")||
!R){m.Zp(2);break}return g.k(m,AhU(N.V,[l]),3);case 3:if(e=m.V)G=e.mainDownloadsLibraryEntity,x=e.mainDownloadsListEntity;case 2:return T=GB1,d={key:g.qJ(z.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.HN(Q,T,d),g.k(m,qo(N.V,{mode:"readwrite",sR:!0},function(n){var P=Xw(n,Y,"ytMainChannelEntity"),V=Xw(n,Q,"mainVideoDownloadStateEntity"),D=Xw(n,W,"mainVideoEntity");P=[P,V,D];N.iS.X("html5_offline_playback_position_sync")&&(V=Xw(n,L,"videoPlaybackPositionEntity"),
P.push(V));G&&(V=Xw(n,G,"mainDownloadsLibraryEntity"),P.push(V));x&&(V=Xw(n,x,"mainDownloadsListEntity"),P.push(V));d&&(n=Xw(n,d,"downloadStatusEntity"),P.push(n));return g.TJ.all(P)}),4);
case 4:return m.return({mainVideoEntity:W,channelEntity:Y})}})},Id5=function(N,z,v){this.V=N;
this.iS=z;this.Z=v},r7r=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n,P,V,D,c,r,Rv,Zu,Nx,av,M;
return g.S(function(s2){switch(s2.W){case 1:return v=Lp(z),R=[],g.k(s2,oU.getInstance(),2);case 2:C=s2.V;if(!C){s2.Zp(3);break}return g.k(s2,C.get("sdois"),4);case 4:return Z=s2.V,g.k(s2,(Q=C)==null?void 0:Q.get("lmqf"),5);case 5:Y=s2.V;case 3:g.d_(s2,6);if(Z===void 0)throw Error("prefStorage or opt-in state is undefined");L=[];if(Z){s2.Zp(8);break}return g.k(s2,B2U(N.V),9);case 9:L=s2.V,L.reverse();case 8:if(!L.length){s2.Zp(10);break}K=g.f(L);l=K.next();case 11:if(l.done){s2.Zp(10);break}W=l.value;
if(!W){s2.Zp(12);break}G=g.cy(W).entityId;return g.k(s2,mY(N.V,G),14);case 14:return x=s2.V,x.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.k(s2,Fx(G,N.V,{entityKey:W,actionType:z.actionType},N.Z,x),12);case 12:l=K.next();s2.Zp(11);break;case 10:return g.k(s2,rh9(Z,(e=Y)!=null?e:"SD"),16);case 16:return d=s2.V,g.k(s2,mmV(d),17);case 17:T=UmW(d);if(!N.iS.X("woffle_enable_main_downloads_library")){s2.Zp(18);break}if(Z){s2.Zp(19);break}return g.k(s2,pww(N.V,g.Sw),19);case 19:return g.k(s2,
gC8(N.V,[g.Sw]),18);case 18:if((m=T)==null?0:m.length)for(n=g.f(T),P=n.next();!P.done;P=n.next())if(D=V=P.value,c=D.actionType,r=D.entityKey,Rv=D.actionMetadata,c&&r&&Rv&&!g.t(Rv,XlZ)){c==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Rv.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Zu=g.t(V.actionMetadata,qC))Zu.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",V.actionMetadata=Object.assign({},V.actionMetadata,{mainVideoEntityActionMetadata:Zu});R.push(V)}g.nO(s2,
7);break;case 6:return Nx=g.U2(s2),av="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Nx instanceof g.xp&&Nx.type==="QUOTA_EXCEEDED"&&(av="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),s2.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,av,M));case 7:return s2.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,R))}})},uVE=function(){rh.apply(this,
arguments);
this.J="mainVideoEntity"},c7E=function(N,z,v){z=z===void 0?43200:z;
v=v===void 0?!0:v;var R=R===void 0?!1:R;var C,Z,Y;return g.S(function(Q){switch(Q.W){case 1:if(!N.G.r$())return Q.return([]);C=[];g.d_(Q,2);return g.k(Q,ItP(z,v,R),4);case 4:C=Q.V;g.nO(Q,3);break;case 2:Z=g.U2(Q),Z instanceof Error&&Z.message==="No data"||Z instanceof Error&&Z.message==="Empty response body"&&Zc(Z.message);case 3:return Y=ne7(N,C,v,"mainPlaylistEntity"),Q.return(Y)}})},qbw=function(N,z,v,R){R=R===void 0?!1:R;
var C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n;return g.S(function(P){switch(P.W){case 1:return C=[],g.k(P,XwV(),2);case 2:return(Z=P.V)||R?g.k(P,u9V(z,v),3):P.return([]);case 3:Y=P.V;if((Q=Y)==null||!Q.length)return P.return([]);L={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};K=g.f(Y);l=K.next();case 4:if(l.done){P.Zp(6);break}G=W=l.value;x=G.actionType;e=G.entityKey;d=G.actionMetadata;if(!(x&&e&&d)||g.t(d,XlZ)){P.Zp(5);break}x==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(d.offlineLoggingData=
L);T=g.cy(e);m=T.entityId;return g.k(P,uA(N,[m],"mainVideoEntity",x,d),8);case 8:n=P.V,C=C.concat(n);case 5:l=K.next();P.Zp(4);break;case 6:return P.return(C)}})},MWZ=function(N,z){this.V=N;
this.Z=z},Nb1=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m;
return g.S(function(n){switch(n.W){case 1:return v=Lp(z),R=g.cy(z.entityKey),C=R.entityId,Z=[],g.d_(n,2),g.k(n,wl9(N,C),4);case 4:Z=n.V;if((Y=Z)==null||!Y.length){n.Zp(5);break}return g.k(n,ECW(N.V,z.entityKey),5);case 5:g.nO(n,3);break;case 2:return Q=g.U2(n),L="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Q instanceof g.xp&&Q.type==="QUOTA_EXCEEDED"&&(L="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
n.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,L,K));case 3:return l=[],g.k(n,xm5(N.V,"musicTrack",Z),7);case 7:Z=n.V;if(Z.length)for(W=g.f(Z),G=W.next();!G.done;G=W.next())if(x=G.value,e=x.offlineVideoData,d=void 0,(d=e)==null?0:d.videoId)T=void 0,m=Number(((T=z.actionMetadata)==null?void 0:T.priority)||0)+1,l.push(Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",e.videoId,"musicTrack",m,MC,Aw(z,e,C)));return n.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,l))}})},
zg5=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n,P,V,D,c,r,Rv,Zu,Nx,av,M,s2,$m,O2,m7,QU,BU,mu,Y5,F,jI,rE,TM,gE,x5,Du,SV,pm,B,A,p,E,O,FK,vU,Jb,CO,g_,Mx,Fr,F_,k_,Xl;
return g.S(function(X_){switch(X_.W){case 1:return v=Lp(z),R=z.entityKey,C=g.cy(R).entityId,Z=[],Y=!1,C==="!*$_ALL_ENTITIES_!*$"?(Y=!0,g.k(X_,NC(N.V,"musicAlbumRelease"),5)):g.k(X_,w7(N.V,R,"musicAlbumRelease"),4);case 4:(Q=X_.V)&&Z.push(Q);X_.Zp(3);break;case 5:Z=X_.V;case 3:if((L=Z)==null||!L.length)return X_.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));if(Y){K=[];l=g.f(Z);for(W=l.next();!W.done;W=l.next())G=W.value,x=g.cy(G.id).entityId,K.push(Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
x,"musicAlbumRelease",0,MC));return X_.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,K))}e=[];d=Z[0];T=void 0;if(!d.downloadMetadata){X_.Zp(6);break}return g.k(X_,w7(N.V,d.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:m=X_.V,T=Number((P=(n=m)==null?void 0:n.addedTimestampMillis)!=null?P:"0")/1E3;case 6:return g.d_(X_,8),g.k(X_,wl9(N,C,(V=T)==null?void 0:V.toString()),10);case 10:e=X_.V;g.nO(X_,9);break;case 8:D=g.U2(X_);if(!(D instanceof Error&&D.message===
"No data")){if(D instanceof Error&&D.message==="Empty response body")Zc(D.message);else return c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.xp&&D.type==="QUOTA_EXCEEDED"&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),X_.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,c,r));X_.Zp(9);break}return g.k(X_,Uy(C,"musicAlbumRelease",N.V,
z,N.Z),9);case 9:Rv=[];Zu=new Map;if((Nx=e)==null?0:Nx.length)for(av=g.f(e),M=av.next();!M.done;M=av.next())s2=M.value,$m=s2.offlineVideoData,O2=void 0,((O2=$m)==null?0:O2.videoId)&&Zu.set($m.videoId,$m);m7=new Map;QU=[];if((BU=d)==null?0:(mu=BU.tracks)==null?0:mu.length)for(Y5=g.f(d.tracks),F=Y5.next();!F.done;F=Y5.next())if(jI=F.value,rE=g.cy(jI).entityId)Zu.has(rE)?(m7.set(rE,Zu.get(rE)),Zu.delete(rE)):QU.push(rE);gE=Number(((TM=z.actionMetadata)==null?void 0:TM.priority)||0)+1;x5=g.f(Zu.entries());
for(Du=x5.next();!Du.done;Du=x5.next())SV=Du.value,pm=g.f(SV),B=pm.next().value,A=pm.next().value,p=B,E=A,Rv.push(Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",p,"musicTrack",gE,MC,Aw(z,E)));O=g.f(m7.entries());for(FK=O.next();!FK.done;FK=O.next())vU=FK.value,Jb=g.f(vU),CO=Jb.next().value,g_=Jb.next().value,Mx=CO,Fr=g_,Rv.push(Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Mx,"musicTrack",gE,MC,Aw(z,Fr)));F_=g.f(QU);for(k_=F_.next();!k_.done;k_=F_.next())Xl=k_.value,Rv.push(Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Xl,"musicTrack",0,MC));return X_.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,Rv))}})},vWl=function(N,z){var v,R;
return g.S(function(C){switch(C.W){case 1:return v=Lp(z),g.d_(C,2),R=g.cy(z.entityKey).entityId,R==="!*$_ALL_ENTITIES_!*$"?g.k(C,Bg(N.V,z,N.Z),5):g.k(C,Uy(R,"musicAlbumRelease",N.V,z,N.Z),6);case 6:return g.k(C,hr5(N.V,z.entityKey),5);case 5:g.nO(C,3);break;case 2:return g.U2(C),C.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return C.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v))}})},wl9=function(N,z,v){var R,C,Z;
return g.S(function(Y){switch(Y.W){case 1:return g.k(Y,tUr([z]),2);case 2:return R=Y.V,g.k(Y,RgV(N,R[0],v),3);case 3:return C=Y.V,Z=Jw(C.thumbnailDetails),g.k(Y,Tm(Z),4);case 4:return Y.return(R[0].videos)}})},RgV=function(N,z,v){var R,C,Z,Y,Q,L,K,l,W,G,x,e,d,T;
return g.S(function(m){if(m.W==1){R=z.additionalMetadadatas;C=void 0;if(R&&R.length>0)for(Z=g.f(R),Y=Z.next();!Y.done;Y=Z.next())if(Q=Y.value,Q.offlineMusicPlaylistData){C=Q.offlineMusicPlaylistData;break}L=z.playlistId;K=H$r(z);l=K.M5;W=K.B$;G=v?(Number(v)*1E3).toString():Date.now().toString();x=z.lastModifiedTimestamp?(Number(z.lastModifiedTimestamp)*1E3).toString():"0";e={id:g.qJ(L,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:W,lastModifiedTimestampMillis:x,addedTimestampMillis:G,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};d={id:g.qJ(L,"musicAlbumRelease"),title:z.title,audioPlaylistId:L,trackCount:z.totalVideoCount,tracks:l,downloadMetadata:e.id};C&&(d.thumbnailDetails=(T=C.albumHqThumbnail)!=null?T:C.albumArtistThumbnail,d.artistDisplayName=C.albumArtistDisplayName,d.releaseDate=C.albumReleaseDate,d.contentRating={explicitType:C.albumReleaseExplicitType},d.releaseType=C.albumReleaseType);return g.k(m,qo(N.V,{mode:"readwrite",sR:!0},function(n){var P=Xw(n,d,"musicAlbumRelease");
n=Xw(n,e,"musicAlbumReleaseDownloadMetadataEntity");return g.TJ.all([P,n])}),2)}return m.return(d)})},C1$=function(N,z){this.V=N;
this.Z=z},YTV=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m;
return g.S(function(n){switch(n.W){case 1:return v=Lp(z),R=g.cy(z.entityKey),C=R.entityId,Z=[],g.d_(n,2),g.k(n,ZiW(N,C),4);case 4:Z=n.V;if((Y=Z)==null||!Y.length){n.Zp(5);break}return g.k(n,ECW(N.V,z.entityKey),5);case 5:g.nO(n,3);break;case 2:return Q=g.U2(n),L="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Q instanceof g.xp&&Q.type==="QUOTA_EXCEEDED"&&(L="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
n.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,L,K));case 3:return l=[],g.k(n,xm5(N.V,"musicTrack",Z),7);case 7:Z=n.V;if(Z.length)for(W=g.f(Z),G=W.next();!G.done;G=W.next())if(x=G.value,e=x.offlineVideoData,d=void 0,(d=e)==null?0:d.videoId)T=void 0,m=Number(((T=z.actionMetadata)==null?void 0:T.priority)||0)+1,l.push(Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",e.videoId,"musicTrack",m,wh,Aw(z,e,C)));return n.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,l))}})},
iiW=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n,P,V,D,c,r,Rv,Zu,Nx,av,M,s2,$m,O2,m7,QU,BU,mu,Y5,F,jI,rE,TM,gE,x5,Du,SV,pm,B,A,p,E,O,FK,vU,Jb,CO,g_,Mx,Fr,F_,k_,Xl,X_,rT,dT,Ly,AJ,Jj,gv,tv,Op,Tc,YQ,u8;
return g.S(function(jz){switch(jz.W){case 1:return v=Lp(z),R=z.entityKey,C=g.cy(R).entityId,Z=[],Y=!1,C==="!*$_ALL_ENTITIES_!*$"?(Y=!0,g.k(jz,NC(N.V,"musicPlaylist"),5)):g.k(jz,w7(N.V,R,"musicPlaylist"),4);case 4:(Q=jz.V)&&Z.push(Q);jz.Zp(3);break;case 5:Z=jz.V;case 3:if((L=Z)==null||!L.length)return jz.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));K=g.t(z.actionMetadata,oC5);W=(l=K)==null?void 0:l.autoSync;G=[];e=x=!0;d=!1;T=void 0;if(!Y&&W===!1){jz.Zp(6);break}g.d_(jz,7);return g.k(jz,
ch8(0,!!W,!0,Z),9);case 9:G=jz.V;g.nO(jz,8);break;case 7:m=g.U2(jz);if(!(m instanceof Error&&m.message==="No data")){m instanceof Error&&m.message==="Empty response body"&&Zc(m.message);jz.Zp(8);break}return C==="!*$_ALL_ENTITIES_!*$"?g.k(jz,Bg(N.V,z,N.Z),8):g.k(jz,Uy(C,"musicPlaylist",N.V,z,N.Z),8);case 8:if(!G.length||!Y&&G[0].playlistId!==C)return jz.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));case 6:if(Y){n=[];P=g.f(G);for(V=P.next();!V.done;V=P.next())D=V.value,D.upToDate||
W&&!D.shouldAutoSyncMetadata||!D.playlistId||(c={autoSync:W},n.push(Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",D.playlistId,"musicPlaylist",0,wh,{musicPlaylistEntityActionMetadata:c})));return jz.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,n))}G.length&&(r=G[0],d=!!r.upToDate,W&&(x=(Rv=r.shouldAutoSyncMetadata)!=null?Rv:!0,e=(Zu=r.shouldAutoSyncVideos)!=null?Zu:!0,r.checkInSeconds&&(T=r.checkInSeconds)));if(d||!x)return jz.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v));Nx=[];av=Z[0];M=void 0;if(!av.downloadMetadata){jz.Zp(15);break}return g.k(jz,w7(N.V,av.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:s2=jz.V,M=Number((O2=($m=s2)==null?void 0:$m.addedTimestampMillis)!=null?O2:"0")/1E3;case 15:return g.d_(jz,17),g.k(jz,ZiW(N,C,(m7=M)==null?void 0:m7.toString(),T),19);case 19:Nx=jz.V;g.nO(jz,18);break;case 17:QU=g.U2(jz);if(!(QU instanceof Error&&QU.message==="No data")){if(QU instanceof Error&&QU.message==="Empty response body")Zc(QU.message);
else return BU="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",mu="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",QU instanceof g.xp&&QU.type==="QUOTA_EXCEEDED"&&(BU="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",mu="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),jz.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,BU,mu));jz.Zp(18);break}return g.k(jz,Uy(C,"musicPlaylist",N.V,z,N.Z),18);case 18:if(!e)return jz.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v));Y5=[];F=new Map;if((jI=Nx)==null?0:jI.length)for(rE=g.f(Nx),TM=rE.next();!TM.done;TM=rE.next())gE=TM.value,x5=gE.offlineVideoData,Du=void 0,((Du=x5)==null?0:Du.videoId)&&F.set(x5.videoId,x5);SV=new Map;pm=[];if((B=av)==null?0:(A=B.tracks)==null?0:A.length)for(p=g.f(av.tracks),E=p.next();!E.done;E=p.next())if(O=E.value,FK=g.cy(O).entityId)F.has(FK)?(SV.set(FK,F.get(FK)),F.delete(FK)):pm.push(FK);Jb=Number(((vU=z.actionMetadata)==null?void 0:vU.priority)||0)+1;CO=g.f(F.entries());for(g_=CO.next();!g_.done;g_=
CO.next())Mx=g_.value,Fr=g.f(Mx),F_=Fr.next().value,k_=Fr.next().value,Xl=F_,X_=k_,Y5.push(Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Xl,"musicTrack",Jb,wh,Aw(z,X_)));rT=g.f(SV.entries());for(dT=rT.next();!dT.done;dT=rT.next())Ly=dT.value,AJ=g.f(Ly),Jj=AJ.next().value,gv=AJ.next().value,tv=Jj,Op=gv,Y5.push(Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",tv,"musicTrack",Jb,wh,Aw(z,Op)));Tc=g.f(pm);for(YQ=Tc.next();!YQ.done;YQ=Tc.next())u8=YQ.value,Y5.push(Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
u8,"musicTrack",0,wh));return jz.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,Y5))}})},jh9=function(N,z){var v,R;
return g.S(function(C){switch(C.W){case 1:return v=Lp(z),g.d_(C,2),R=g.cy(z.entityKey).entityId,R==="!*$_ALL_ENTITIES_!*$"?g.k(C,Bg(N.V,z,N.Z),5):g.k(C,Uy(R,"musicPlaylist",N.V,z,N.Z),6);case 6:return g.k(C,hr5(N.V,z.entityKey),5);case 5:g.nO(C,3);break;case 2:return g.U2(C),C.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return C.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v))}})},ZiW=function(N,z,v,R){var C,Z,Y;
return g.S(function(Q){switch(Q.W){case 1:return g.k(Q,tUr([z]),2);case 2:return C=Q.V,g.k(Q,a3Z(N,C[0],v,R),3);case 3:return Z=Q.V,Y=Jw(Z.thumbnailDetails),g.k(Q,Tm(Y),4);case 4:return Q.return(C[0].videos)}})},a3Z=function(N,z,v,R){var C,Z,Y,Q,L,K,l,W,G;
return g.S(function(x){return x.W==1?(C=z.playlistId,Z=H$r(z),Y=Z.M5,Q=Z.B$,L=v?(Number(v)*1E3).toString():Date.now().toString(),K=z.lastModifiedTimestamp?(Number(z.lastModifiedTimestamp)*1E3).toString():"0",l={id:g.qJ(C,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:Q,lastModifiedTimestampMillis:K,addedTimestampMillis:L,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},W={id:g.qJ(C,"musicPlaylist"),title:z.title,playlistId:C,thumbnailDetails:z.thumbnail,visibility:QhZ(z),trackCount:z.totalVideoCount,
tracks:Y,downloadMetadata:l.id},R&&(((G=W)==null?0:G.entityMetadata)?W.entityMetadata.nextAutoRefreshIntervalSeconds=String(R):W&&(W.entityMetadata={nextAutoRefreshIntervalSeconds:String(R)})),g.k(x,qo(N.V,{mode:"readwrite",sR:!0},function(e){var d=Xw(e,W,"musicPlaylist");e=Xw(e,l,"musicPlaylistDownloadMetadataEntity");return g.TJ.all([d,e])}),2)):x.return(W)})},QhZ=function(N){switch(N.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},L11=function(N,z){this.V=N;
this.Z=z},GA7=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W,G,x,e;
return g.S(function(d){switch(d.W){case 1:return v=Lp(z),R=g.cy(z.entityKey),C=R.entityId,Z=g.t(z.actionMetadata,K1V),g.d_(d,2),g.k(d,l35(N,C,void 0,(Y=Z)==null?void 0:Y.track,(Q=Z)==null?void 0:Q.albumRelease),4);case 4:if((L=Z)==null?0:L.playlistId){d.Zp(5);break}return g.k(d,ECW(N.V,z.entityKey),5);case 5:g.nO(d,3);break;case 2:return K=g.U2(d),l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",K instanceof g.xp&&K.type==="QUOTA_EXCEEDED"&&
(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),d.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,l,W));case 3:x=Number(((G=z.actionMetadata)==null?void 0:G.priority)||0)+1;var T=(T=g.t(z.actionMetadata,K1V))?{playbackDataActionMetadata:{maximumDownloadQuality:T.maximumDownloadQuality}}:void 0;e=Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",C,"playbackData",x,W18,T);return d.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v,[e]))}})},xV8=function(N,z){var v,R,C,Z,Y,Q,L,K,l,W,G,x,e,d,T;
return g.S(function(m){switch(m.W){case 1:return v=Lp(z),R=g.cy(z.entityKey),C=R.entityId,g.k(m,w7(N.V,z.entityKey,"musicTrack"),2);case 2:Z=m.V;if(!Z){Y=void 0;m.Zp(3);break}return g.k(m,w7(N.V,Z.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:Y=m.V;case 3:Q=Y;if(!Z||!Q)return m.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v));K=g.t(z.actionMetadata,K1V);g.d_(m,5);return g.k(m,l35(N,C,Q.addedTimestampMillis,(l=K)==null?void 0:l.track,(W=K)==null?void 0:W.albumRelease),
7);case 7:x=Number(((G=z.actionMetadata)==null?void 0:G.priority)||0)+1;L=Pg("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",C,"playbackData",x,W18);g.nO(m,6);break;case 5:e=g.U2(m);if(!(e instanceof Error&&e.message==="No data")){if(e instanceof Error&&e.message==="Empty response body")Zc(e.message);else return d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",e instanceof g.xp&&e.type==="QUOTA_EXCEEDED"&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),m.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,d,T));m.Zp(6);break}return g.k(m,$f(C,N.V,z,N.Z),6);case 6:return m.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",v,L?[L]:void 0))}})},egl=function(N,z){var v,R;
return g.S(function(C){switch(C.W){case 1:return v=Lp(z),g.d_(C,2),R=g.cy(z.entityKey).entityId,R==="!*$_ALL_ENTITIES_!*$"?g.k(C,Bg(N.V,z,N.Z),5):g.k(C,$f(R,N.V,z,N.Z),6);case 6:return g.k(C,hr5(N.V,z.entityKey),5);case 5:g.nO(C,3);break;case 2:return g.U2(C),C.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",v,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return C.return(new VH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
v))}})},l35=function(N,z,v,R,C){var Z,Y,Q,L,K,l;
return g.S(function(W){switch(W.W){case 1:if(Z=R){W.Zp(2);break}return g.k(W,b$w([z]),3);case 3:Y=W.V,Q=Y[0],Z=SP9(Q);case 2:return g.k(W,JBm(N,Z,z,C,v),4);case 4:L=W.V;K=L.musicTrackEntity;l=L.EE;var G=Jw(K.thumbnailDetails),x=[];l&&(x=Jw(l.thumbnailDetails));return g.k(W,Tm(G.concat(x)),0)}})},JBm=function(N,z,v,R,C){var Z;
return g.S(function(Y){return Y.W==1?(C||(C=Date.now().toString()),Z={id:g.qJ(v,"musicTrackDownloadMetadataEntity"),playbackData:g.qJ(v,"playbackData"),addedTimestampMillis:C,videoDownloadContextEntity:g.qJ(v,"videoDownloadContextEntity")},R&&(z.albumRelease=R.id),g.k(Y,qo(N.V,{mode:"readwrite",sR:!0},function(Q){var L=[],K=Xw(Q,Z,"musicTrackDownloadMetadataEntity");L.push(K);K=Xw(Q,z,"musicTrack");L.push(K);R&&(Q=Xw(Q,R,"musicAlbumRelease"),L.push(Q));return g.TJ.all(L)}),2)):Y.W!=3?g.k(Y,Gm(v,"musicTrackDownloadMetadataEntity",
N.V,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):Y.return({musicTrackEntity:z,
EE:R})})},NR=function(){rh.apply(this,arguments);
this.J="musicTrack"},yBU=function(N,z,v){z=z===void 0?43200:z;
v=v===void 0?!0:v;var R=R===void 0?!1:R;var C,Z;return g.S(function(Y){switch(Y.W){case 1:if(!N.G.r$())return Y.return([]);C=[];g.d_(Y,2);return g.k(Y,ch8(z,v,R),4);case 4:C=Y.V;g.nO(Y,3);break;case 2:g.U2(Y);case 3:return Z=ne7(N,C,v,"musicPlaylist"),Y.return(Z)}})},f3Z=function(){g.GI.apply(this,arguments);
var N=this;this.events=new g.VV(this);this.iS=this.player.D();this.Oi={WFl:function(){return N.V},
DW:function(){return N.DW()},
fL:function(z){return N.fL(z)}}},dV7=function(N){var z;
N=g.t((z=N.getWatchNextResponse())==null?void 0:z.currentVideoEndpoint,g.wi);if(N==null?0:N.playlistId)var v=N.playlistId;return v},sh$=function(N,z){var v,R,C,Z;
return g.S(function(Y){if(Y.W==1){v=z.clientPlaybackNonce;R={cpn:v,offlineSourceVisualElement:g.sn(z.BL||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};z.W&&(R.videoFmt=Number(z.W.itag));z.N&&(R.audioFmt=Number(z.N.itag));if((C=dV7(z))&&z.videoId){var Q=z.videoId;Q=C!=="PPSV"?Promise.resolve(!1):N.V.D1(Q);Y=g.k(Y,Q,3)}else Y=Y.Zp(2);return Y}Y.W!=2&&(Z=Y.V)&&(R.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");N.W=v;g.aX("offlinePlaybackStarted",R);g.fO(Y)})};
g.mQ.prototype.Ap=g.Ym(51,function(N){return this.app.Ap(N)});
g.xo.prototype.Ap=g.Ym(50,function(N){return g.Hpb(this,9,N)});
g.y(hP,Ea);g.i7.Object.defineProperties(hP.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.V.entityMetadata},
set:function(N){this.V.entityMetadata=N}}});
g.y(W$U,hP);W$U.prototype.W=function(){return[]};
g.y(GnZ,hP);GnZ.prototype.W=function(){return[]};
g.y(xH9,hP);xH9.prototype.W=function(){return[]};
g.y(ePP,hP);ePP.prototype.W=function(){return[]};
g.y(Jv$,hP);Jv$.prototype.W=function(){var N=[];this.V.alternateChannel&&N.push(this.V.alternateChannel);this.V.alternateChannelList&&N.push.apply(N,g.U(this.V.alternateChannelList));this.V.oneofChannelEntity&&N.push(this.V.oneofChannelEntity);return[].concat(g.U(new Set(N)))};
g.y(yv7,hP);yv7.prototype.W=function(){var N=[];this.V.entryCollection&&N.push(this.V.entryCollection);return[].concat(g.U(new Set(N)))};
g.y(fxr,Ea);fxr.prototype.W=function(){var N=[];this.V.video&&N.push(this.V.video);return[].concat(g.U(new Set(N)))};
g.y(dHU,hP);dHU.prototype.W=function(){var N=[];this.V.parentPlaylist&&N.push(this.V.parentPlaylist);if(this.V.entries)for(var z=g.f(this.V.entries),v=z.next();!v.done;v=z.next())N.push.apply(N,g.U((new fxr(v.value)).W()));return[].concat(g.U(new Set(N)))};
g.y(s8E,hP);s8E.prototype.W=function(){var N=[];this.V.descriptionEntity&&N.push(this.V.descriptionEntity);this.V.creators&&N.push.apply(N,g.U(this.V.creators));this.V.theBiggestFan&&N.push(this.V.theBiggestFan);return[].concat(g.U(new Set(N)))};
g.y(TyZ,hP);TyZ.prototype.W=function(){return[]};
g.y(F$W,hP);F$W.prototype.W=function(){return[]};
g.y(n35,hP);n35.prototype.W=function(){return[]};
g.y(mHl,hP);mHl.prototype.W=function(){return[]};
g.y($Hm,hP);$Hm.prototype.W=function(){return[]};
g.y(UH9,hP);UH9.prototype.W=function(){return[]};
g.y(By8,hP);By8.prototype.W=function(){return[]};
g.y(AvU,hP);AvU.prototype.W=function(){return[]};
g.y(g3V,hP);g3V.prototype.W=function(){return[]};
g.y(pqm,hP);pqm.prototype.W=function(){var N=[];this.V.downloadsList&&N.push(this.V.downloadsList);this.V.smartDownloadsList&&N.push(this.V.smartDownloadsList);this.V.recommendedDownloadsList&&N.push(this.V.recommendedDownloadsList);this.V.refresh&&N.push(this.V.refresh);return[].concat(g.U(new Set(N)))};
g.y(knE,Ea);knE.prototype.W=function(){var N=[];this.V.video&&N.push(this.V.video);this.V.playlist&&N.push(this.V.playlist);this.V.videoItem&&N.push(this.V.videoItem);this.V.playlistItem&&N.push(this.V.playlistItem);return[].concat(g.U(new Set(N)))};
g.y(P9V,hP);P9V.prototype.W=function(){var N=[];this.V.refresh&&N.push(this.V.refresh);if(this.V.downloads)for(var z=g.f(this.V.downloads),v=z.next();!v.done;v=z.next())N.push.apply(N,g.U((new knE(v.value)).W()));return[].concat(g.U(new Set(N)))};
g.y(V6E,hP);V6E.prototype.W=function(){var N=[];this.V.localImageEntities&&N.push.apply(N,g.U(this.V.localImageEntities));return[].concat(g.U(new Set(N)))};
g.y(SpU,hP);SpU.prototype.W=function(){var N=[];this.V.playbackData&&N.push(this.V.playbackData);this.V.localImageEntities&&N.push.apply(N,g.U(this.V.localImageEntities));this.V.videoDownloadContextEntity&&N.push(this.V.videoDownloadContextEntity);return[].concat(g.U(new Set(N)))};
g.y(E3m,hP);E3m.prototype.W=function(){return[]};
g.y(hPU,hP);hPU.prototype.W=function(){var N=[];this.V.fakeChildren&&N.push.apply(N,g.U(this.V.fakeChildren));return[].concat(g.U(new Set(N)))};
g.y(H5W,hP);H5W.prototype.W=function(){var N=[];this.V.video&&N.push(this.V.video);this.V.playbackData&&N.push(this.V.playbackData);this.V.offlineVideoPolicy&&N.push(this.V.offlineVideoPolicy);return[].concat(g.U(new Set(N)))};
g.y(o31,hP);o31.prototype.W=function(){return[]};
g.y(DHm,hP);DHm.prototype.W=function(){var N=[];this.V.channelOwner&&N.push(this.V.channelOwner);this.V.videos&&N.push.apply(N,g.U(this.V.videos));this.V.collaboratorChannels&&N.push.apply(N,g.U(this.V.collaboratorChannels));this.V.downloadState&&N.push(this.V.downloadState);this.V.refresh&&N.push(this.V.refresh);return[].concat(g.U(new Set(N)))};
g.y(b5m,hP);b5m.prototype.W=function(){var N=[];this.V.video&&N.push(this.V.video);this.V.channelContributor&&N.push(this.V.channelContributor);return[].concat(g.U(new Set(N)))};
g.y(t6w,Ea);t6w.prototype.W=function(){var N=[];this.V.localImageEntities&&N.push.apply(N,g.U(this.V.localImageEntities));this.V.videoDownloadContextEntity&&N.push(this.V.videoDownloadContextEntity);return[].concat(g.U(new Set(N)))};
g.y(O5m,Ea);O5m.prototype.W=function(){var N=[];this.V.recommendedVideoMetadata&&N.push.apply(N,g.U((new t6w(this.V.recommendedVideoMetadata)).W()));return[].concat(g.U(new Set(N)))};
g.y(Ix5,Ea);Ix5.prototype.W=function(){var N=[];this.V.playbackPosition&&N.push(this.V.playbackPosition);return[].concat(g.U(new Set(N)))};
g.y(Xq5,hP);Xq5.prototype.W=function(){var N=[];this.V.owner&&N.push(this.V.owner);this.V.downloadState&&N.push(this.V.downloadState);this.V.userState&&N.push.apply(N,g.U((new Ix5(this.V.userState)).W()));this.V.additionalMetadata&&N.push.apply(N,g.U((new O5m(this.V.additionalMetadata)).W()));return[].concat(g.U(new Set(N)))};
g.y(rvr,hP);rvr.prototype.W=function(){var N=[];this.V.userChannelDetails&&N.push(this.V.userChannelDetails);return[].concat(g.U(new Set(N)))};
g.y(u41,hP);u41.prototype.W=function(){var N=[];this.V.channelOwner&&N.push(this.V.channelOwner);this.V.playbackPosition&&N.push(this.V.playbackPosition);this.V.localImageEntities&&N.push.apply(N,g.U(this.V.localImageEntities));this.V.downloadStatus&&N.push(this.V.downloadStatus);return[].concat(g.U(new Set(N)))};
g.y(cvr,hP);cvr.prototype.W=function(){return[]};
g.y(qpw,hP);qpw.prototype.W=function(){return[]};
g.y(M6V,hP);M6V.prototype.W=function(){return[]};
g.y(wqW,hP);wqW.prototype.W=function(){return[]};
g.y(Na1,hP);Na1.prototype.W=function(){return[]};
g.y(zQ7,hP);zQ7.prototype.W=function(){return[]};
g.y(vjZ,hP);vjZ.prototype.W=function(){return[]};
g.y(RQV,hP);RQV.prototype.W=function(){return[]};
g.y(Cbm,hP);Cbm.prototype.W=function(){return[]};
g.y(Zk1,hP);Zk1.prototype.W=function(){return[]};
g.y(YAl,hP);YAl.prototype.W=function(){return[]};
g.y(ik$,hP);ik$.prototype.W=function(){var N=[];this.V.trackDownloadMetadatas&&N.push.apply(N,g.U(this.V.trackDownloadMetadatas));return[].concat(g.U(new Set(N)))};
g.y(jKl,hP);
jKl.prototype.W=function(){var N=[];this.V.downloadedTracks&&N.push.apply(N,g.U(this.V.downloadedTracks));this.V.smartDownloadedTracks&&N.push.apply(N,g.U(this.V.smartDownloadedTracks));this.V.downloadedEpisodes&&N.push.apply(N,g.U(this.V.downloadedEpisodes));this.V.downloadedAlbumReleases&&N.push.apply(N,g.U(this.V.downloadedAlbumReleases));this.V.smartDownloadedAlbumReleases&&N.push.apply(N,g.U(this.V.smartDownloadedAlbumReleases));this.V.downloadedPlaylists&&N.push.apply(N,g.U(this.V.downloadedPlaylists));this.V.smartDownloadedPlaylists&&
N.push.apply(N,g.U(this.V.smartDownloadedPlaylists));this.V.metadataOnlyTracks&&N.push.apply(N,g.U(this.V.metadataOnlyTracks));return[].concat(g.U(new Set(N)))};
g.y(aJZ,hP);aJZ.prototype.W=function(){var N=[];this.V.trackDownloadMetadatas&&N.push.apply(N,g.U(this.V.trackDownloadMetadatas));return[].concat(g.U(new Set(N)))};
g.y(QKW,hP);QKW.prototype.W=function(){var N=[];this.V.playbackData&&N.push(this.V.playbackData);this.V.localImageEntities&&N.push.apply(N,g.U(this.V.localImageEntities));this.V.videoDownloadContextEntity&&N.push(this.V.videoDownloadContextEntity);return[].concat(g.U(new Set(N)))};
g.y(L3W,hP);L3W.prototype.W=function(){var N=[];this.V.musicLibraryStatusEntity&&N.push(this.V.musicLibraryStatusEntity);this.V.primaryArtists&&N.push.apply(N,g.U(this.V.primaryArtists));this.V.details&&N.push(this.V.details);this.V.userDetails&&N.push(this.V.userDetails);this.V.tracks&&N.push.apply(N,g.U(this.V.tracks));this.V.share&&N.push(this.V.share);this.V.downloadMetadata&&N.push(this.V.downloadMetadata);this.V.refresh&&N.push(this.V.refresh);return[].concat(g.U(new Set(N)))};
g.y(K3V,hP);K3V.prototype.W=function(){var N=[];this.V.albumRelease&&N.push(this.V.albumRelease);this.V.tracks&&N.push.apply(N,g.U(this.V.tracks));return[].concat(g.U(new Set(N)))};
g.y(lJ5,hP);lJ5.prototype.W=function(){var N=[];this.V.albumRelease&&N.push(this.V.albumRelease);return[].concat(g.U(new Set(N)))};
g.y(W3$,hP);W3$.prototype.W=function(){var N=[];this.V.details&&N.push(this.V.details);this.V.userDetails&&N.push(this.V.userDetails);return[].concat(g.U(new Set(N)))};
g.y(Go9,hP);Go9.prototype.W=function(){var N=[];this.V.parentArtist&&N.push(this.V.parentArtist);return[].concat(g.U(new Set(N)))};
g.y(x_w,hP);x_w.prototype.W=function(){var N=[];this.V.parentArtist&&N.push(this.V.parentArtist);return[].concat(g.U(new Set(N)))};
g.y(eQU,hP);eQU.prototype.W=function(){return[]};
g.y(J_5,hP);J_5.prototype.W=function(){return[]};
g.y(y_E,Ea);y_E.prototype.W=function(){var N=[];this.V.creatorEntity&&N.push(this.V.creatorEntity);return[].concat(g.U(new Set(N)))};
g.y(fJV,hP);
fJV.prototype.W=function(){var N=[];this.V.tracks&&N.push.apply(N,g.U(this.V.tracks));this.V.refresh&&N.push(this.V.refresh);this.V.musicLibraryStatusEntity&&N.push(this.V.musicLibraryStatusEntity);this.V.details&&N.push(this.V.details);this.V.downloadMetadata&&N.push(this.V.downloadMetadata);this.V.sideloadMetadata&&N.push(this.V.sideloadMetadata);this.V.userDetails&&N.push(this.V.userDetails);this.V.entryCollection&&N.push(this.V.entryCollection);this.V.share&&N.push(this.V.share);this.V.podcastShowAdditionalMetadata&&N.push.apply(N,
g.U((new y_E(this.V.podcastShowAdditionalMetadata)).W()));return[].concat(g.U(new Set(N)))};
g.y(d_9,hP);d_9.prototype.W=function(){return[]};
g.y(sK8,hP);
sK8.prototype.W=function(){var N=[];this.V.musicLibraryStatusEntity&&N.push(this.V.musicLibraryStatusEntity);this.V.artists&&N.push.apply(N,g.U(this.V.artists));this.V.audioModeVersion&&N.push(this.V.audioModeVersion);this.V.videoModeVersion&&N.push(this.V.videoModeVersion);this.V.userDetails&&N.push(this.V.userDetails);this.V.details&&N.push(this.V.details);this.V.albumRelease&&N.push(this.V.albumRelease);this.V.share&&N.push(this.V.share);this.V.libraryEdit&&N.push(this.V.libraryEdit);this.V.downloadMetadata&&
N.push(this.V.downloadMetadata);this.V.playbackPosition&&N.push(this.V.playbackPosition);this.V.lyrics&&N.push(this.V.lyrics);return[].concat(g.U(new Set(N)))};
g.y(TaW,hP);TaW.prototype.W=function(){var N=[];this.V.parentTrack&&N.push(this.V.parentTrack);return[].concat(g.U(new Set(N)))};
g.y(F31,hP);F31.prototype.W=function(){var N=[];this.V.parentTrack&&N.push(this.V.parentTrack);return[].concat(g.U(new Set(N)))};
g.y(njl,hP);njl.prototype.W=function(){return[]};
g.y(m_8,hP);m_8.prototype.W=function(){return[]};
g.y($_9,hP);$_9.prototype.W=function(){return[]};
g.y(U_W,hP);U_W.prototype.W=function(){return[]};
g.y(BaP,hP);BaP.prototype.W=function(){var N=[];this.V.transfer&&N.push(this.V.transfer);this.V.adsPlaybackData&&N.push.apply(N,g.U(this.V.adsPlaybackData));this.V.drmLicense&&N.push(this.V.drmLicense);this.V.offlineVideoPolicy&&N.push(this.V.offlineVideoPolicy);this.V.videoDownloadContextEntity&&N.push(this.V.videoDownloadContextEntity);return[].concat(g.U(new Set(N)))};
g.y(A_E,hP);A_E.prototype.W=function(){return[]};
g.y(gjl,hP);gjl.prototype.W=function(){var N=[];this.V.offlineVideoStreams&&N.push.apply(N,g.U(this.V.offlineVideoStreams));this.V.captionTrack&&N.push.apply(N,g.U(this.V.captionTrack));return[].concat(g.U(new Set(N)))};
g.y(pfw,hP);pfw.prototype.W=function(){return[]};
g.y(koE,hP);koE.prototype.W=function(){return[]};
g.y(PbV,hP);PbV.prototype.W=function(){return[]};
g.y(VSr,hP);VSr.prototype.W=function(){return[]};
g.y(SAl,hP);SAl.prototype.W=function(){return[]};
g.y(Ej$,hP);Ej$.prototype.W=function(){return[]};
g.y(hQW,hP);hQW.prototype.W=function(){return[]};
g.y(Hkw,hP);Hkw.prototype.W=function(){return[]};
g.y(ojZ,hP);ojZ.prototype.W=function(){return[]};
g.y(D_Z,hP);D_Z.prototype.W=function(){return[]};
g.y(bk8,hP);bk8.prototype.W=function(){return[]};
g.y(tS5,hP);tS5.prototype.W=function(){return[]};
g.y(OkV,hP);OkV.prototype.W=function(){return[]};
g.y(IJV,hP);IJV.prototype.W=function(){return[]};
g.y(Xf7,hP);Xf7.prototype.W=function(){return[]};
g.y(r_U,hP);r_U.prototype.W=function(){return[]};
g.y(umm,hP);umm.prototype.W=function(){return[]};
g.y(c_$,hP);c_$.prototype.W=function(){return[]};
g.y(qAm,hP);qAm.prototype.W=function(){return[]};
g.y(MS9,hP);MS9.prototype.W=function(){return[]};
var qPP=["browse","music/browse","unplugged/browse"],vZ9=["offline/playlist_sync_check"],Dmw=["offline"],MUP=["offline/offline_video_playback_position_sync"],Ns1=["offline/get_playback_data_entity"],HF;oU.getInstance=function(){return g.S(function(N){return N.return(new Promise(function(z){g.qp().then(function(v){v?(oU.instance||(oU.instance=new oU(v)),z(oU.instance)):z(void 0)})}))})};
oU.prototype.get=function(N){var z=this,v,R,C;return g.S(function(Z){if(Z.W==1)return g.k(Z,v7V(z.token),2);if(Z.W!=3)return v=Z.V,g.k(Z,v.get("prefs",N),3);R=Z.V;if(!R)return Z.return();C=(0,g.I)();return R.expirationTimestampMs<=C?Z.return():Z.return(R.value)})};
oU.prototype.set=function(N,z,v){v=v===void 0?31536E3:v;var R=this,C,Z,Y;return g.S(function(Q){if(Q.W==1)return C=(0,g.I)(),Z={key:N,value:z,expirationTimestampMs:C+v*1E3},g.k(Q,v7V(R.token),2);Y=Q.V;return g.k(Q,g.pJ(Y,"prefs",Z),0)})};
oU.prototype.remove=function(N){var z=this,v;return g.S(function(R){if(R.W==1)return g.k(R,v7V(z.token),2);v=R.V;return g.k(R,v.delete("prefs",N),0)})};
g.y(DN,g.XS);g.y(b0,ixE);b0.prototype.Z=function(N,z){z=aI$(z);N=(new TextEncoder).encode(JSON.stringify(N));return this.V.encrypt(N,z)};
b0.prototype.W=function(N,z){if(!(N instanceof Uint8Array))throw Rk$(1);var v=new TextDecoder;z=aI$(z);N=this.V.decrypt(N,z);return JSON.parse(v.decode(N))};
var QZr={accountLinkStatusEntity:n35,booleanEntity:xH9,buttonEntity:OkV,captionTrack:njl,channelHandle:W$U,commerceAcquisitionClientPayloadEntity:Xf7,commerceCartListEntity:r_U,contextNoteFeedEntityPayload:GnZ,continuationTokenEntity:o31,downloadQualityPickerEntity:By8,downloadsPageRefreshTokenEntity:g3V,downloadsPageViewConfigurationEntity:cvr,downloadStatusEntity:AvU,dismissState:hQW,sfvAudioItemCurrentlyPlayingEntity:VSr,emojiFountainDataEntity:bk8,emojiCustomizationSetEntity:D_Z,fakeChannel:Jv$,
fakePlaylist:yv7,fakePlaylistEntryCollection:dHU,fakeVideo:s8E,fakeVideoDescription:TyZ,featuredProductsEntity:Cbm,flowStateEntity:F$W,iconBadgeEntity:umm,interstitialInteractionStateEntity:$Hm,likeButtonAnimationEntity:qpw,liveChatPollStateEntity:UH9,liveViewerLeaderboardChatEntryPointStateEntity:koE,liveViewerLeaderboardPointsEntity:PbV,liveReactionsDataEntity:tS5,logoEntity:mHl,macroMarkerEntity:M6V,mainDownloadsLibraryEntity:pqm,mainDownloadsListEntity:P9V,mainPlaylistDownloadStateEntity:V6E,
mainPlaylistEntity:DHm,mainPlaylistVideoEntity:b5m,mainVideoDownloadStateEntity:SpU,mainVideoEntity:Xq5,markersEngagementPanelSyncEntity:wqW,markersVisibilityOverrideEntity:Na1,musicAlbumReleaseDetail:K3V,musicAlbumReleaseDownloadMetadataEntity:ik$,musicAlbumRelease:L3W,musicAlbumReleaseUserDetail:lJ5,musicArtistDetail:Go9,musicArtist:W3$,musicArtistUserDetail:x_w,musicDownloadsLibraryEntity:jKl,musicLibraryEdit:eQU,musicLibraryStatusEntity:J_5,musicPlaylist:fJV,musicPlaylistDownloadMetadataEntity:aJZ,
musicShare:d_9,musicTrackDetail:TaW,musicTrackDownloadMetadataEntity:QKW,musicTrack:sK8,musicTrackUserDetail:F31,offlineOrchestrationActionWrapperEntity:m_8,offlineVideoPolicy:$_9,offlineVideoStreams:U_W,offlineabilityEntity:E3m,orchestrationWebSamplingEntity:hPU,pageHeaderEntity:Hkw,pdpStateEntity:c_$,pinnedProductEntity:Zk1,playbackData:BaP,playerStateEntity:zQ7,quantityIncrementerEntity:qAm,refresh:A_E,saveToPlaylistListEntity:SAl,settingEntity:Ej$,stringEntity:ePP,suggestedFeedbackChipStateEntity:vjZ,
transfer:gjl,trendingOfferEntity:YAl,videoDownloadContextEntity:pfw,videoOverviewAsyncDataEntity:MS9,videoPlaybackPositionEntity:IJV,votingEntity:ojZ,ytMainChannelEntity:rvr,youchatPendingResponseEntity:RQV,ytMainDownloadedVideoEntity:H5W,ytMainVideoEntity:u41};g.y(u0,ixE);u0.prototype.Z=function(N){return N};
u0.prototype.W=function(N){if(N instanceof Uint8Array)throw Rk$(0);return N};
g.y(cF,g.H);cF.prototype.observe=function(N){var z=this;this.observers.push(N);return function(){var v=z.observers.indexOf(N);v>=0&&z.observers.splice(v,1)}};
cF.prototype.W=function(N){FGW(this,N.data)};
cF.prototype.AO=function(){this.channel.close()};
var BHr,$ml=new g.ni("elementsCommand");var np=new g.ni("entityBatchUpdate");var GB1=new g.ni("downloadStatusEntity");var ger=new g.ni("mainPlaylistEntityActionMetadata");var qC=new g.ni("mainVideoEntityActionMetadata");var oC5=new g.ni("musicPlaylistEntityActionMetadata");var K1V=new g.ni("musicTrackEntityActionMetadata");var XlZ=new g.ni("localImageEntityActionMetadata");var SQ=new g.ni("playbackDataActionMetadata");var Uv5=new g.ni("transferEntityActionMetadata");var lFU=new g.ni("videoPlaybackPositionEntityActionMetadata");var Ox1;new g.Ww;new g.Ww;cLP.prototype.request=function(N,z,v){z=z===void 0?{}:z;return this.locks.request(N,z,function(R){return v(R)})};var Cp=g.u7.caches,Rr,zrr;vg.prototype.open=function(N){return Cp.open(ws8(N))};
vg.prototype.has=function(N){return Cp.has(ws8(N))};
vg.prototype.delete=function(N){return Cp.delete(ws8(N))};
vg.prototype.match=function(N,z){var v=this,R,C,Z,Y,Q,L;return g.S(function(K){switch(K.W){case 1:return g.k(K,v.keys(),2);case 2:R=K.V,C=g.f(R),Z=C.next();case 3:if(Z.done){K.Zp(5);break}Y=Z.value;return g.k(K,v.open(Y),6);case 6:return Q=K.V,g.k(K,Q.match(N,z),7);case 7:if(L=K.V)return K.return(L);Z=C.next();K.Zp(3);break;case 5:return K.return()}})};
g.y(MG7,vg);MG7.prototype.keys=function(){var N,z,v,R,C,Z,Y,Q,L;return g.S(function(K){if(K.W==1)return N=[],z=g.rY("CacheStorage keys"),g.k(K,Cp.keys(),2);v=K.V;R=g.f(v);for(C=R.next();!C.done;C=R.next()){Z=C.value;var l=Z.indexOf(":");Y=l===-1?{by:Z}:{by:Z.substring(0,l),datasyncId:Z.substring(l+1)};Q=Y.by;L=Y.datasyncId;L===z&&N.push(Q)}return K.return(N)})};g.y(Yf,g.H);Yf.prototype.Z=function(N){this.api.Qp("onOfflineOperationFailure",N.data)};
Yf.prototype.N=function(N){this.api.publish("offlinetransferpause",N.data)};
Yf.prototype.AO=function(){var N;(N=this.V)==null||N.close();var z;(z=this.W)==null||z.close()};C6V.prototype.iI=function(){this.V&&jQ(this)};
C6V.prototype.mJ=function(){this.W&&this.W.resolve();this.Z=this.V=!1;this.J()};var Oj8=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var F9V="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var VU7="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.y(CkW,kf);CkW.prototype.W=function(N){return Kp(N)?ijw(this,N):lA(N)?QHr(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};g.y(Lqw,kf);Lqw.prototype.W=function(N){return lA(N)?KqE(this,N):W9$(N)?WqW(this,N):Wg(N)?GE5(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};g.J=xvV.prototype;g.J.axp=function(N){var z=this,v,R,C,Z;return g.S(function(Y){if(!g.u(N.state,128))return Y.Zp(0);v=N.state.BP;var Q=(R=v)==null?void 0:R.errorCode,L=(C=v)==null?void 0:C.mO;Z=Q==="net.connect"&&L===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(Q==null?0:Q.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.k(Y,z.wk(z.player.getVideoData().videoId,Z),0)})};
g.J.wk=function(N,z){var v=this;return g.S(function(R){if(R.W==1){if(v.W)return R.return();v.W=!0;return z==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Hg(v,N,!1,!0),R.Zp(0)):g.k(R,hw(v,N),3)}g.gi(N,4);return g.k(R,v.V.wk(z),0)})};
g.J.JB=function(N){N.status===2?(N.status!==this.Z&&(KNm(this.V),g.gi(N.videoId,2)),N.xS&&e$W(this.V,N.videoId,N.xS)):N.status===4?(hw(this,N.videoId),this.wk(N.videoId,N.Dh?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):N.status===1&&x4U(this.V);this.Z=N.status;this.api.Qp("localmediachange",{videoId:N.videoId,status:N.status})};
g.J.LD=function(){var N=this,z;return g.S(function(v){if(v.W==1){if(N.W)return v.return();N.W=!0;z=N.player.getVideoData().videoId;return g.k(v,hw(N,z),2)}return g.k(v,N.V.LD(),0)})};
g.J.AN=function(N){switch(N){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.J.X=function(N){return this.api.D().X(N)};g.y(Tsm,kf);Tsm.prototype.W=function(N){return Kp(N)?nZr(this,N):lA(N)?mvU(this,N):W9$(N)?$vl(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};kE8.prototype.V=function(N,z){var v=N.action.actionMetadata.priority-z.action.actionMetadata.priority;v===0&&(N.V<z.V?v=-1:N.V>z.V&&(v=1));return v};g.y(or,g.H);or.prototype.AO=function(){this.J&&this.J();g.H.prototype.AO.call(this)};
or.prototype.createAction=function(N,z){var v=g.cy(N.entityKey).entityType,R=g.sD(16);return new yH(v,R,N,z.actionId,z.rootActionId)};
or.prototype.Vp=function(N){var z=this,v,R,C,Z,Y,Q,L,K,l;return g.S(function(W){if(W.W==1){if(z.HL())return W.return();R=(v=N.offlineOrchestrationActionWrapperEntity)!=null?v:new Set;C=[];Z=g.f(R);for(Y=Z.next();!Y.done;Y=Z.next())Q=Y.value,L=g.cy(Q),K=L.entityId,So7(z.V,K)||C.push(Q);return g.k(W,r45(z,C),2)}l=W.V;return g.k(W,Xnw(z,l),0)})};
or.prototype.retry=function(){var N=this;return g.S(function(z){return g.k(z,uQr(N),0)})};qo5.prototype.HK=function(N,z){z=z===void 0?!0:z;var v=this,R,C,Z,Y,Q,L,K,l;return g.S(function(W){switch(W.W){case 1:if(!v.V)return W.return();R=[];C=g.vb(v.V.W,z);Z=[];for(Y={bP:0};Y.bP<C.length;Y={bP:Y.bP},Y.bP++)Q=C[Y.bP],L=v.V.EP(Q,"json3"),K=g.UF(L,{withCredentials:!0,format:"RAW"},3,500).then(function(G){return function(x){x={metadata:g.Gf(C[G.bP]),trackData:x.xhr.responseText};Z.push(x)}}(Y)).YK(function(G){Zc("Caption fetch error",G)}),R.push(K);
return g.k(W,lxU(R),2);case 2:return g.d_(W,3),g.k(W,E7w(N,Z),5);case 5:g.nO(W,0);break;case 3:l=g.U2(W),Zc("Caption DB transaction error",l),g.fO(W)}})};g.y(Dc,g.H);Dc.prototype.AO=function(){this.W&&this.W();g.H.prototype.AO.call(this)};
Dc.prototype.Z=function(N){var z=this,v,R,C,Z,Y,Q,L,K;return g.S(function(l){R=(v=N.transfer)!=null?v:new Set;C=[];Z=g.f(R);for(Y=Z.next();!Y.done;Y=Z.next())Q=Y.value,L=g.cy(Q),K=L.entityId,C.push(K);return C.length===0?l.return():g.k(l,NA5(z,C),0)})};g.y(Z6U,g.H);g.J=Z6U.prototype;g.J.AO=function(){this.PL&&this.PL();this.K0.dispose();this.N.dispose();this.tO&&g.vs(this.G.C4,this.tO);this.Id&&g.vs(this.G.C4,this.Id);g.H.prototype.AO.call(this)};
g.J.UvT=function(N){var z=this,v,R,C;return g.S(function(Z){switch(Z.W){case 1:v=g.qJ(N,"transfer");if(z.V&&v===z.V.key){Hg(z.L,z.B,!0);z.N.stop();Z.Zp(0);break}return g.k(Z,qo(z.W,{mode:"readwrite",sR:!0},function(Y){return tP(Y,v,"transfer").then(function(Q){if(Q&&Q.transferState!=="TRANSFER_STATE_COMPLETE"&&Q.transferState!=="TRANSFER_STATE_FAILED")return Q.transferState="TRANSFER_STATE_PAUSED_BY_USER",Xw(Y,Q,"transfer").then(function(){return Q})})}),3);
case 3:R=Z.V;if(!R){Z.Zp(0);break}if(!N||!z.Z){Z.Zp(5);break}return g.k(Z,Gm(N,z.Z,z.W,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.k(Z,Oy(z,N),7);case 7:C=Z.V,K9E({videoId:N,vW:R,offlineModeType:C}),g.fO(Z)}})};
g.J.LQT=function(){var N=this;if(this.V&&this.B){Hg(this.L,this.B,!1);var z=this.V,v=(z==null?0:z.key)?g.cy(z.key).entityId:"";v&&this.Z&&(new Promise(function(R,C){Gm(v,N.Z,N.W,"DOWNLOAD_STATE_PAUSED").catch(function(Z){C(Z)})})).catch(function(R){Zc("Download state setting error",R)})}this.N.stop()};
g.J.At=function(){this.V?jO8(this,this.V):tw(this)};
g.J.d2=function(N){var z=this;return g.S(function(v){switch(v.W){case 1:if(!z.V){v.Zp(2);break}if(z.V.transferState==="TRANSFER_STATE_COMPLETE"||z.V.transferState==="TRANSFER_STATE_FAILED"||!N.transfer||!N.transfer.has(z.V.key)){v.Zp(3);break}return g.k(v,w7(z.W,z.V.key,"transfer"),4);case 4:z.V=v.V;if(z.V){v.Zp(3);break}return g.k(v,adl(z),3);case 3:if(z.V)return v.return();case 2:return g.k(v,tw(z),0)}})};
g.J.wk=function(N,z){var v=this,R,C,Z,Y,Q;return g.S(function(L){switch(L.W){case 1:if(!v.V){Ir(v,"onTransferFailure: "+N);L.Zp(2);break}R=v.V;Z=((C=R)==null?0:C.key)?g.cy(R.key).entityId:"";a:switch(N){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var K=!1;break a;default:K=!0}return K&&J7P(v)?g.k(L,Xx(v,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.k(L,
y78(v,N),5);case 5:if(!Z||!v.Z){L.Zp(2);break}return g.k(L,Gm(Z,v.Z,v.W,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.k(L,Oy(v,Z),9);case 9:Y=L.V;QH({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:Z,vW:R,offlineModeType:Y});if(!Z||!v.Z){L.Zp(2);break}return g.k(L,Gm(Z,v.Z,v.W,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:bA(v),Q=tw(v,!0),z&&z(Q),g.fO(L)}})};
g.J.LD=function(N){var z=this,v,R,C,Z,Y,Q,L,K,l,W,G,x;return g.S(function(e){switch(e.W){case 1:if(!z.V){Ir(z,"onMaybeTransferStreamsExpired");e.Zp(2);break}return J7P(z)?g.k(e,Xx(z,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.k(e,y78(z,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!z.Z){e.Zp(2);break}v=z.V;C=((R=v)==null?0:R.key)?g.cy(v.key).entityId:"";if(!C){e.Zp(2);break}return g.k(e,Gm(C,z.Z,z.W,"DOWNLOAD_STATE_FAILED"),2);case 9:return z.V||Ir(z,"onMaybeTransferStreamsExpiredRetryAttempting"),
Z=z.V,Q=((Y=Z)==null?0:Y.key)?g.cy(Z.key).entityId:"",g.k(e,Oy(z,Q),10);case 10:return L=e.V,QH({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:Q,vW:Z,offlineModeType:L}),K=JhE(),g.HN(K,SQ,{isEnqueuedForExpiredStreamUrlRefetch:!0}),l=g.qJ(Q,"playbackData"),W={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:l,actionMetadata:K},G=dh(new yH("playbackData",Q,W)),g.k(e,Mo(z.W,G,"offlineOrchestrationActionWrapperEntity"),2);case 2:bA(z),x=tw(z,!0),
N&&N(x),g.fO(e)}})};
var TbP={},fd1=(TbP.TRANSFER_STATE_TRANSFERRING=1,TbP.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,TbP);g.J=rh.prototype;g.J.Z5=function(){return this.B.promise};
g.J.Uj=function(){if(this.W&&this.L)return this.B.promise;TAl(this).then(this.B.resolve).catch(this.B.reject);return this.B.promise};
g.J.Yc=function(N){var z={};return z.playbackData=new CkW(N,this.iS,this.V),z.transfer=new Tsm(N,this.iS),z.videoPlaybackPositionEntity=new Lqw(N,this.iS),z};
g.J.Jl=function(){var N=this;return g.S(function(z){return N.W?g.k(z,Yb5(N.W),0):z.Zp(0)})};
g.J.Sw=function(){var N=this,z,v;return g.S(function(R){if(R.W==1)return N.W||N.L?g.k(R,N.Z5(),2):R.return();N.Y!==void 0&&(g.e5(N.Y),N.Y=void 0);N.N!==void 0&&(g.e5(N.N),N.N=void 0);(z=N.W)==null||z.dispose();N.W=void 0;(v=N.L)==null||v.dispose();N.L=void 0;N.api.Qp("onOrchestrationLostLeader");N.B=new g.Ww;g.fO(R)})};
g.J.isOrchestrationLeader=function(){return this.Z.V};
g.J.D1=function(){return g.S(function(N){return N.return(!1)})};
g.J.Al=function(N){var z=this.V;z.api.publish("offlinetransferpause",N);var v;(v=z.W)==null||v.postMessage(N)};
g.J.At=function(N){var z,v;return g.S(function(R){if(R.W==1)return g.k(R,zm(),2);z=R.V;if(!z)return R.return();v=g.qJ(N,"transfer");return g.k(R,qo(z,{mode:"readwrite",sR:!0},function(C){var Z=tP(C,v,"transfer"),Y=tP(C,g.qJ(N,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.TJ.all([Z,Y]).then(function(Q){Q=g.f(Q);var L=Q.next().value;var K=Q.next().value;return L&&L.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(L.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Xw(C,L,"transfer").then(function(){QH({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:N,vW:L,offlineModeType:K==null?void 0:K.offlineModeType});return g.TJ.resolve(null)})):g.TJ.resolve(null)})}),0)})};
g.J.X4=function(N){N=N===void 0?43200:N;var z=this,v,R,C,Z,Y,Q,L,K;return g.S(function(l){if(l.W==1)return z.G.r$()?g.k(l,zm(),2):l.return(FNW());if(l.W!=3){v=l.V;if(!v)return l.return([]);R=Date.now()/1E3;return g.k(l,NC(v,"offlineVideoPolicy"),3)}C=l.V;Z=[];Y=g.f(C);for(Q=Y.next();!Q.done;Q=Y.next())L=Q.value,Number(L.lastUpdatedTimestampSeconds)+N<=R&&(K=g.cy(L.key).entityId,Z.push(K));return Z.length?l.return(uA(z,Z,z.J,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):l.return([])})};
g.J.deleteAll=function(){return uA(this,["!*$_ALL_ENTITIES_!*$"],this.J,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.J.refreshAllStaleEntities=function(N){var z=this;return g.S(function(v){return v.W==1?g.k(v,z.X4(N),2):v.return(v.V)})};
g.J.setUpPositionSyncInterval=function(N){var z=this;this.N!==void 0&&(g.e5(this.N),this.N=void 0);var v=N!=null?N:864E5;this.N=g.GU(function(){z.lM(v)},v)};
g.J.lM=function(N){var z=this,v,R,C,Z,Y,Q;return g.S(function(L){switch(L.W){case 1:return g.d_(L,2),g.k(L,oU.getInstance(),4);case 4:v=L.V;if(!v)throw Error("prefStorage is undefined");return g.k(L,v.get("psi"),5);case 5:R=L.V;Z=((C=R)==null?0:C.ST)?Number(R.ST)/1E3:0;Y=Date.now();if(!(Z+N<=Y)){L.Zp(6);break}return g.k(L,uA(z,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.nO(L,0);break;case 2:Q=g.U2(L),Zc("Offline manager error",Q),
g.fO(L)}})};
g.J.Ef=function(){var N=this,z,v,R,C,Z,Y,Q;return g.S(function(L){if(L.W==1)return g.k(L,zm(),2);if(L.W!=3)return(z=L.V)?g.k(L,NC(z,"transfer"),3):L.return([]);v=L.V;R=[];C=g.f(v);for(Z=C.next();!Z.done;Z=C.next())Y=Z.value,Y.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&Y.key&&(Q=g.cy(Y.key).entityId,R.push(Q));return L.return(m4$(N,R))})};
g.J.Y0=function(){return g.S(function(N){return N.return([])})};
g.J.sF=function(){return g.S(function(N){g.fO(N)})};
g.J.nH=function(){return g.S(function(N){g.fO(N)})};g.y($4P,kf);$4P.prototype.W=function(N){return Kp(N)?A7W(this,N):lA(N)?plP(this,N):Wg(N)?kbm(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};
var cg=[10];g.y(h$7,kf);h$7.prototype.W=function(N){return Kp(N)?D48(this,N):lA(N)?b6$(this,N):Wg(N)?tWZ(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};
var oem=[10];g.y(Id5,kf);Id5.prototype.W=function(N){return lA(N)?r7r(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};g.y(uVE,rh);g.J=uVE.prototype;g.J.Yc=function(N){var z=rh.prototype.Yc.call(this,N);z.mainVideoEntity=new h$7(N,this.iS,this.V);z.mainPlaylistEntity=new $4P(N,this.iS,this.V);z.mainDownloadsListEntity=new Id5(N,this.iS,this.V);return z};
g.J.refreshAllStaleEntities=function(N,z){var v=this,R,C,Z,Y,Q,L,K,l,W,G,x;return g.S(function(e){switch(e.W){case 1:R=[];if(!v.iS.X("web_player_offline_playlist_auto_refresh")){e.Zp(2);break}return g.k(e,c7E(v,N,z),3);case 3:R=e.V;case 2:return g.k(e,oU.getInstance(),4);case 4:return C=e.V,g.k(e,(Z=C)==null?void 0:Z.get("sdois"),5);case 5:return Y=e.V,g.k(e,(Q=C)==null?void 0:Q.get("lmqf"),6);case 6:L=e.V;if(!Y){e.Zp(7);break}l=R;W=l.concat;return g.k(e,qbw(v,Y,(K=L)!=null?K:"SD",N===0),8);case 8:R=
W.call(l,e.V);case 7:return G=R,x=G.concat,g.k(e,rh.prototype.refreshAllStaleEntities.call(v,N,z),9);case 9:return R=x.call(G,e.V),e.return(R)}})};
g.J.D1=function(N){var z,v,R,C,Z,Y,Q,L;return g.S(function(K){if(K.W==1)return g.k(K,zm(),2);if(K.W!=3)return(z=K.V)?g.k(K,w7(z,g.Sw,"mainDownloadsListEntity"),3):K.return(!1);v=K.V;if((R=v)==null?0:(C=R.downloads)==null?0:C.length)for(Z=g.qJ(N,"mainVideoEntity"),Y=g.f(v.downloads),Q=Y.next();!Q.done;Q=Y.next())if(L=Q.value,L.videoItem===Z)return K.return(!0);return K.return(!1)})};
g.J.Y0=function(){var N=this,z,v,R,C,Z,Y,Q,L;return g.S(function(K){if(K.W==1)return g.k(K,zm(),2);if(K.W!=3)return(z=K.V)?g.k(K,NC(z,"downloadStatusEntity"),3):K.return([]);v=K.V;R=[];C=g.f(v);for(Z=C.next();!Z.done;Z=C.next())Y=Z.value,Y.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&Y.key&&(Q=g.cy(Y.key).entityId,R.push(Q));return R.length?(L={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},K.return(uA(N,R,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
L))):K.return([])})};
g.J.nH=function(){var N;return g.S(function(z){return z.W==1?g.k(z,zm(),2):(N=z.V)?g.k(z,qo(N,{mode:"readwrite",sR:!0},function(v){return Oa(v,"mainVideoEntity").then(function(R){var C=[];R=g.f(R);for(var Z=R.next();!Z.done;Z=R.next()){Z=Z.value;var Y=void 0;(Y=Z.userState)!=null&&Y.playbackPosition||(Y=g.cy(Z.key).entityId,Y={key:g.qJ(Y,"videoPlaybackPositionEntity"),videoId:Y,lastPlaybackPositionSeconds:"0"},C.push(Xw(v,Y,"videoPlaybackPositionEntity")),Z.userState={playbackPosition:Y.key},C.push(Xw(v,
Z,"mainVideoEntity")))}return g.TJ.all(C)})}),0):z.return()})};
g.J.sF=function(){var N,z,v,R,C,Z,Y,Q,L,K,l,W,G,x,e,d,T,m,n,P,V,D,c,r,Rv,Zu,Nx,av,M,s2,$m,O2,m7,QU,BU,mu,Y5,F;return g.S(function(jI){if(jI.W==1)return g.k(jI,zm(),2);if(jI.W!=3){N=jI.V;if(!N)return jI.return();z=g.qJ("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.k(jI,qo(N,{mode:"readonly",sR:!0},function(rE){return g.TJ.all([tP(rE,z,"mainDownloadsListEntity"),tP(rE,g.Sw,"mainDownloadsListEntity"),Oa(rE,"mainVideoEntity"),Oa(rE,"mainPlaylistEntity")])}),3)}v=jI.V;
R=g.f(v);C=R.next().value;Z=R.next().value;Y=R.next().value;Q=R.next().value;L=C;K=Z;l=Y;W=Q;G=new Set;if((x=L)==null?0:(e=x.downloads)==null?0:e.length)for(d=g.f(L.downloads),T=d.next();!T.done;T=d.next())m=T.value,n=void 0,(P=(n=m.videoItem)!=null?n:m.playlistItem)&&G.add(P);if((V=K)==null?0:(D=V.downloads)==null?0:D.length)for(c=g.f(K.downloads),r=c.next();!r.done;r=c.next())Rv=r.value,Rv.videoItem&&G.add(Rv.videoItem);Zu=new Set;Nx=[];av=g.f(W);for(M=av.next();!M.done;M=av.next()){s2=M.value;
if(s2.videos)for($m=g.f(s2.videos),O2=$m.next();!O2.done;O2=$m.next())m7=O2.value,(QU=JSON.parse(g.cy(m7).entityId).videoId)&&Zu.add(QU);s2.key&&!G.has(s2.key)&&Nx.push(s2.key)}BU=g.f(l);for(mu=BU.next();!mu.done;mu=BU.next())Y5=mu.value,Y5.key&&!G.has(Y5.key)&&(F=g.cy(Y5.key).entityId,Zu.has(F)||Nx.push(Y5.key));return Nx.length?g.k(jI,gC8(N,Nx),0):jI.Zp(0)})};g.y(MWZ,kf);MWZ.prototype.W=function(N){return Kp(N)?Nb1(this,N):lA(N)?zg5(this,N):Wg(N)?vWl(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};
var MC=[10];g.y(C1$,kf);C1$.prototype.W=function(N){return Kp(N)?YTV(this,N):lA(N)?iiW(this,N):Wg(N)?jh9(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};
var wh=[10];g.y(L11,kf);L11.prototype.W=function(N){return Kp(N)?GA7(this,N):lA(N)?xV8(this,N):Wg(N)?egl(this,N):Promise.reject(Error("Unsupported action type: "+N.actionType))};
var W18=[10];g.y(NR,rh);NR.prototype.Yc=function(N){var z=rh.prototype.Yc.call(this,N);z.musicTrack=new L11(N,this.V);z.musicPlaylist=new C1$(N,this.V);z.musicAlbumRelease=new MWZ(N,this.V);return z};
NR.prototype.refreshAllStaleEntities=function(N,z){var v=this,R,C,Z;return g.S(function(Y){if(Y.W==1)return g.k(Y,yBU(v,N,z),2);if(Y.W!=3)return C=R=Y.V,Z=C.concat,g.k(Y,rh.prototype.refreshAllStaleEntities.call(v,N,z),3);R=Z.call(C,Y.V);return Y.return(R)})};g.y(f3Z,g.GI);g.J=f3Z.prototype;g.J.create=function(){var N=this;g.b(this,this.events);if(g.ci(this.iS))this.V=new uVE(this.iS,this.player);else if(g.S0(this.iS)||g.wB(this.iS)==="WEB_MUSIC_INTEGRATIONS")this.V=new NR(this.iS,this.player);this.events.S(this.player,"onPlaybackStartExternal",function(){N.DW()});
this.events.S(this.player,"videodatachange",function(){N.DW()});
this.iS.X("html5_offline_playback_position_sync")&&this.events.S(this.player,"presentingplayerstatechange",this.fL)};
g.J.Do=function(){return!1};
g.J.g1=function(N,z,v,R){var C=this;return g.S(function(Z){return C.V?Z.return(uA(C.V,N,z,v,R)):Z.return(Promise.reject())})};
g.J.deleteAll=function(){return this.V.deleteAll()};
g.J.X4=function(N){return this.V.X4(N)};
g.J.refreshAllStaleEntities=function(N){return this.V.refreshAllStaleEntities(N)};
g.J.setUpPositionSyncInterval=function(N){this.V.setUpPositionSyncInterval(N)};
g.J.Al=function(N){this.V.Al(N)};
g.J.At=function(N){return this.V.At(N)};
g.J.DW=function(){var N=this,z;return g.S(function(v){z=N.player.getVideoData();return g.ID(z)?dV7(z)&&N.W!==z.clientPlaybackNonce?g.k(v,sh$(N,z),0):v.Zp(0):v.return()})};
g.J.fL=function(N){var z=this,v,R,C,Z,Y,Q,L;return g.S(function(K){if(K.W==1)return v=z.player.getVideoData(),R=v.Dx,g.WW(N,2)||g.WW(N,512)?g.k(K,zm(),2):K.return();if(K.W!=3){C=K.V;if(!C)return Zc("PES is undefined"),K.return();Z=v.videoId;return g.k(K,w7(C,g.qJ(Z,"mainVideoEntity"),"mainVideoEntity"),3)}Y=K.V;if(!Y)return K.return();Q=Math.floor(R).toString();L={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:Q}};return g.k(K,z.g1([Z],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
L),0)})};
g.J.isOrchestrationLeader=function(){return this.V.isOrchestrationLeader()};
g.J.updateDownloadState=function(N,z){var v,R,C,Z;return g.S(function(Y){if(Y.W==1)return g.k(Y,zm(),2);v=Y.V;if(!v)return Zc("PES is undefined"),Y.return();R=g.cy(N);C=R.entityType;Z=R.entityId;return g.k(Y,Gm(Z,C,v,z,!0),0)})};g.Wb("offline",f3Z);})(_yt_player);
